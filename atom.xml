<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://caoyu.me</id>
    <title>Gridea</title>
    <updated>2020-12-23T18:36:30.795Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://caoyu.me"/>
    <link rel="self" href="https://caoyu.me/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://caoyu.me/images/avatar.png</logo>
    <icon>https://caoyu.me/favicon.ico</icon>
    <rights>All rights reserved 2020, Gridea</rights>
    <entry>
        <title type="html"><![CDATA[UIç»˜åˆ¶æµç¨‹-ä»setContentViewè¯´èµ·]]></title>
        <id>https://caoyu.me/post/ui-hui-zhi-liu-cheng-cong-setcontentview-shuo-qi/</id>
        <link href="https://caoyu.me/post/ui-hui-zhi-liu-cheng-cong-setcontentview-shuo-qi/">
        </link>
        <updated>2020-12-23T17:00:16.000Z</updated>
        <summary type="html"><![CDATA[<blockquote>
<p>å¹³æ—¶æˆ‘ä»¬åœ¨å†™ <code>Android</code> <code>UI</code> æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šé€šè¿‡ <code>setContentVoew</code> æ–¹æ³•ï¼Œå°†æˆ‘ä»¬çš„å¸ƒå±€èµ„æºäº¤ç»™ <code>Activity</code>ï¼Œè®©å®ƒå»è¿›è¡Œå…³è” <code>window</code>ï¼Œè§£æ <code>å¸ƒå±€</code>ï¼Œæ¸²æŸ“ <code>è§†å›¾</code> ï¼Œæœ€ç»ˆåœ¨å±å¹•ä¸Šå±•ç°å‡ºäº†æˆ‘ä»¬éœ€è¦çš„æ•ˆæœã€‚ä¸Šä¸€èŠ‚æˆ‘ä»¬åˆ†æäº† <code>Activity</code> çš„å¯åŠ¨æµç¨‹ï¼ŒçŸ¥é“äº†æ–° <code>Activity</code> æœ€ç»ˆéƒ½ä¼šé€šè¿‡ <code>AMS</code> å’Œ <code>ClientLifecycleManager</code> çš„ç›¸äº’è°ƒåº¦ä¾æ¬¡æ‰§è¡Œ <code>attach</code> ã€<code>performCreate</code>ã€<code>performStart</code> å’Œ <code>performResume</code> çš„å››ä¸ªæ–¹æ³•ï¼Œä¸‹é¢æˆ‘ä»¬å°±æŒ‰ç…§è¿™ä¸ªæµç¨‹æ¥èŠèŠå¸ƒå±€çš„ <code>ç»‘å®š</code>ã€ <code>è§£æ</code> å’Œ <code>æ¸²æŸ“</code> çš„æµç¨‹ã€‚</p>
<p>é™„ï¼š<a href="https://blog.cyulv.com/archives/ui-startactivity/">Activity çš„å¯åŠ¨æµç¨‹</a></p>
</blockquote>
]]></summary>
        <content type="html"><![CDATA[<blockquote>
<p>å¹³æ—¶æˆ‘ä»¬åœ¨å†™ <code>Android</code> <code>UI</code> æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šé€šè¿‡ <code>setContentVoew</code> æ–¹æ³•ï¼Œå°†æˆ‘ä»¬çš„å¸ƒå±€èµ„æºäº¤ç»™ <code>Activity</code>ï¼Œè®©å®ƒå»è¿›è¡Œå…³è” <code>window</code>ï¼Œè§£æ <code>å¸ƒå±€</code>ï¼Œæ¸²æŸ“ <code>è§†å›¾</code> ï¼Œæœ€ç»ˆåœ¨å±å¹•ä¸Šå±•ç°å‡ºäº†æˆ‘ä»¬éœ€è¦çš„æ•ˆæœã€‚ä¸Šä¸€èŠ‚æˆ‘ä»¬åˆ†æäº† <code>Activity</code> çš„å¯åŠ¨æµç¨‹ï¼ŒçŸ¥é“äº†æ–° <code>Activity</code> æœ€ç»ˆéƒ½ä¼šé€šè¿‡ <code>AMS</code> å’Œ <code>ClientLifecycleManager</code> çš„ç›¸äº’è°ƒåº¦ä¾æ¬¡æ‰§è¡Œ <code>attach</code> ã€<code>performCreate</code>ã€<code>performStart</code> å’Œ <code>performResume</code> çš„å››ä¸ªæ–¹æ³•ï¼Œä¸‹é¢æˆ‘ä»¬å°±æŒ‰ç…§è¿™ä¸ªæµç¨‹æ¥èŠèŠå¸ƒå±€çš„ <code>ç»‘å®š</code>ã€ <code>è§£æ</code> å’Œ <code>æ¸²æŸ“</code> çš„æµç¨‹ã€‚</p>
<p>é™„ï¼š<a href="https://blog.cyulv.com/archives/ui-startactivity/">Activity çš„å¯åŠ¨æµç¨‹</a></p>
</blockquote>
<!-- more -->
<h2 id="windowçš„åˆ›å»º">Windowçš„åˆ›å»º</h2>
<p><code>Activity</code> çš„åˆ›å»ºåŒæ—¶ä¼´éšç€ <code>Window</code> çš„åˆ›å»ºï¼Œå¹¶ä¸”ä¸ºå…¶äºŒè€…å»ºç«‹ç›¸åº”çš„è”ç³»ã€‚åœ¨ <code>Android</code> ä¸­ <code>PhoneWindow</code> æ˜¯ <code>Window</code> çš„å”¯ä¸€å®ç°ç±»ï¼Œç³»ç»Ÿå®ä¾‹åŒ–çš„Windowå¯¹è±¡å®é™…æ˜¯å®ƒã€‚åœ¨å…¶ä¹‹ä¸Šä¼šåˆ›å»º <code>DecorView</code>ï¼Œå®ƒæ˜¯çª—å£çš„è§†å›¾çš„å…·ä½“è½½ä½“ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¹³æ—¶è¯´çš„æ ¹å¸ƒå±€ã€‚é€šå¸¸æˆ‘ä»¬é€šè¿‡ <code>setContentView</code> æ–¹æ³•è®¾ç½®æˆ‘ä»¬è‡ªå·±çš„è§†å›¾å¸ƒå±€ï¼Œå®ƒä¼šè¢«æ·»åŠ åˆ° <code>DecorView</code> ä¸­çš„ä¸€ä¸ªå«åš <code>ContentParent</code> çš„å­View ä¸­ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹çœ‹ Window çš„å®ä¾‹åŒ–è¿‡ç¨‹ã€‚</p>
<pre><code class="language-Java">final void attach(Context context, ActivityThread aThread,
            Instrumentation instr, IBinder token, int ident,
            Application application, Intent intent, ActivityInfo info,
            CharSequence title, Activity parent, String id,
            NonConfigurationInstances lastNonConfigurationInstances,
            Configuration config, String referrer, IVoiceInteractor voiceInteractor,
            Window window, ActivityConfigCallback activityConfigCallback, IBinder assistToken) {
        attachBaseContext(context);

        mFragments.attachHost(null /*parent*/);
		// ä»£ç  1
        mWindow = new PhoneWindow(this, window, activityConfigCallback);
        mWindow.setWindowControllerCallback(this);
        mWindow.setCallback(this);
        mWindow.setOnWindowDismissedCallback(this);
        mWindow.getLayoutInflater().setPrivateFactory(this);
    
    	
        if (info.softInputMode != WindowManager.LayoutParams.SOFT_INPUT_STATE_UNSPECIFIED) {
            mWindow.setSoftInputMode(info.softInputMode);
        }
        if (info.uiOptions != 0) {
            mWindow.setUiOptions(info.uiOptions);
        }
    
    	// ä»£ç  2
        mUiThread = Thread.currentThread();

        mMainThread = aThread;
        mInstrumentation = instr;
        mToken = token;
        mAssistToken = assistToken;
        mIdent = ident;
        mApplication = application;
        mIntent = intent;
        mReferrer = referrer;
        mComponent = intent.getComponent();
        mActivityInfo = info;
        mTitle = title;
        mParent = parent;
        mEmbeddedID = id;
        mLastNonConfigurationInstances = lastNonConfigurationInstances;
        if (voiceInteractor != null) {
            if (lastNonConfigurationInstances != null) {
                mVoiceInteractor = lastNonConfigurationInstances.voiceInteractor;
            } else {
                mVoiceInteractor = new VoiceInteractor(voiceInteractor, this, this,
                        Looper.myLooper());
            }
        }

    	// ä»£ç  3
        mWindow.setWindowManager(
                (WindowManager)context.getSystemService(Context.WINDOW_SERVICE),
                mToken, mComponent.flattenToString(),
                (info.flags &amp; ActivityInfo.FLAG_HARDWARE_ACCELERATED) != 0);
        if (mParent != null) {
            mWindow.setContainer(mParent.getWindow());
        }
        mWindowManager = mWindow.getWindowManager();
        mCurrentConfig = config;

        mWindow.setColorMode(info.colorMode);

        setAutofillOptions(application.getAutofillOptions());
        setContentCaptureOptions(application.getContentCaptureOptions());
    }
</code></pre>
<p>ä¸Šè¿°ä»£ç æ˜¯ Activity çš„ attach æ–¹æ³•ï¼Œå®ƒæ˜¯ Activity è¢«å®ä¾‹åŒ–åï¼Œç¬¬ä¸€ä¸ªæ‰§è¡Œçš„æ–¹æ³•ï¼ˆæºç  ActivityThread#performLaunchActivity æ–¹æ³•ä¸­ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ®µä»£ç ä¸»è¦å®Œæˆäº†ä»¥ä¸‹å·¥ä½œï¼š</p>
<ol>
<li>mWindow çš„åˆ›å»ºï¼Œå¹¶ä¸”å’Œå®ƒå»ºç«‹ç›¸åº”çš„è”ç³»ï¼Œå„ç§ callback è®¾ç½®æ–¹æ³•ã€‚</li>
<li>ç»™ Activity è®¾ç½®åˆå§‹åŒ–å‚æ•°ï¼Œæ¯”å¦‚ Intentã€UIThreadã€Applicationç­‰ã€‚</li>
<li>ç»™ mWindow è®¾ç½®ä¸€ä¸ª WindowManagerï¼Œåœ¨ Androidä¸­åŸºæœ¬ä¸Šæ‰€æœ‰çš„ View éƒ½æ˜¯é€šè¿‡ Window æ¥å‘ˆç°çš„ï¼Œæ¯”å¦‚ Activityã€Dialogã€Toastç­‰.</li>
<li>https://download.seafile.com/d/6e5297246c/files/?p=%2Fpro%2Fseafile-pro-server_7.0.9_x86-64.tar.gz&amp;dl=1</li>
<li>https://download.seafile.com/d/6e5297246c/files/?p=%2Fpro%2Fseafile-pro-server_7.0.9_x86-64.tar.gz.md5.txt&amp;dl=1</li>
</ol>
<h2 id="appcompatactivity-çš„å§”æ‰˜ç±»">AppCompatActivity çš„å§”æ‰˜ç±»</h2>
<p>åœ¨æˆ‘ä»¬ç¬¬ä¸€æ­¥è¿½è¸ª setContentView ä¸­çš„æ—¶å€™ï¼Œæˆ‘ä»¬å‘ç°äº†è¿™æ ·çš„ä¸€æ®µä»£ç </p>
<h3 id="ä»£ç -ç‰‡æ®µ1">ä»£ç  ç‰‡æ®µ1</h3>
<pre><code class="language-Java">  @Override
  public void setContentView(@LayoutRes int layoutResID) {
    getDelegate().setContentView(layoutResID);
  }
</code></pre>
<p>ä»–æ˜¯é€šè¿‡æ–°å»ºäº†ä¸€ä¸ª AppCompatDelegate è¿™ä¸ªç±»æ¥é—´æ¥è°ƒç”¨ <code>setContentView</code> çš„æ–¹æ³•ï¼Œç»§ç»­è¿½ä¸‹å»æˆ‘ä»¬å‘ç° AppCompatDelegate åªæœ‰ä¸€ä¸ªå®ç°ç±» AppCompatDelegateImplï¼ˆè¿™é‡Œè¯´æ˜ä¸‹ï¼Œç¬”è€…æ¢ç©¶çš„æºç æ˜¯ androidXçš„ç‰ˆæœ¬ï¼Œå¦‚æœæ˜¯ support åŒ…ä¸‹çš„ï¼ŒAppCompatDelegate çš„å®ç°ç±»æœ‰å¤šä¸ªï¼Œä¼šæ ¹æ® <code>Build.VERSION</code> æ¥åˆ¤æ–­å…·ä½“å®ä¾‹åŒ–å“ªä¸ªå®ç°ç±»ï¼‰ã€‚<br>
æˆ‘ä»¬æ¥çœ‹çœ‹ä»–çš„å…·ä½“å®ç°ã€‚</p>
<h3 id="ä»£ç -ç‰‡æ®µ2">ä»£ç  ç‰‡æ®µ2</h3>
<pre><code class="language-Java">@Override
public void setContentView(View v, ViewGroup.LayoutParams lp) {
  // SubDecorView
  ensureSubDecor();
  // ContentView é€šè¿‡ mSubDecor æ‰¾åˆ°
  ViewGroup contentParent = (ViewGroup) mSubDecor.findViewById(android.R.id.content);
  contentParent.removeAllViews();
  // è£…è½½æˆ‘ä»¬å®šä¹‰çš„å¸ƒå±€
  contentParent.addView(v, lp);
  mOriginalWindowCallback.onContentChanged();
}
</code></pre>
<p>ç»§ç»­çœ‹ <code>ensureSubDecor()</code> æ–¹æ³•</p>
<pre><code class="language-Java">private void ensureSubDecor() {
    if (!mSubDecorInstalled) {
        // åˆ›å»º DecorView
        mSubDecor = createSubDecor();
        ...
    }
}
</code></pre>
<p>ç»§ç»­çœ‹ <code>createSubDecor()</code> æ–¹æ³•</p>
<h3 id="ä»£ç -ç‰‡æ®µ3">ä»£ç  ç‰‡æ®µ3</h3>
<pre><code class="language-Java">private ViewGroup createSubDecor() {çš„
    ...
    // è¿™ä¸€æ®µæ˜¯ æ ¹æ®è·å–å½“å‰Activityçš„styleå¹¶è®¾ç½®ç›¸å…³çš„é£æ ¼çš„ä»£ç 

    // Now let's make sure that the Window has installed its decor by retrieving it
    mWindow.getDecorView();

    final LayoutInflater inflater = LayoutInflater.from(mContext);
    ViewGroup subDecor = null;

    // æ ¹æ®ç›¸å…³çš„æ ·å¼åŠ è½½ä¸åŒçš„å¸ƒå±€
    if (!mWindowNoTitle) {
        if (mIsFloating) {
            subDecor = (ViewGroup) inflater.inflate(
                    R.layout.abc_dialog_title_material, null);
            ...
        } else if (mHasActionBar) {
            ...
            subDecor = (ViewGroup) LayoutInflater.from(themedContext)
                    .inflate(R.layout.abc_screen_toolbar, null);
            ...
        }
    } else {
        if (mOverlayActionMode) {
            subDecor = (ViewGroup) inflater.inflate(
                    R.layout.abc_screen_simple_overlay_action_mode, null);
        } else {
            subDecor = (ViewGroup) inflater.inflate(R.layout.abc_screen_simple, null);
        }
        ...
        // è¿™ä¸€å †ä¸çœ‹ é€‚é… inset ç›¸å…³
    }
    ...
    
    // Now set the Window's content view with the decor
    mWindow.setContentView(subDecor);
    ...
    return subDecor;
}
</code></pre>
<p>ä»ä»¥ä¸Šä»£ç å¯ä»¥çœ‹åˆ° <code>AppCompatDelegate</code> æ ¹æ®å„ç§ä¸»é¢˜æ ·å¼ä¸åœºæ™¯åˆ›å»ºäº†ä¸€ä¸ª <code>subDecor</code> çš„Viewï¼Œ<code>subDecor</code> ä¸­åŒ…å«äº†æˆ‘ä»¬çš„ <code>contentView</code>ï¼Œæœ€åå°†å…¶å’ŒWindowåšäº†ç»‘å®šã€‚ä½†æ˜¯ä»å‘½åä¸Šæˆ‘ä»¬ä¼¼ä¹çŸ¥é“ï¼Œè¿™ä¸ªå¹¶ä¸æ˜¯çœŸæ­£çš„DecorViewã€‚ä¸ºäº†ä¸€æ¢ç©¶ç«Ÿï¼Œä¸‹é¢æˆ‘ä»¬ç»§ç»­è·Ÿè¿›Windowä¸­æºç ã€‚</p>
<h2 id="windowä¸­çš„æµç¨‹">Windowä¸­çš„æµç¨‹</h2>
<p>æˆ‘ä»¬ç»§ç»­è·Ÿè¿›ï¼Œå‘ç°Windowæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œæˆ‘ä»¬çŸ¥é“Androidä¸­Windowæœ‰ä¸”åªæœ‰ä¸€ä¸ªå­ç±»ï¼Œé‚£å°±æ˜¯PhoneWindowï¼Œç›´æ¥æ‰¾åˆ°ç›¸å…³å®ç°ï¼Œçœ‹ä»£ç ï¼š</p>
<pre><code class="language-Java">@Override
public void setContentView(View view) {
    setContentView(view, new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));
}
</code></pre>
<p>è¿™é‡Œè®¾ç½®äº† <code>subDecor</code> çš„LayoutParamsã€‚ç»§ç»­è·Ÿè¿›ï¼š</p>
<pre><code class="language-Java">@Override
public void setContentView(View view, ViewGroup.LayoutParams params) {
    if (mContentParent == null) {
        // åˆå§‹åŒ–æŸäº›ä¸œè¥¿
        installDecor();
    } else if (!hasFeature(FEATURE_CONTENT_TRANSITIONS)) {
        mContentParent.removeAllViews();
    }

    if (hasFeature(FEATURE_CONTENT_TRANSITIONS)) {
        view.setLayoutParams(params);
        final Scene newScene = new Scene(mContentParent, view);
        transitionTo(newScene);
    } else {
        // å°† `subDecor` æ·»åŠ è¿› mContentParent
        mContentParent.addView(view, params);
    }
    mContentParent.requestApplyInsets();
    final Callback cb = getCallback();
    if (cb != null &amp;&amp; !isDestroyed()) {
        cb.onContentChanged();
    }
    mContentParentExplicitlySet = true;
}
</code></pre>
<p>åœ¨ä¸Šä¸€ä¸ªæµç¨‹ä¸­ï¼Œæˆ‘ä»¬çŒœæµ‹ <code>subDecor</code> å¹¶ä¸æ˜¯ DecorViewï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å‘ç°æœ‰ä¸€ä¸ª <code>installDecor()</code> çš„æ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œé¢æ˜¯ä¸æ˜¯å°±æ˜¯åˆå§‹åŒ–äº†æˆ‘ä»¬çš„ DecorViewå‘¢ï¼Ÿ</p>
<pre><code class="language-Java">private void installDecor() {
    mForceDecorInstall = false;
    if (mDecor == null) {
        // ä»£ç  1
        mDecor = generateDecor(-1);
        ...
    } else {
        mDecor.setWindow(this);
    }
    if (mContentParent == null) {
        // ä»£ç  2
        mContentParent = generateLayout(mDecor);
        Â·Â·Â·
    }
}
</code></pre>
<p>è¿›å…¥ä¹‹åå‘ç°äº†ä¸¤å¤„ç¥å¥‡çš„ä»£ç ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªå˜é‡ï¼Œæˆ‘ä»¬çœ‹çœ‹è¿™ä¸¤ä¸ªå˜é‡éƒ½æ˜¯å•¥ã€‚</p>
<pre><code class="language-Java">// è¿™æ˜¯çª—å£çš„é¡¶å±‚å¸ƒå±€
// This is the top-level view of the window, containing the window decor.
private DecorView mDecor;

// è¿™æ˜¯æ”¾ç½®çª—å£å†…å®¹çš„è§†å›¾ã€‚å®ƒè¦ä¹ˆæ˜¯mDecoræœ¬èº«ï¼Œè¦ä¹ˆæ˜¯mDecorçš„å­å®¹å™¨ã€‚
// This is the view in which the window contents are placed. It is either
// mDecor itself, or a child of mDecor where the contents go.
</code></pre>
<p>ViewGroup mContentParent;</p>
<p>å¥½ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œç¡®å®æ‰¾åˆ°äº† DecorViewï¼Œç»§ç»­çœ‹çœ‹ DecorView æ˜¯æ€ä¹ˆè¢«åˆ›å»ºçš„ã€‚</p>
<pre><code class="language-Java">protected DecorView generateDecor(int featureId) {
    // System process doesn't have application context and in that case we need to directly use
    // the context we have. Otherwise we want the application context, so we don't cling to the
    // activity.
    Context context;
    if (mUseDecorContext) {
        Context applicationContext = getContext().getApplicationContext();
        if (applicationContext == null) {
            context = getContext();
        } else {
            context = new DecorContext(applicationContext, getContext());
            if (mTheme != -1) {
                context.setTheme(mTheme);
            }
        }
    } else {
        context = getContext();
    }
    // åˆ›å»ºäº† DecorView å¹¶ä¸”å°† this  windowä¼ å…¥è¿›è¡Œç»‘å®š
    return new DecorView(context, featureId, this, getAttributes());
}
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ° DecorView ç¡®å®è¢«åˆ›å»ºå‡ºæ¥äº†ã€‚ç„¶åæˆ‘ä»¬çœ‹çœ‹ mContentParentã€‚</p>
<pre><code class="language-Java">protected ViewGroup generateLayout(DecorView decor) {
    // Apply data from current theme.

    TypedArray a = getWindowStyle();
    ... æ ¹æ®styleè¿›è¡Œä¸€ç³»åˆ—èµ‹å€¼æ“ä½œ
    // Inflate the window decor.

    int layoutResource;
    int features = getLocalFeatures();
    ... ç»™ layoutResource è¿›è¡Œèµ‹å€¼æ“ä½œ

    mDecor.startChanging();
    mDecor.onResourcesLoaded(mLayoutInflater, layoutResource);

    ViewGroup contentParent = (ViewGroup)findViewById(ID_ANDROID_CONTENT);
   
    ...

    return contentParent;
}
</code></pre>
<p>æˆ‘ä»¬çœ‹åˆ° ä¸Šé¢æœ‰è¿™æ ·çš„ä¸€æ®µä»£ç  <code>mDecor.onResourcesLoaded(mLayoutInflater, layoutResource);</code> è¿™æ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿç»§ç»­è·Ÿè¿›ï¼š</p>
<pre><code class="language-Java">void onResourcesLoaded(LayoutInflater inflater, int layoutResource) {
    ...
    // inflate äº†è¿™ä¸ªèµ„æºæ–‡ä»¶
    final View root = inflater.inflate(layoutResource, null);
    if (mDecorCaptionView != null) {
        if (mDecorCaptionView.getParent() == null) {
            addView(mDecorCaptionView,
                    new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));
        }
        mDecorCaptionView.addView(root,
                new ViewGroup.MarginLayoutParams(MATCH_PARENT, MATCH_PARENT));
    } else {

        // å°†è¿™ä¸ªå¸ƒå±€æ–‡ä»¶ addè¿›DecorView ä¸­.
        addView(root, 0, new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));
    }
    mContentRoot = (ViewGroup) root;
    initializeElevation();
}
</code></pre>
<p>æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œ inflate äº†è¿™ä¸ªèµ„æºæ–‡ä»¶ï¼Œå¹¶ä¸”å°†å®ƒæ·»åŠ è¿›äº†DecorViewä¸­ï¼Œåœ¨ä¸Šä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬å‘ç°äº† contentParent æ˜¯é€šè¿‡ findViewById å‡ºæ¥çš„ï¼Œè¿›å»å¯ä»¥çœ‹åˆ°</p>
<pre><code class="language-Java">public &lt;T extends View&gt; T findViewById(@IdRes int id) {
    return getDecorView().findViewById(id);
}
</code></pre>
<p>å®ƒæ˜¯é€šè¿‡DecorViewæ‰¾å‡ºæ¥çš„ï¼Œç°åœ¨è®©æˆ‘ä»¬æ¥æ¢³ç†ä¸‹Windowçš„setContentViewçš„æ–¹æ³•éƒ½å¹²äº†ä»€ä¹ˆã€‚</p>
<ol>
<li>åˆå§‹åŒ–äº†DecorView</li>
<li>æ ¹æ®styleçš„ä¸åŒè®¾ç½®äº†ä¸åŒçš„feature</li>
<li>æ ¹æ®featureçš„ä¸åŒå¾—åˆ°äº†ä¸åŒçš„layoutResource</li>
<li>ç”¨layoutResource  inflateå‡ºäº†ä¸åŒå¸ƒå±€çš„Viewï¼Œå¹¶ä¸”è¢«æ·»åŠ åˆ°äº†DecorViewä¸­</li>
<li>é€šè¿‡DecorViewçš„findViewByIdçš„æ–¹æ³•æ‰¾åˆ°äº†contentView</li>
<li>contentViewå°†setContentViewä¸­Viewæ·»åŠ äº†è¿›å»</li>
</ol>
<p>ç»“åˆAppCompatActivityä¸­setContentViewçš„æµç¨‹ï¼Œæ•´ä½“æµç¨‹å°±å˜æˆäº†</p>
<ol>
<li>æ ¹æ®ä¸åŒçš„ä¸»é¢˜ç­‰ï¼Œåˆå§‹åŒ–SubDecorView</li>
<li>åˆå§‹åŒ–äº†DecorView</li>
<li>æ ¹æ®styleçš„ä¸åŒè®¾ç½®äº†ä¸åŒçš„feature</li>
<li>æ ¹æ®featureçš„ä¸åŒå¾—åˆ°äº†ä¸åŒçš„layoutResource</li>
<li>ç”¨layoutResource  inflateå‡ºäº†ä¸åŒå¸ƒå±€çš„Viewï¼Œå¹¶ä¸”è¢«æ·»åŠ åˆ°äº†DecorViewä¸­</li>
<li>é€šè¿‡DecorViewçš„findViewByIdçš„æ–¹æ³•æ‰¾åˆ°äº†contentView</li>
<li>contentViewå°†SubDecorViewæ·»åŠ äº†è¿›å»</li>
<li>SubDecorViewä¸­çš„contentViewå°†setContentViewä¸­Viewæ·»åŠ äº†è¿›å»</li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[äº‹ä»¶åˆ†å‘]]></title>
        <id>https://caoyu.me/post/shi-jian-fen-fa/</id>
        <link href="https://caoyu.me/post/shi-jian-fen-fa/">
        </link>
        <updated>2020-12-23T16:59:06.000Z</updated>
        <summary type="html"><![CDATA[<h2 id="è§¦æ‘¸äº‹ä»¶ç±»å‹">è§¦æ‘¸äº‹ä»¶ç±»å‹</h2>
<p>è§¦æ‘¸äº‹ä»¶å¯¹åº”çš„ç±»æ˜¯ MotionEvent ç±»ï¼Œäº‹ä»¶çš„ä¸»è¦ç±»å‹æœ‰ä»¥ä¸‹å››ç§ï¼š</p>
<ul>
<li>ACTION_DOWN æ‰‹æŒ‡åˆšæ¥è§¦å±å¹•</li>
<li>ACTION_MOVE æ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ»‘åŠ¨</li>
<li>ACTION_UP æ‰‹æŒ‡ä»å±å¹•ä¸ŠæŠ¬èµ·</li>
<li>ACTION_CANCEL éäººä¸ºå› ç´ å–æ¶ˆÃŸ</li>
</ul>
]]></summary>
        <content type="html"><![CDATA[<h2 id="è§¦æ‘¸äº‹ä»¶ç±»å‹">è§¦æ‘¸äº‹ä»¶ç±»å‹</h2>
<p>è§¦æ‘¸äº‹ä»¶å¯¹åº”çš„ç±»æ˜¯ MotionEvent ç±»ï¼Œäº‹ä»¶çš„ä¸»è¦ç±»å‹æœ‰ä»¥ä¸‹å››ç§ï¼š</p>
<ul>
<li>ACTION_DOWN æ‰‹æŒ‡åˆšæ¥è§¦å±å¹•</li>
<li>ACTION_MOVE æ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ»‘åŠ¨</li>
<li>ACTION_UP æ‰‹æŒ‡ä»å±å¹•ä¸ŠæŠ¬èµ·</li>
<li>ACTION_CANCEL éäººä¸ºå› ç´ å–æ¶ˆÃŸ</li>
</ul>
<!-- more -->
<p>View äº‹ä»¶åˆ†å‘çš„æœ¬è´¨å°±æ˜¯å°† MotionEvent ç±»åˆ†å‘ç»™å…·ä½“æŸä¸ªView å¤„ç†çš„è¿‡ç¨‹ï¼Œä¸€æ¬¡å®Œæ•´çš„äº‹ä»¶å“åº”åŒ…å« ä¸€ä¸ª ACTION_DOWN äº‹ä»¶ï¼Œä¸­é—´ä»»æ„ä¸ª ACTION_MOVE äº‹ä»¶ï¼Œä»¥åŠæœ€åçš„ ACTION_UP äº‹ä»¶æˆ–è€… ACTION_CANCEL äº‹ä»¶ã€‚</p>
<p>å…¶ä¸­ ACTION_CANCEL äº‹ä»¶çš„è§¦å‘ä¼šåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹å‘ç”Ÿï¼š</p>
<ol>
<li>å¦‚æœåœ¨çˆ¶Viewä¸­æ‹¦æˆªACTION_UPæˆ–ACTION_MOVEï¼Œåœ¨ç¬¬ä¸€æ¬¡çˆ¶è§†å›¾æ‹¦æˆªæ¶ˆæ¯çš„ç¬é—´ï¼Œçˆ¶è§†å›¾æŒ‡å®šå­è§†å›¾ä¸æ¥å—åç»­æ¶ˆæ¯äº†ï¼ŒåŒæ—¶å­è§†å›¾ä¼šæ”¶åˆ°ACTION_CANCELäº‹ä»¶ã€‚</li>
<li>å¦‚æœè§¦æ‘¸æŸä¸ªæ§ä»¶ï¼Œä½†æ˜¯åˆä¸æ˜¯åœ¨è¿™ä¸ªæ§ä»¶çš„åŒºåŸŸä¸ŠæŠ¬èµ·ï¼ˆç§»åŠ¨åˆ°åˆ«çš„åœ°æ–¹äº†ï¼‰ï¼Œå°±ä¼šå‡ºç°action_cancelã€‚</li>
</ol>
<h2 id="äº‹ä»¶åˆ†å‘çš„å¯¹è±¡">äº‹ä»¶åˆ†å‘çš„å¯¹è±¡</h2>
<p>å…·å¤‡äº‹ä»¶åˆ†å‘èƒ½åŠ›çš„å¯¹è±¡æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p>
<ul>
<li>Activity æ§åˆ¶å½“å‰é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»¥åŠäº‹ä»¶åˆ†å‘çš„ç¬¬ä¸€å±‚View</li>
<li>ViewGroup ä¸€ç»„Viewçš„é›†åˆï¼ŒåŒ…å«å¤šä¸ª View æˆ–è€… ViewGroup</li>
<li>View æ‰€æœ‰ UI ç»„ä»¶çš„åŸºç±»</li>
</ul>
<p>äº‹ä»¶åˆ†å‘çš„å¤§è‡´æµç¨‹ï¼šå½“æ‰‹æŒ‡è§¦ç¢°åˆ°å±å¹•æ—¶ï¼Œç³»ç»Ÿåº•å±‚ä¼šå‘å‡ºä¸€ä¸ªä¿¡å·ï¼Œæœ€ç»ˆåˆ°è¾¾ Activityï¼Œç”±Activityå‘ä¸‹æŠŠäº‹ä»¶åˆ†ç»™ä¸‹å±‚çš„ViewGroupï¼Œå†ç”±ä¸‹å±‚çš„ViewGroupå‘ä¸‹åˆ†å‘ï¼Œç›´åˆ°æ‰¾åˆ°å¯ä»¥å¤„ç†å½“å‰äº‹ä»¶çš„è§†å›¾ï¼Œå¹¶æŠŠåç»­äº‹ä»¶ä¹Ÿäº¤ç»™å…¶å¤„ç†ã€‚</p>
<h2 id="äº‹ä»¶åˆ†å‘çš„æ–¹æ³•">äº‹ä»¶åˆ†å‘çš„æ–¹æ³•</h2>
<p>äº‹ä»¶åˆ†å‘çš„è¿‡ç¨‹ç”±ä¸‰ä¸ªä¸»è¦çš„æ–¹æ³•å®Œæˆï¼š</p>
<ol>
<li>dispatchTouchEventï¼šåˆ†å‘ã€‚è¿”å› true è¡¨ç¤ºäº‹ä»¶è¢«å½“å‰ View æ¶ˆè´¹æ‰ï¼›è¿”å› false è¡¨ç¤ºäº¤ç»™çˆ¶ç±»å»å¤„ç†ï¼Œè¿”å› super.dispatchTouchEvent è¡¨ç¤ºç»§ç»­åˆ†å‘ä¸‹å»ã€‚</li>
<li>onInterceptTouchEventï¼šåˆ¤æ–­äº‹ä»¶æ˜¯å¦æ‹¦æˆªï¼ˆåªå­˜åœ¨äºViewGroupä¸­ï¼‰</li>
<li>onTouchEventï¼šäº‹ä»¶çš„å¤„ç†</li>
</ol>
<h2 id="äº‹ä»¶åˆ†å‘æµç¨‹">äº‹ä»¶åˆ†å‘æµç¨‹</h2>
<h3 id="activity-ä¸­çš„-åˆ†å‘è¿‡ç¨‹">Activity ä¸­çš„ åˆ†å‘è¿‡ç¨‹</h3>
<pre><code class="language-Java">public boolean dispatchTouchEvent(MotionEvent ev) {
    if (ev.getAction() == MotionEvent.ACTION_DOWN) {
        onUserInteraction();
    }
		// äº¤ç»™ DecorView å»åˆ†å‘äº‹ä»¶
    if (getWindow().superDispatchTouchEvent(ev)) {
        return true;
    }
		// å¦‚æœ DecorView æ²¡æœ‰å¤„ç†è¿™ä¸ªäº‹ä»¶ï¼Œå°†äº‹ä»¶äº¤ç»™è‡ªå·±å¤„ç†
    return onTouchEvent(ev);
}

// 
public boolean onTouchEvent(MotionEvent event) {
		// é’ˆå¯¹ ç±»ä¼¼ DialogActivityï¼Œç‚¹å‡»äº†å¤–éƒ¨åŒºåŸŸï¼Œå…³é—­å½“å‰çš„ Activity
    if (mWindow.shouldCloseOnTouch(this, event)) {
        finish();
        return true;
    }

    return false;
}
</code></pre>
<h3 id="viewgroupä¸­çš„äº‹ä»¶åˆ†å‘">ViewGroupä¸­çš„äº‹ä»¶åˆ†å‘</h3>
<pre><code class="language-Java">public boolean dispatchTouchEvent(MotionEvent ev) {
    boolean handled = false;
		// 
    if (onFilterTouchEventForSecurity(ev)) {
				...
        // åˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆªè¿™ä¸ªäº‹ä»¶
        final boolean intercepted;
				// DOWN äº‹ä»¶ï¼Œæˆ–è€…å·²ç»æœ‰ç›¸åº”è§†å›¾å¤„ç†è¿‡ä¹‹å‰çš„äº‹ä»¶
				// mFirstTouchTarget ä¸»è¦æ˜¯ç”¨æ¥è®°å½• ä» é¡¶å±‚å®¹å™¨ åˆ° å¤„ç†è¿™ä¸ª äº‹ä»¶çš„ ä¸€ä¸ªView çš„é“¾è·¯
				// ç¬¬äºŒæ¬¡çš„äº‹ä»¶åˆ†å‘ å°±ç›´æ¥èµ°è¿™ä¸ª é“¾è·¯è¿›è¡Œåˆ†å‘
        if (actionMasked == MotionEvent.ACTION_DOWN || mFirstTouchTarget != null) {
            
						final boolean disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != 0;
						// å­ç±»æ˜¯å¦è¦æ±‚çˆ¶ç±»ä¸æ‹¦æˆª
						if (!disallowIntercept) {
                intercepted = onInterceptTouchEvent(ev);
                ev.setAction(action); // restore action in case it was changed
            } else {
                intercepted = false;
            }
        } else {
            // æ²¡æœ‰æ‰¾åˆ°å¤„ç†è¿‡äº‹ä»¶çš„è§†å›¾ï¼Œå¹¶ä¸”ä¹Ÿä¸æ˜¯ down äº‹ä»¶
            intercepted = true;
        }

        ...
        if (!canceled &amp;&amp; !intercepted) {
						...
            if (actionMasked == MotionEvent.ACTION_DOWN
                    || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN)
                    || actionMasked == MotionEvent.ACTION_HOVER_MOVE) {
								...
								// åˆ¤æ–­å“ªäº›å­Viewå¯ä»¥æ¥æ”¶è¿™ä¸ªçš„äº‹ä»¶åˆ†å‘
             }
				}

        // åˆ›å»º äº‹ä»¶åˆ†å‘çš„é“¾è¡¨
        if (mFirstTouchTarget == null) {
            // No touch targets so treat this as an ordinary view.
            handled = dispatchTransformedTouchEvent(ev, canceled, null,
                    TouchTarget.ALL_POINTER_IDS);
        } else {
            // Dispatch to touch targets, excluding the new touch target if we already
            // dispatched to it.  Cancel touch targets if necessary.
            TouchTarget predecessor = null;
            TouchTarget target = mFirstTouchTarget;
            while (target != null) {
                final TouchTarget next = target.next;
                if (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) {
                    handled = true;
                } else {
                    final boolean cancelChild = resetCancelNextUpFlag(target.child)
                            || intercepted;
                    if (dispatchTransformedTouchEvent(ev, cancelChild,
                            target.child, target.pointerIdBits)) {
                        handled = true;
                    }
                    if (cancelChild) {
                        if (predecessor == null) {
                            mFirstTouchTarget = next;
                        } else {
                            predecessor.next = next;
                        }
                        target.recycle();
                        target = next;
                        continue;
                    }
                }
                predecessor = target;
                target = next;
            }
        }
    }
    return handled;
}

final int childrenCount = mChildrenCount;
      if (newTouchTarget == null &amp;&amp; childrenCount != 0) {
            final float x = ev.getX(actionIndex);
            final float y = ev.getY(actionIndex);
            // æ‰¾åˆ°èƒ½å¤„ç†è¿™ä¸ª Event çš„ å­View 
            final ArrayList&lt;View&gt; preorderedList = buildTouchDispatchChildList();
            final boolean customOrder = preorderedList == null
                    &amp;&amp; isChildrenDrawingOrderEnabled();
            final View[] children = mChildren;
            for (int i = childrenCount - 1; i &gt;= 0; i--) {
                final int childIndex = getAndVerifyPreorderedIndex(
                        childrenCount, i, customOrder);
                final View child = getAndVerifyPreorderedView(
                        preorderedList, children, childIndex);
								// åˆ¤æ–­è¿™ä¸ªå­View æ˜¯å¦èƒ½å¤„ç†è¿™ä¸ª Event
                if (!canViewReceivePointerEvents(child)
                        || !isTransformedTouchPointInView(x, y, child, null)) {
                    ev.setTargetAccessibilityFocus(false);
                    continue;
                }

                newTouchTarget = getTouchTarget(child);
                if (newTouchTarget != null) {
                    // Child is already receiving touch within its bounds.
                    // Give it the new pointer in addition to the ones it is handling.
                    newTouchTarget.pointerIdBits |= idBitsToAssign;
                    break;
                }

                resetCancelNextUpFlag(child);
								// å¾€å­Viewåšåˆ†å‘
                if (dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)) {
                    ...
										// æ­å»ºäº‹ä»¶åˆ†å‘å¤„ç†é“¾è¡¨
                    newTouchTarget = addTouchTarget(child, idBitsToAssign);
                    
                    break;
                }

                // The accessibility focus didn't handle the event, so clear
                // the flag and do a normal dispatch to all children.
                ev.setTargetAccessibilityFocus(false);
            }
            if (preorderedList != null) preorderedList.clear();
        }

        if (newTouchTarget == null &amp;&amp; mFirstTouchTarget != null) {
            // Did not find a child to receive the event.
            // Assign the pointer to the least recently added target.
            newTouchTarget = mFirstTouchTarget;
            while (newTouchTarget.next != null) {
                newTouchTarget = newTouchTarget.next;
            }
            newTouchTarget.pointerIdBits |= idBitsToAssign;
        }
    }
}

private boolean dispatchTransformedTouchEvent(MotionEvent event, boolean cancel,
            View child, int desiredPointerIdBits) {
    final boolean handled;
		...
    if (child == null) {
				// å¦‚æœå·²ç»æ²¡æœ‰å­View äº†ï¼Œè°ƒç”¨çˆ¶ç±»çš„ åˆ†å‘æ–¹æ³•ï¼Œè¿™é‡Œä¸€èˆ¬å°±ç›´æ¥è°ƒç”¨äº† View çš„åˆ†å‘æ–¹æ³•
        handled = super.dispatchTouchEvent(transformedEvent);
    } else {
				...
				// ä¼ ç»™å­View å»è¿›è¡Œåˆ†å‘
        handled = child.dispatchTouchEvent(transformedEvent);
    }
    return handled;
}
</code></pre>
<h3 id="view-ä¸­çš„äº‹ä»¶åˆ†å‘">View ä¸­çš„äº‹ä»¶åˆ†å‘</h3>
<pre><code class="language-Java">public boolean dispatchTouchEvent(MotionEvent event) {

    boolean result = false;
		// å½“å‰ View æ˜¯å¦å¯è§ æˆ–è€…æ˜¯å¦è¢«é®æŒ¡
    if (onFilterTouchEventForSecurity(event)) {
        if ((mViewFlags &amp; ENABLED_MASK) == ENABLED &amp;&amp; handleScrollBarDragging(event)) {
            result = true;
        }

        ListenerInfo li = mListenerInfo;
				// ä¼˜å…ˆå“åº” onTouchListener äº‹ä»¶
        if (li != null &amp;&amp; li.mOnTouchListener != null
                &amp;&amp; (mViewFlags &amp; ENABLED_MASK) == ENABLED
                &amp;&amp; li.mOnTouchListener.onTouch(this, event)) {
            result = true;
        }
				// onTouchListener äº‹ä»¶ è¿”å› falseï¼Œå“åº”è‡ªèº«çš„ onTouchEvent äº‹ä»¶
        if (!result &amp;&amp; onTouchEvent(event)) {
            result = true;
        }
    }

    return result;
}

public boolean onTouchEvent(MotionEvent event) {
		// åˆ¤æ–­å½“å‰View æ˜¯å¦å¯ç‚¹å‡» å¯é•¿æŒ‰ï¼Œå¦‚æœ å¯ç‚¹å‡»å¯é•¿æŒ‰çš„è¯ï¼Œæœ€ç»ˆä¸€å®š return true
    final boolean clickable = ((viewFlags &amp; CLICKABLE) == CLICKABLE
            || (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE)
            || (viewFlags &amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE;
		// æœ‰è®¾ç½®ä»£ç†èµ° ä»£ç†æ–¹æ³•
    if (mTouchDelegate != null) {
        if (mTouchDelegate.onTouchEvent(event)) {
            return true;
        }
    }

    if (clickable || (viewFlags &amp; TOOLTIP) == TOOLTIP) {
				...
				return true;
    }

    return false;
}
</code></pre>
<h3 id="action_down">ACTION_DOWN</h3>
<pre><code class="language-Java">mHasPerformedLongPress = false;

if (!clickable) {
    checkForLongClick(0, x, y);
    break;
}

// Walk up the hierarchy to determine if we're inside a scrolling container.
boolean isInScrollingContainer = isInScrollingContainer();

if (isInScrollingContainer) {
    mPrivateFlags |= PFLAG_PREPRESSED;
    if (mPendingCheckForTap == null) {
        mPendingCheckForTap = new CheckForTap();
    }
    mPendingCheckForTap.x = event.getX();
    mPendingCheckForTap.y = event.getY();
    postDelayed(mPendingCheckForTap, ViewConfiguration.getTapTimeout());
} else {
    // Not inside a scrolling container, so show the feedback right away
    setPressed(true, x, y);
    checkForLongClick(0, x, y);
}

// é€šè¿‡ Handler å‘é€ä¸€ä¸ª 500ms çš„å»¶è¿Ÿæ¶ˆæ¯ï¼Œåœ¨ CheckForLongPress run æ–¹æ³•ä¸­å°† 
// mHasPerformedLongPress æ ‡å¿—ä½è®¾ç½®ä¸º ture ä»£è¡¨é•¿æŒ‰æ–¹æ³•å·²ç»æ‰§è¡Œ
private void checkForLongClick(int delayOffset, float x, float y) {
    if ((mViewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE || (mViewFlags &amp; TOOLTIP) == TOOLTIP) {
        mHasPerformedLongPress = false;

        if (mPendingCheckForLongPress == null) {
            mPendingCheckForLongPress = new CheckForLongPress();
        }
        mPendingCheckForLongPress.setAnchor(x, y);
        mPendingCheckForLongPress.rememberWindowAttachCount();
        mPendingCheckForLongPress.rememberPressedState();
        postDelayed(mPendingCheckForLongPress,
                ViewConfiguration.getLongPressTimeout() - delayOffset);
    }
}
</code></pre>
<h3 id="action_cancel">ACTION_CANCEL</h3>
<pre><code class="language-Java">if (clickable) {
    setPressed(false);
}
// ç§»é™¤ DOWN äº‹ä»¶æ—¶ï¼Œé€šè¿‡Handlerå‘å‡ºçš„æ¶ˆæ¯ï¼Œä¸åœ¨è§¦å‘ LongClick
removeTapCallback();
removeLongPressCallback();
mInContextButtonPress = false;
mHasPerformedLongPress = false;
mIgnoreNextUpEvent = false;
mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;
</code></pre>
<h3 id="action_move">ACTION_MOVE</h3>
<pre><code class="language-Java">if (clickable) {
    drawableHotspotChanged(x, y);
}

// æ»‘åŠ¨åˆ°å¤–éƒ¨å»äº† 
if (!pointInView(x, y, mTouchSlop)) {
    // ç§»é™¤ DOWN äº‹ä»¶æ—¶ï¼Œé€šè¿‡Handlerå‘å‡ºçš„æ¶ˆæ¯ï¼Œä¸åœ¨è§¦å‘ LongClick
    removeTapCallback();
    removeLongPressCallback();
    if ((mPrivateFlags &amp; PFLAG_PRESSED) != 0) {
        setPressed(false);
    }
    mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;
}
</code></pre>
<h3 id="action_up">ACTION_UP</h3>
<pre><code class="language-Java">boolean prepressed = (mPrivateFlags &amp; PFLAG_PREPRESSED) != 0;
if ((mPrivateFlags &amp; PFLAG_PRESSED) != 0 || prepressed) {
		// å¦‚æœé•¿æŒ‰äº‹ä»¶æ²¡æœ‰å“åº”ï¼Œè¿™ä¸ªæ—¶å€™æ¥æ‰§è¡Œç‚¹å‡»äº‹ä»¶
    if (!mHasPerformedLongPress &amp;&amp; !mIgnoreNextUpEvent) {
        // ç§»é™¤ DOWN äº‹ä»¶æ—¶ï¼Œé€šè¿‡Handlerå‘å‡ºçš„æ¶ˆæ¯ï¼Œä¸åœ¨è§¦å‘ LongClick
        removeLongPressCallback();
        if (!focusTaken) {

            if (mPerformClick == null) {
                mPerformClick = new PerformClick();
            }
            if (!post(mPerformClick)) {
                performClickInternal();
            }
        }
    }
    removeTapCallback();
}
</code></pre>
<h2 id="äº‹ä»¶åˆ†å‘çš„æ•´ä½“æ¨¡å‹">äº‹ä»¶åˆ†å‘çš„æ•´ä½“æ¨¡å‹</h2>
<figure data-type="image" tabindex="1"><img src="https://caoyu.me/post-images/1608742799596.png" alt="" loading="lazy"></figure>
<h2 id="æ»‘åŠ¨äº‹ä»¶å†²çª">æ»‘åŠ¨äº‹ä»¶å†²çª</h2>
<h3 id="å¤–éƒ¨æ‹¦æˆª">å¤–éƒ¨æ‹¦æˆª</h3>
<figure data-type="image" tabindex="2"><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/789a1c01-3584-4986-a2e6-a7f157d0bfda/Untitled.png" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/789a1c01-3584-4986-a2e6-a7f157d0bfda/Untitled.png" loading="lazy"></figure>
<h3 id="å†…éƒ¨æ‹¦æˆª">å†…éƒ¨æ‹¦æˆª</h3>
<figure data-type="image" tabindex="3"><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/868f6ae1-fcdd-4f4c-b985-27c5e40516e9/Untitled.png" alt="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/868f6ae1-fcdd-4f4c-b985-27c5e40516e9/Untitled.png" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Handler]]></title>
        <id>https://caoyu.me/post/handler/</id>
        <link href="https://caoyu.me/post/handler/">
        </link>
        <updated>2020-12-23T16:55:13.000Z</updated>
        <summary type="html"><![CDATA[<blockquote>
<p>Handlerçš„æ¶ˆæ¯å¾ªç¯æ¶‰åŠçš„ç±»ï¼šHandlerï¼ŒLooperï¼ŒMessageï¼ŒMessageQueue</p>
</blockquote>
<figure data-type="image" tabindex="1"><img src="https://caoyu.me/post-images/1608742734612.jpg" alt="" loading="lazy"></figure>
]]></summary>
        <content type="html"><![CDATA[<blockquote>
<p>Handlerçš„æ¶ˆæ¯å¾ªç¯æ¶‰åŠçš„ç±»ï¼šHandlerï¼ŒLooperï¼ŒMessageï¼ŒMessageQueue</p>
</blockquote>
<figure data-type="image" tabindex="1"><img src="https://caoyu.me/post-images/1608742734612.jpg" alt="" loading="lazy"></figure>
<!-- more -->
<h3 id="åˆ›å»º">åˆ›å»º</h3>
<hr>
<ol>
<li>
<p>ActivityThread mainæ–¹æ³•ä¸­åˆ›å»º Looper</p>
<pre><code class="language-Java"> public static void main(String[] args) {
 		Looper.prepareMainLooper();
 		...
 		Looper.loop();
 }
</code></pre>
</li>
<li>
<p>Looper prepare æ–¹æ³•ä¸­ï¼Œé€šè¿‡ ThreadLocal å°† Looper å’Œ ä¸»çº¿ç¨‹è¿›è¡Œç»‘å®š</p>
<pre><code class="language-Java"> private static void prepare(boolean quitAllowed) {
     if (sThreadLocal.get() != null) {
         throw new RuntimeException(&quot;Only one Looper may be created per thread&quot;);
     }
     sThreadLocal.set(new Looper(quitAllowed));
 }
</code></pre>
</li>
<li>
<p>Looper çš„ç§æœ‰åŒ–æ„é€ æ–¹æ³•ä¸­ ç»‘å®šäº† MessageQueue</p>
<pre><code class="language-Java"> private Looper(boolean quitAllowed) {
     mQueue = new MessageQueue(quitAllowed);
     mThread = Thread.currentThread();
 }
</code></pre>
</li>
</ol>
<h3 id="å‘é€ä¸€ä¸ªmessageçš„æµç¨‹">å‘é€ä¸€ä¸ªMessageçš„æµç¨‹</h3>
<hr>
<ol>
<li>
<p>åˆå§‹åŒ–Handlerï¼Œè·å–å¹¶ç»‘å®šå½“å‰çº¿ç¨‹çš„ MessageQueue å’Œ Looperï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•ä¸­æœ‰ä¸€ä¸ªå¼‚å¸¸ï¼Œå¦‚æœæ˜¯å¼‚æ­¥çº¿ç¨‹çš„è¯éœ€è¦å…ˆè°ƒç”¨ Looper.prepare()ã€‚</p>
<pre><code class="language-Java"> public Handler(Callback callback, boolean async) {
 		...
     mLooper = Looper.myLooper();
     if (mLooper == null) {
         throw new RuntimeException(
             &quot;Can't create handler inside thread &quot; + Thread.currentThread()
                     + &quot; that has not called Looper.prepare()&quot;);
     }
     mQueue = mLooper.mQueue;
     mCallback = callback;
     ...
 }
</code></pre>
</li>
<li>
<p>å‘é€æ¶ˆæ¯æœ€ç»ˆéƒ½ä¼šè°ƒç”¨åˆ° Handler.enqueueMessage(MessageQueue, Message, updateTime) æ–¹æ³•</p>
<pre><code class="language-Java"> private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) {
     // è¿™é‡Œå°†å½“å‰çš„ Message å’Œ Handler ç»‘å®š
 		msg.target = this;
     if (mAsynchronous) {
         msg.setAsynchronous(true);
     }
     return queue.enqueueMessage(msg, uptimeMillis);
 }
</code></pre>
</li>
<li>
<p>å°†å½“å‰Message æ”¾å…¥ MessageQueueï¼Œå¦‚æœé˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯ï¼Œç›´æ¥å°†è¿™ä¸ªæ¶ˆæ¯æ”¾åœ¨é˜Ÿé¦–ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­æœ‰æ¶ˆæ¯ï¼Œæ ¹æ®è¿™ä¸ªæ¶ˆæ¯çš„æ¥æ”¶å¤„ç†æ—¶é—´ï¼Œå°†å…¶æ’å…¥åˆ°åˆé€‚çš„ä½ç½®ã€‚</p>
<pre><code class="language-Java"> boolean enqueueMessage(Message msg, long when) {
 		...
     synchronized (this) {
         if (mQuitting) {
             IllegalStateException e = new IllegalStateException(
                     msg.target + &quot; sending message to a Handler on a dead thread&quot;);
             Log.w(TAG, e.getMessage(), e);
             msg.recycle();
             return false;
         }
 
         msg.markInUse();
         msg.when = when;
         Message p = mMessages;
         boolean needWake;
         if (p == null || when == 0 || when &lt; p.when) {
             // New head, wake up the event queue if blocked.
             msg.next = p;
             mMessages = msg;
             needWake = mBlocked;
         } else {
             // Inserted within the middle of the queue.  Usually we don't have to wake
             // up the event queue unless there is a barrier at the head of the queue
             // and the message is the earliest asynchronous message in the queue.
             needWake = mBlocked &amp;&amp; p.target == null &amp;&amp; msg.isAsynchronous();
             Message prev;
             for (;;) {
                 prev = p;
                 p = p.next;
                 if (p == null || when &lt; p.when) {
                     break;
                 }
                 if (needWake &amp;&amp; p.isAsynchronous()) {
                     needWake = false;
                 }
             }
             msg.next = p; // invariant: p == prev.next
             prev.next = msg;
         }
 
         // We can assume mPtr != 0 because mQuitting is false.
         if (needWake) {
             nativeWake(mPtr);
         }
     }
     return true;
 }
</code></pre>
</li>
</ol>
<h3 id="æ¶ˆè´¹æ¶ˆæ¯">æ¶ˆè´¹æ¶ˆæ¯</h3>
<hr>
<ol>
<li>
<p>ä¸»çº¿ç¨‹åˆå§‹åŒ–çš„æ—¶å€™æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼Œå°†ä¸»çº¿ç¨‹ç»‘å®šä¸€ä¸ªLooperï¼Œç„¶åè°ƒç”¨äº† Looper.loop æ–¹æ³•è½®è¯¢æ¶ˆæ¯é˜Ÿåˆ—</p>
<pre><code class="language-Java"> public static void main(String[] args) {
 		Looper.prepareMainLooper();
 		...
 		Looper.loop();
 }
</code></pre>
</li>
<li>
<p>Looper.loop() åˆå§‹åŒ–ä¸»çº¿ç¨‹æ—¶ï¼Œå¼€å¯äº†æ¶ˆæ¯å¾ªç¯ï¼Œé€šè¿‡ MessageQueue çš„ next æ–¹æ³•è·å–ä¸‹ä¸€ä¸ªæ¶ˆæ¯ï¼Œæœ€ç»ˆè°ƒç”¨äº† msg.target.dispatchMessage(msg); å°†æ¶ˆæ¯åˆ†å‘å‡ºå»å¤„ç†ã€‚å¤„ç†ç©è¿™ä¸ªæ¶ˆæ¯åï¼Œè°ƒç”¨ msg.recycleUnchecked() è¿™ä¸ªæ–¹æ³•ï¼Œå°†å®ƒé‡æ–°æ”¾å› æ¶ˆæ¯æ±  ä¸­</p>
<pre><code class="language-Java"> public static void loop() {
     final Looper me = myLooper();
     if (me == null) {
         throw new RuntimeException(&quot;No Looper; Looper.prepare() wasn't called on this thread.&quot;);
     }
     final MessageQueue queue = me.mQueue;
     ...
     for (;;) {
         Message msg = queue.next(); // might block
         if (msg == null) {
             // No message indicates that the message queue is quitting.
             return;
         }
 				...
         try {
             msg.target.dispatchMessage(msg);
             dispatchEnd = needEndTime ? SystemClock.uptimeMillis() : 0;
         } finally {
             if (traceTag != 0) {
                 Trace.traceEnd(traceTag);
             }
         }
 				...
 				msg.recycleUnchecked();
     }
 }
</code></pre>
</li>
<li>
<p>MessageQueue ä¸­è½®è¯¢ä¸‹ä¸€ä¸ªæ¶ˆæ¯çš„æ–¹æ³•ï¼Œè¿™é‡ŒMessage æœ‰ä¸€ä¸ªå›æ”¶æ± ï¼Œåªä¼šè·å–åˆ°æœ€æ–°çš„ Messageï¼Œå°†å½“å‰çš„ Message å–å‡ºï¼Œå¹¶ä¸” next è®¾ç½®ä¸ºnullï¼ŒåŒäº‹å°† mMessages æŒ‡å‘å…¶ä¸‹ä¸€ä¸ª Messageã€‚</p>
<pre><code class="language-Java"> Message next() {
     ...
     for (;;) {
         if (nextPollTimeoutMillis != 0) {
             Binder.flushPendingCommands();
         }
 
         nativePollOnce(ptr, nextPollTimeoutMillis);
 
         synchronized (this) {
             // Try to retrieve the next message.  Return if found.
             final long now = SystemClock.uptimeMillis();
             Message prevMsg = null;
             Message msg = mMessages;
             if (msg != null &amp;&amp; msg.target == null) {
                 // Stalled by a barrier.  Find the next asynchronous message in the queue.
                 do {
                     prevMsg = msg;
                     msg = msg.next;
                 } while (msg != null &amp;&amp; !msg.isAsynchronous());
             }
             if (msg != null) {
              ...
                       if (prevMsg != null) {
                           prevMsg.next = msg.next;
                       } else {
                           mMessages = msg.next;
                       }
                       msg.next = null;
                       if (DEBUG) Log.v(TAG, &quot;Returning message: &quot; + msg);
                       msg.markInUse();
                       return msg;
               ...
               } else {
                   // No more messages.
                   nextPollTimeoutMillis = -1;
               }
 
               // Process the quit message now that all pending messages have been handled.
               if (mQuitting) {
                   dispose();
                   return null;
               }
 							...
       }
   }
</code></pre>
</li>
<li>
<p>è°ƒç”¨ msg.target.dispatchMessage(msg); å»åˆ†å‘å¤„ç†è¿™ä¸ªæ¶ˆæ¯ï¼Œå…¶ä¸­ target å°±æ˜¯ Handlerï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯ Handler çš„ dispatchMessage çš„æ–¹æ³•</p>
<pre><code class="language-Java"> public void dispatchMessage(Message msg) {
     if (msg.callback != null) {
         handleCallback(msg);
     } else {
         if (mCallback != null) {
 						// handleMessage è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½éœ€è¦ Handler å»å®ç°ï¼Œ
 						//éƒ½æ˜¯é‡å†™æ–¹æ³•ï¼Œç†è®ºä¸Šä¸ä¼šåŒæ—¶å­˜åœ¨
             if (mCallback.handleMessage(msg)) {
                 return;
             }
         }
         handleMessage(msg);
     }
 }
 
 private static void handleCallback(Message message) {
 		// callback å°±æ˜¯ Runnable è¿™ä¸ªå°±èƒ½å®ç°å­çº¿ç¨‹ Runnable ä¸­çš„ä»£ç  æœ€ç»ˆåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ
     message.callback.run();
 }
</code></pre>
</li>
</ol>
<h2 id="ä¸ºä»€ä¹ˆä¸èƒ½åœ¨å­çº¿ç¨‹åˆ›å»º-handler">ä¸ºä»€ä¹ˆä¸èƒ½åœ¨å­çº¿ç¨‹åˆ›å»º Handler</h2>
<ol>
<li>
<p>å¯ä»¥çœ‹åˆ° Handler åˆå§‹åŒ–çš„æ—¶å€™ æœ‰è¿™æ ·ä¸€å¥ä»£ç ï¼šLooper.myLooper();</p>
<pre><code class="language-Java"> public Handler(Callback callback, boolean async) {
 		...
     mLooper = Looper.myLooper();
     if (mLooper == null) {
         throw new RuntimeException(
             &quot;Can't create handler inside thread &quot; + Thread.currentThread()
                     + &quot; that has not called Looper.prepare()&quot;);
     }
     mQueue = mLooper.mQueue;
     mCallback = callback;
     ...
 }

 public static @Nullable Looper myLooper() {
     return sThreadLocal.get();
 }
</code></pre>
<p>å¹¶ä¸”åœ¨ æ¶ˆæ¯ç³»ç»Ÿåˆå§‹åŒ–çš„æ—¶å€™æœ‰è¿™æ ·ä¸€æ®µä»£ç </p>
<pre><code class="language-Java"> private static void prepare(boolean quitAllowed) {
     if (sThreadLocal.get() != null) {
         throw new RuntimeException(&quot;Only one Looper may be created per thread&quot;);
     }
     sThreadLocal.set(new Looper(quitAllowed));
 }
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥çŸ¥é“ sThreadLocal æ˜¯ ThreadLocal çš„ä¸€ä¸ªå®ä¾‹ï¼Œä»–å®é™…ä¸Šæ˜¯ä¸€ä¸ª Mapï¼ŒThread ä½œä¸ºå®ƒçš„ Keyï¼ŒLooper ä½œä¸ºä»–çš„ valueã€‚</p>
<p>å…¶ä¸­ Thread æ˜¯é€šè¿‡ Thread.currentThread() è·å–çš„ï¼Œç›´æ¥åœ¨å­çº¿ç¨‹ä¸­åˆ›å»ºHandlerï¼Œè°ƒç”¨äº† sThreadLocal.get() çš„æ–¹æ³•ï¼Œæ­¤æ—¶è¿”å›çš„ä¸€å®šä¸º nullï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚æ‰€ä»¥éœ€è¦å…ˆè°ƒç”¨ Looper.prepare() æ–¹æ³•ï¼Œç»™å½“å‰çº¿ç¨‹åˆ›å»ºä¸€ä¸ª Looperã€‚</p>
<p>å…¶ä¸­ Thread ä¸­ç»´æŠ¤äº†ä¸€ä¸ª ThreadLocalMapï¼Œæ¯æ¬¡åˆ›å»ºçš„ ThreadLocalMapï¼Œæœ€ç»ˆæ˜¯è¢« Thread æŒæœ‰çš„ï¼ŒçœŸæ­£çš„ Key value å­˜ThreadLocalMapé‡Œï¼Œè€Œä¸”è¿™ä¸ª çš„ key æ˜¯é€šè¿‡ä¸€ä¸ªå¼±å¼•ç”¨æŒæœ‰çš„ï¼Œæ‰€ä»¥å½“å‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œå›æ”¶å°±å›æ”¶äº†ï¼Œä¸ä¼šç»§ç»­æŒæœ‰å½“å‰çš„ Threadï¼Œä¸ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚ThreadLocalåªæ˜¯ Thread å’Œ ThreadLocalMap çš„æ“ä½œç±»ã€‚</p>
</li>
</ol>
<h2 id="viewpost-å’Œ-handlerpost-çš„åŒºåˆ«">View.post å’Œ Handler.post çš„åŒºåˆ«</h2>
<p>textView.setText åªèƒ½åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œä¹ˆ</p>
<p>ThreadLocal çš„ç”¨æ³•å’ŒåŸç†</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>https://caoyu.me/post/hello-gridea/</id>
        <link href="https://caoyu.me/post/hello-gridea/">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="http://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>