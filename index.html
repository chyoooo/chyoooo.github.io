<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="keywords" content="Grideaé™æ€ä¸ªäººåšå®¢">
<meta name="description" content="æ¸©æ•…è€ŒçŸ¥æ–°">
<meta name="theme-color" content="#000">
<title>Choor&#39;s Blog</title>
<link rel="shortcut icon" href="/favicon.ico?v=1608905509391">
<link rel="stylesheet" href="/styles/main.css">
<link rel="stylesheet" href="/media/css/pisces.css">

<link rel="stylesheet" href="/media/fonts/font-awesome.css">
<link
  href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
  rel="stylesheet" type="text/css">

<link href="/media/hljs/styles/androidstudio.css"
  rel="stylesheet">

<script src="/media/hljs/highlight.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.ui.min.js"></script>

<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>



</head>

<body>
  <div class="head-top-line"></div>
  <div class="header-box">
    
<div class="pisces">
  <header class="header  ">
    <div class="blog-header box-shadow-wrapper bg-color " id="header">
      <div class="nav-toggle" id="nav_toggle">
        <div class="toggle-box">
          <div class="line line-top"></div>
          <div class="line line-center"></div>
          <div class="line line-bottom"></div>
        </div>
      </div>
      <div class="site-meta">       
        <div class="site-title">
          
            <a href="/" class="brand">
              <span>Choor&#39;s Blog</span>
            </a>  
          
        </div>
        
          <p class="subtitle">æ¸©æ•…è€ŒçŸ¥æ–°</p>
        
      </div>
      <nav class="site-nav" id="site_nav">
        <ul id="nav_ul">
          
            
            
              
            
            <li class="nav-item nav-item-active">
              
              
                <a href="/" target="_self">
                  <i class="fa fa-home"></i> é¦–é¡µ
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/archives/" target="_self">
                  <i class="fa fa-archive"></i> å½’æ¡£
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/tags/" target="_self">
                  <i class="fa fa-tags"></i> æ ‡ç­¾
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/post/about/" target="_self">
                  <i class="fa fa-user"></i> å…³äº
                </a>
              
            </li>
          
          
            
              <li class="nav-item ">
                <a href="/friends/" target="_self">
                  
                    <i class="fa fa-address-book"></i> å‹é“¾
                  
                </a>
              </li>
            
          
        </ul>
      </nav>
    </div>
  </header>
</div>

<script type="text/javascript"> 
 
  let showNav = true;

  let navToggle = document.querySelector('#nav_toggle'),
  siteNav = document.querySelector('#site_nav');
  
  function navClick() {
    let sideBar = document.querySelector('.sidebar');
    let navUl = document.querySelector('#nav_ul');
    navToggle.classList.toggle('nav-toggle-active');
    siteNav.classList.toggle('nav-menu-active');
    if (siteNav.classList.contains('nav-menu-active')) {
      siteNav.style = "height: " + (navUl.children.length * 42) +"px !important";
    } else {
      siteNav.style = "";
    }
  }

  navToggle.addEventListener('click',navClick);  
</script>
  </div>
  <div class="main-continer">
    
    <div
      class="section-layout pisces ">
      <div class="section-layout-wrapper">
        <div id="sidebarMeta" class="sidebar">
    
<div class="sidebar-wrapper box-shadow-wrapper bg-color">
  <div class="sidebar-item">
    <img class="site-author-image right-motion" src="/images/avatar.png"/>
    <p class="site-author-name">Choor</p>
    
  </div>
  <div class="sidebar-item side-item-stat right-motion">
    <div class="sidebar-item-box">
      <a href="/archives/">
        
        <span class="site-item-stat-count">4</span>
        <span class="site-item-stat-name">æ–‡ç« </span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="">
        <span class="site-item-stat-count">2</span>
        <span class="site-item-stat-name">åˆ†ç±»</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="/tags/">
        <span class="site-item-stat-count">2</span>
        <span class="site-item-stat-name">æ ‡ç­¾</span>
      </a>
    </div>
  </div>
  
    
      <div class="sidebar-item" style="border-top: 1px dotted #ccc; margin-top: 10px;">
      </div>
    
  
  


</div>
</div>
<script>
  let sidebarMeta = document.querySelector('#sidebarMeta');
  let scheme = 'pisces';
  let sidebarWrapper = document.querySelector('.sidebar-wrapper');
  if (sidebarMeta && (scheme === 'pisces' || scheme === 'gemini')) {
    document.addEventListener('scroll', function(e) {
      if (document.scrollingElement.scrollTop > parseInt(sidebarMeta.style.marginTop) + 10) {
        sidebarWrapper.classList.add('home-sidebar-fixed')
      } else {
        sidebarWrapper.classList.remove('home-sidebar-fixed')
      }
    });
  }
  </script>
        <div class="section-box pisces">
          <section class="section bg-color posts-expand slide-down-in">
            
  <article class="post-list-box  post box-shadow-wrapper">
    <div class="article-wrapper bg-color">
      <header class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://caoyu.me/post/ui-hui-zhi-liu-cheng-cong-setcontentview-shuo-qi/">
      UIç»˜åˆ¶æµç¨‹-ä»setContentViewè¯´èµ·
    </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span>å‘å¸ƒäº</span>
      <span>2020-12-24</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-folder-o"></i>
      <span class="pc-show">åˆ†ç±»äº</span>
      
      
      <a href="https://caoyu.me/tag/android/">
        <span>Android</span>
      </a>
      
      
    </span>
    <span class="post-meta-divider">|</span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span>9åˆ†é’Ÿ</span>
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span>1945<span class="pc-show">å­—æ•°</span></span>
    </span>
    
  </div>
</header>
      <div class="post-body">
        
        
          <blockquote>
<p>å¹³æ—¶æˆ‘ä»¬åœ¨å†™ <code>Android</code> <code>UI</code> æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šé€šè¿‡ <code>setContentVoew</code> æ–¹æ³•ï¼Œå°†æˆ‘ä»¬çš„å¸ƒå±€èµ„æºäº¤ç»™ <code>Activity</code>ï¼Œè®©å®ƒå»è¿›è¡Œå…³è” <code>window</code>ï¼Œè§£æ <code>å¸ƒå±€</code>ï¼Œæ¸²æŸ“ <code>è§†å›¾</code> ï¼Œæœ€ç»ˆåœ¨å±å¹•ä¸Šå±•ç°å‡ºäº†æˆ‘ä»¬éœ€è¦çš„æ•ˆæœã€‚ä¸Šä¸€èŠ‚æˆ‘ä»¬åˆ†æäº† <code>Activity</code> çš„å¯åŠ¨æµç¨‹ï¼ŒçŸ¥é“äº†æ–° <code>Activity</code> æœ€ç»ˆéƒ½ä¼šé€šè¿‡ <code>AMS</code> å’Œ <code>ClientLifecycleManager</code> çš„ç›¸äº’è°ƒåº¦ä¾æ¬¡æ‰§è¡Œ <code>attach</code> ã€<code>performCreate</code>ã€<code>performStart</code> å’Œ <code>performResume</code> çš„å››ä¸ªæ–¹æ³•ï¼Œä¸‹é¢æˆ‘ä»¬å°±æŒ‰ç…§è¿™ä¸ªæµç¨‹æ¥èŠèŠå¸ƒå±€çš„ <code>ç»‘å®š</code>ã€ <code>è§£æ</code> å’Œ <code>æ¸²æŸ“</code> çš„æµç¨‹ã€‚</p>
<p>é™„ï¼š<a href="https://blog.cyulv.com/archives/ui-startactivity/">Activity çš„å¯åŠ¨æµç¨‹</a></p>
</blockquote>

        
        
        <div class="post-button text-center">
          <a class="btn" href="https://caoyu.me/post/ui-hui-zhi-liu-cheng-cong-setcontentview-shuo-qi/" rel="contents">
            é˜…è¯»å…¨æ–‡ Â»
          </a>
        </div>
        
      </div>
      
        <footer class="post-footer">
          <div class="post-eof"></div>
        </footer>
      
    </div>
  </article>

  <article class="post-list-box  post box-shadow-wrapper">
    <div class="article-wrapper bg-color">
      <header class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://caoyu.me/post/shi-jian-fen-fa/">
      äº‹ä»¶åˆ†å‘
    </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span>å‘å¸ƒäº</span>
      <span>2020-12-24</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-folder-o"></i>
      <span class="pc-show">åˆ†ç±»äº</span>
      
      
      <a href="https://caoyu.me/tag/android/">
        <span>Android</span>
      </a>
      
      
    </span>
    <span class="post-meta-divider">|</span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span>8åˆ†é’Ÿ</span>
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span>1677<span class="pc-show">å­—æ•°</span></span>
    </span>
    
  </div>
</header>
      <div class="post-body">
        
        
          <h2 id="è§¦æ‘¸äº‹ä»¶ç±»å‹">è§¦æ‘¸äº‹ä»¶ç±»å‹</h2>
<p>è§¦æ‘¸äº‹ä»¶å¯¹åº”çš„ç±»æ˜¯ MotionEvent ç±»ï¼Œäº‹ä»¶çš„ä¸»è¦ç±»å‹æœ‰ä»¥ä¸‹å››ç§ï¼š</p>
<ul>
<li>ACTION_DOWN æ‰‹æŒ‡åˆšæ¥è§¦å±å¹•</li>
<li>ACTION_MOVE æ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ»‘åŠ¨</li>
<li>ACTION_UP æ‰‹æŒ‡ä»å±å¹•ä¸ŠæŠ¬èµ·</li>
<li>ACTION_CANCEL éäººä¸ºå› ç´ å–æ¶ˆÃŸ</li>
</ul>

        
        
        <div class="post-button text-center">
          <a class="btn" href="https://caoyu.me/post/shi-jian-fen-fa/" rel="contents">
            é˜…è¯»å…¨æ–‡ Â»
          </a>
        </div>
        
      </div>
      
        <footer class="post-footer">
          <div class="post-eof"></div>
        </footer>
      
    </div>
  </article>

  <article class="post-list-box  post box-shadow-wrapper">
    <div class="article-wrapper bg-color">
      <header class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://caoyu.me/post/handler/">
      Handler
    </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span>å‘å¸ƒäº</span>
      <span>2020-12-24</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-folder-o"></i>
      <span class="pc-show">åˆ†ç±»äº</span>
      
      
      <a href="https://caoyu.me/tag/android/">
        <span>Android</span>
      </a>
      
      
    </span>
    <span class="post-meta-divider">|</span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span>7åˆ†é’Ÿ</span>
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span>1316<span class="pc-show">å­—æ•°</span></span>
    </span>
    
  </div>
</header>
      <div class="post-body">
        
        
          <blockquote>
<p>Handlerçš„æ¶ˆæ¯å¾ªç¯æ¶‰åŠçš„ç±»ï¼šHandlerï¼ŒLooperï¼ŒMessageï¼ŒMessageQueue</p>
</blockquote>
<figure data-type="image" tabindex="1"><img src="https://caoyu.me/post-images/1608742734612.jpg" alt="" loading="lazy"></figure>

        
        
        <div class="post-button text-center">
          <a class="btn" href="https://caoyu.me/post/handler/" rel="contents">
            é˜…è¯»å…¨æ–‡ Â»
          </a>
        </div>
        
      </div>
      
        <footer class="post-footer">
          <div class="post-eof"></div>
        </footer>
      
    </div>
  </article>

  <article class="post-list-box  post box-shadow-wrapper">
    <div class="article-wrapper bg-color">
      <header class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://caoyu.me/post/hello-gridea/">
      Hello Gridea
    </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span>å‘å¸ƒäº</span>
      <span>2018-12-12</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-folder-o"></i>
      <span class="pc-show">åˆ†ç±»äº</span>
      
      
      <a href="https://caoyu.me/tag/PbiORCDOn/">
        <span>Gridea</span>
      </a>
      
      
    </span>
    <span class="post-meta-divider">|</span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span>2åˆ†é’Ÿ</span>
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span>298<span class="pc-show">å­—æ•°</span></span>
    </span>
    
  </div>
</header>
      <div class="post-body">
        
        
          <p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>

        
        
        <div class="post-button text-center">
          <a class="btn" href="https://caoyu.me/post/hello-gridea/" rel="contents">
            é˜…è¯»å…¨æ–‡ Â»
          </a>
        </div>
        
      </div>
      
        <footer class="post-footer">
          <div class="post-eof"></div>
        </footer>
      
    </div>
  </article>
  
            
            
<div class="page bg-color">
  <ul class="pagination-ul">
    
    
      
        <li class="pagination-li pagination-active">
            <a href="/page/../">
              1
            </a>
        </li>
      
    
    
  </ul>
</div>
          </section>
        </div>
      </div>
    </div>
    <div class="footer-box">
  <footer class="footer">
    <div class="copyright">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | Â© 2019-2020 Theme By <a href="https://github.com/hsxyhao/gridea-theme-next" target="_blank">HsxyHao</a>
    </div>
    <div class="poweredby">
      
    </div>
  </footer>
  
  
  <div class="pisces back-to-top" id="back_to_top">
    <i class="fa fa-arrow-up"></i>
    
    <span class="scrollpercent">
      <span id="back_to_top_text">0</span>%
    </span>
    
  </div>
  
    <div class="bg-img">
      <img src="/media/images/custom-bgImg.jpeg" />
    </div>
  
  
  
</div>
<script>

  let sideBarOpen = 'sidebar-open';
  let body = document.body;
  let back2Top = document.querySelector('#back_to_top'),
  back2TopText = document.querySelector('#back_to_top_text'),
  drawerBox = document.querySelector('#drawer_box'),
  rightSideBar = document.querySelector('.sidebar'),
  viewport = document.querySelector('body');

  function scrollAnimation(currentY, targetY) {
   
    let needScrollTop = targetY - currentY
    let _currentY = currentY
    setTimeout(() => {
      const dist = Math.ceil(needScrollTop / 10)
      _currentY += dist
      window.scrollTo(_currentY, currentY)
      if (needScrollTop > 10 || needScrollTop < -10) {
        scrollAnimation(_currentY, targetY)
      } else {
        window.scrollTo(_currentY, targetY)
      }
    }, 1)
  }

  back2Top.addEventListener("click", function(e) {
    scrollAnimation(document.scrollingElement.scrollTop, 0);
    e.stopPropagation();
    return false;
  });
  
  window.addEventListener('scroll', function(e) {
    let percent = document.scrollingElement.scrollTop / (document.scrollingElement.scrollHeight - document.scrollingElement.clientHeight) * 100;
    if (percent > 1 && !back2Top.classList.contains('back-top-active')) {
      back2Top.classList.add('back-top-active');
    }
    if (percent == 0) {
      back2Top.classList.remove('back-top-active');
    }
    if (back2TopText) {
      back2TopText.textContent = Math.floor(percent);
    }
  });

  
  let hasCacu = false;
  window.onresize = function() {
    if (window.width > 991) {
      calcuHeight();
    } else {
      hasCacu = false;
    }
  }

  function calcuHeight() {
    // åŠ¨æ€è°ƒæ•´ç«™ç‚¹æ¦‚è§ˆé«˜åº¦
    if (!hasCacu && back2Top.classList.contains('pisces') || back2Top.classList.contains('gemini')) {
      let sideBar = document.querySelector('.sidebar');
      let navUl = document.querySelector('#site_nav');
      sideBar.style = 'margin-top:' + (navUl.offsetHeight + navUl.offsetTop + 15) + 'px;';
      hasCacu = true;
    }
  }
  calcuHeight();
  
  let open = false, MOTION_TIME = 300, RIGHT_MOVE_DIS = '320px';

  if (drawerBox) {
    let rightMotions = document.querySelectorAll('.right-motion');
    let right = drawerBox.classList.contains('right');

    let transitionDir = right ? "transition.slideRightIn" : "transition.slideLeftIn";

    let openProp, closeProp;
    if (right) {
      openProp = {
        paddingRight: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingRight: '0px'
      };
    } else {
      openProp = {
        paddingLeft: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingLeft: '0px'
      };
    }

    drawerBox.onclick = function() {
      open = !open;
      window.Velocity(rightSideBar, 'stop');
      window.Velocity(viewport, 'stop');
      window.Velocity(rightMotions, 'stop');
      if (open) {
        window.Velocity(rightSideBar, {
          width: RIGHT_MOVE_DIS
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, transitionDir,{ });
          }
        })
        window.Velocity(viewport, openProp,{
          duration: MOTION_TIME
        });
      } else {
        window.Velocity(rightSideBar, {
          width: '0px'
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, {
              opacity: 0
            });
          }
        })
        window.Velocity(viewport, closeProp ,{
          duration: MOTION_TIME
        });
      }
      for (let i = 0; i < drawerBox.children.length; i++) {
        drawerBox.children[i].classList.toggle('muse-line');
      }
      drawerBox.classList.toggle(sideBarOpen);
    }
  }

  // é“¾æ¥è·³è½¬
  let newWindow = 'true'
  if (newWindow === 'true') {
    let links = document.querySelectorAll('.post-body a')
    links.forEach(item => {
      if (!item.classList.contains('btn')) {
        item.setAttribute("target","_blank");
      }
    })
  }
  // ä»£ç é«˜äº®
  hljs.initHighlightingOnLoad();

</script>
    <div class="light-box" id="light_box"></div>
<script>
  let imgs = document.querySelectorAll('.post-body img');
  let lightBox = document.querySelector('#light_box');
  lightBox.addEventListener('mousedown', (e) => {
    e.preventDefault()
  })
  lightBox.addEventListener('mousewheel', (e) => {
    e.preventDefault()
  })
  let width = window.innerWidth * 0.8;
  lightBox.onclick = () => {
    let img = lightBox.querySelector('img');
    lightBox.style = '';
    img && img.remove();
  }
  imgs.forEach(item => {
    item.onclick = function (e) {
      let lightImg = document.createElement('img');
      lightImg.src = this.src;
      lightBox.style = `height: 100%; opacity: 1; background-color: rgba(0, 0, 0, 0.5);cursor: zoom-out;`;
      lightImg.style = `width: ${width}px; border: 1px solid #fff; border-radius: 2px;`;
      lightImg.onclick = function () {
        lightBox.style = '';
        this.remove();
      }
      lightBox.append(lightImg);
    }
  })
</script>
  </div>
</body>
<input hidden id="copy" />
<script>
  //æ‹¿æ¥ä¸»ä¹‰(çœŸé¦™)^_^ï¼ŒClipboard å®ç°æ‘˜è‡ªæ˜é‡‘ https://juejin.im/post/5aefeb6e6fb9a07aa43c20af
  window.Clipboard = (function (window, document, navigator) {
    var textArea,
      copy;

    // åˆ¤æ–­æ˜¯ä¸æ˜¯iosç«¯
    function isOS() {
      return navigator.userAgent.match(/ipad|iphone/i);
    }
    //åˆ›å»ºæ–‡æœ¬å…ƒç´ 
    function createTextArea(text) {
      textArea = document.createElement('textArea');
      textArea.value = text;
      textArea.style.width = 0;
      textArea.style.height = 0;
      textArea.clientHeight = 0;
      textArea.clientWidth = 0;
      document.body.appendChild(textArea);
    }
    //é€‰æ‹©å†…å®¹
    function selectText() {
      var range,
        selection;

      if (isOS()) {
        range = document.createRange();
        range.selectNodeContents(textArea);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        textArea.setSelectionRange(0, 999999);
      } else {
        textArea.select();
      }
    }

    //å¤åˆ¶åˆ°å‰ªè´´æ¿
    function copyToClipboard() {
      try {
        document.execCommand("Copy")
      } catch (err) {
        alert("å¤åˆ¶é”™è¯¯ï¼è¯·æ‰‹åŠ¨å¤åˆ¶ï¼")
      }
      document.body.removeChild(textArea);
    }

    copy = function (text) {
      createTextArea(text);
      selectText();
      copyToClipboard();
    };

    return {
      copy: copy
    };
  })(window, document, navigator);

  function copyCode(e) {
    if (e.srcElement.tagName === 'SPAN' && e.srcElement.classList.contains('copy-code')) {
      let code = e.currentTarget.querySelector('code');
      var text = code.innerText;
      if (e.srcElement.textContent === 'å¤åˆ¶æˆåŠŸ') {
        console.log('å¤åˆ¶æ“ä½œé¢‘ç‡è¿‡é«˜');
        return;
      }
      e.srcElement.textContent = 'å¤åˆ¶æˆåŠŸ';
      (function (elem) {
        setTimeout(() => {
          if (elem.textContent === 'å¤åˆ¶æˆåŠŸ') {
            elem.textContent = 'å¤åˆ¶ä»£ç '
          }
        }, 1000);
      })(e.srcElement)
      Clipboard.copy(text);
    }
  }

  let pres = document.querySelectorAll('pre');
  pres.forEach(pre => {
    let code = pre.querySelector('code');
    let copyElem = document.createElement('span');
    copyElem.classList.add('copy-code');
    copyElem.textContent = 'å¤åˆ¶ä»£ç ';
    pre.appendChild(copyElem);
    pre.onclick = copyCode
  })
</script>
<script src="/media/js/motion.js"></script>

<script src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
<script>
  var scroll = new SmoothScroll('a[href*="#"]', {
    speed: 500
  });
</script>

<!-- <div class="search-mask" id="search_mask">
  <div class="search-box">
    <div class="search-title">
      <i class="fa fa-search"></i>
      <div class="input-box">
        <input type="text" placeholder="æœç´¢">
      </div>
      <i class="fa fa-times-circle"></i>
    </div>
    <div class="result">
      
      <div class="item">
        <a class="result-title" href="https://caoyu.me/post/ui-hui-zhi-liu-cheng-cong-setcontentview-shuo-qi/" data-c="
          &lt;blockquote&gt;
&lt;p&gt;å¹³æ—¶æˆ‘ä»¬åœ¨å†™ &lt;code&gt;Android&lt;/code&gt; &lt;code&gt;UI&lt;/code&gt; æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šé€šè¿‡ &lt;code&gt;setContentVoew&lt;/code&gt; æ–¹æ³•ï¼Œå°†æˆ‘ä»¬çš„å¸ƒå±€èµ„æºäº¤ç»™ &lt;code&gt;Activity&lt;/code&gt;ï¼Œè®©å®ƒå»è¿›è¡Œå…³è” &lt;code&gt;window&lt;/code&gt;ï¼Œè§£æ &lt;code&gt;å¸ƒå±€&lt;/code&gt;ï¼Œæ¸²æŸ“ &lt;code&gt;è§†å›¾&lt;/code&gt; ï¼Œæœ€ç»ˆåœ¨å±å¹•ä¸Šå±•ç°å‡ºäº†æˆ‘ä»¬éœ€è¦çš„æ•ˆæœã€‚ä¸Šä¸€èŠ‚æˆ‘ä»¬åˆ†æäº† &lt;code&gt;Activity&lt;/code&gt; çš„å¯åŠ¨æµç¨‹ï¼ŒçŸ¥é“äº†æ–° &lt;code&gt;Activity&lt;/code&gt; æœ€ç»ˆéƒ½ä¼šé€šè¿‡ &lt;code&gt;AMS&lt;/code&gt; å’Œ &lt;code&gt;ClientLifecycleManager&lt;/code&gt; çš„ç›¸äº’è°ƒåº¦ä¾æ¬¡æ‰§è¡Œ &lt;code&gt;attach&lt;/code&gt; ã€&lt;code&gt;performCreate&lt;/code&gt;ã€&lt;code&gt;performStart&lt;/code&gt; å’Œ &lt;code&gt;performResume&lt;/code&gt; çš„å››ä¸ªæ–¹æ³•ï¼Œä¸‹é¢æˆ‘ä»¬å°±æŒ‰ç…§è¿™ä¸ªæµç¨‹æ¥èŠèŠå¸ƒå±€çš„ &lt;code&gt;ç»‘å®š&lt;/code&gt;ã€ &lt;code&gt;è§£æ&lt;/code&gt; å’Œ &lt;code&gt;æ¸²æŸ“&lt;/code&gt; çš„æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;é™„ï¼š&lt;a href=&#34;https://blog.cyulv.com/archives/ui-startactivity/&#34;&gt;Activity çš„å¯åŠ¨æµç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- more --&gt;
&lt;h2 id=&#34;windowçš„åˆ›å»º&#34;&gt;Windowçš„åˆ›å»º&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;Activity&lt;/code&gt; çš„åˆ›å»ºåŒæ—¶ä¼´éšç€ &lt;code&gt;Window&lt;/code&gt; çš„åˆ›å»ºï¼Œå¹¶ä¸”ä¸ºå…¶äºŒè€…å»ºç«‹ç›¸åº”çš„è”ç³»ã€‚åœ¨ &lt;code&gt;Android&lt;/code&gt; ä¸­ &lt;code&gt;PhoneWindow&lt;/code&gt; æ˜¯ &lt;code&gt;Window&lt;/code&gt; çš„å”¯ä¸€å®ç°ç±»ï¼Œç³»ç»Ÿå®ä¾‹åŒ–çš„Windowå¯¹è±¡å®é™…æ˜¯å®ƒã€‚åœ¨å…¶ä¹‹ä¸Šä¼šåˆ›å»º &lt;code&gt;DecorView&lt;/code&gt;ï¼Œå®ƒæ˜¯çª—å£çš„è§†å›¾çš„å…·ä½“è½½ä½“ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¹³æ—¶è¯´çš„æ ¹å¸ƒå±€ã€‚é€šå¸¸æˆ‘ä»¬é€šè¿‡ &lt;code&gt;setContentView&lt;/code&gt; æ–¹æ³•è®¾ç½®æˆ‘ä»¬è‡ªå·±çš„è§†å›¾å¸ƒå±€ï¼Œå®ƒä¼šè¢«æ·»åŠ åˆ° &lt;code&gt;DecorView&lt;/code&gt; ä¸­çš„ä¸€ä¸ªå«åš &lt;code&gt;ContentParent&lt;/code&gt; çš„å­View ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹çœ‹ Window çš„å®ä¾‹åŒ–è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;final void attach(Context context, ActivityThread aThread,
            Instrumentation instr, IBinder token, int ident,
            Application application, Intent intent, ActivityInfo info,
            CharSequence title, Activity parent, String id,
            NonConfigurationInstances lastNonConfigurationInstances,
            Configuration config, String referrer, IVoiceInteractor voiceInteractor,
            Window window, ActivityConfigCallback activityConfigCallback, IBinder assistToken) {
        attachBaseContext(context);

        mFragments.attachHost(null /*parent*/);
		// ä»£ç  1
        mWindow = new PhoneWindow(this, window, activityConfigCallback);
        mWindow.setWindowControllerCallback(this);
        mWindow.setCallback(this);
        mWindow.setOnWindowDismissedCallback(this);
        mWindow.getLayoutInflater().setPrivateFactory(this);
    
    	
        if (info.softInputMode != WindowManager.LayoutParams.SOFT_INPUT_STATE_UNSPECIFIED) {
            mWindow.setSoftInputMode(info.softInputMode);
        }
        if (info.uiOptions != 0) {
            mWindow.setUiOptions(info.uiOptions);
        }
    
    	// ä»£ç  2
        mUiThread = Thread.currentThread();

        mMainThread = aThread;
        mInstrumentation = instr;
        mToken = token;
        mAssistToken = assistToken;
        mIdent = ident;
        mApplication = application;
        mIntent = intent;
        mReferrer = referrer;
        mComponent = intent.getComponent();
        mActivityInfo = info;
        mTitle = title;
        mParent = parent;
        mEmbeddedID = id;
        mLastNonConfigurationInstances = lastNonConfigurationInstances;
        if (voiceInteractor != null) {
            if (lastNonConfigurationInstances != null) {
                mVoiceInteractor = lastNonConfigurationInstances.voiceInteractor;
            } else {
                mVoiceInteractor = new VoiceInteractor(voiceInteractor, this, this,
                        Looper.myLooper());
            }
        }

    	// ä»£ç  3
        mWindow.setWindowManager(
                (WindowManager)context.getSystemService(Context.WINDOW_SERVICE),
                mToken, mComponent.flattenToString(),
                (info.flags &amp;amp; ActivityInfo.FLAG_HARDWARE_ACCELERATED) != 0);
        if (mParent != null) {
            mWindow.setContainer(mParent.getWindow());
        }
        mWindowManager = mWindow.getWindowManager();
        mCurrentConfig = config;

        mWindow.setColorMode(info.colorMode);

        setAutofillOptions(application.getAutofillOptions());
        setContentCaptureOptions(application.getContentCaptureOptions());
    }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸Šè¿°ä»£ç æ˜¯ Activity çš„ attach æ–¹æ³•ï¼Œå®ƒæ˜¯ Activity è¢«å®ä¾‹åŒ–åï¼Œç¬¬ä¸€ä¸ªæ‰§è¡Œçš„æ–¹æ³•ï¼ˆæºç  ActivityThread#performLaunchActivity æ–¹æ³•ä¸­ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ®µä»£ç ä¸»è¦å®Œæˆäº†ä»¥ä¸‹å·¥ä½œï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;mWindow çš„åˆ›å»ºï¼Œå¹¶ä¸”å’Œå®ƒå»ºç«‹ç›¸åº”çš„è”ç³»ï¼Œå„ç§ callback è®¾ç½®æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;ç»™ Activity è®¾ç½®åˆå§‹åŒ–å‚æ•°ï¼Œæ¯”å¦‚ Intentã€UIThreadã€Applicationç­‰ã€‚&lt;/li&gt;
&lt;li&gt;ç»™ mWindow è®¾ç½®ä¸€ä¸ª WindowManagerï¼Œåœ¨ Androidä¸­åŸºæœ¬ä¸Šæ‰€æœ‰çš„ View éƒ½æ˜¯é€šè¿‡ Window æ¥å‘ˆç°çš„ï¼Œæ¯”å¦‚ Activityã€Dialogã€Toastç­‰.&lt;/li&gt;
&lt;li&gt;https://download.seafile.com/d/6e5297246c/files/?p=%2Fpro%2Fseafile-pro-server_7.0.9_x86-64.tar.gz&amp;amp;dl=1&lt;/li&gt;
&lt;li&gt;https://download.seafile.com/d/6e5297246c/files/?p=%2Fpro%2Fseafile-pro-server_7.0.9_x86-64.tar.gz.md5.txt&amp;amp;dl=1&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;appcompatactivity-çš„å§”æ‰˜ç±»&#34;&gt;AppCompatActivity çš„å§”æ‰˜ç±»&lt;/h2&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬ç¬¬ä¸€æ­¥è¿½è¸ª setContentView ä¸­çš„æ—¶å€™ï¼Œæˆ‘ä»¬å‘ç°äº†è¿™æ ·çš„ä¸€æ®µä»£ç &lt;/p&gt;
&lt;h3 id=&#34;ä»£ç -ç‰‡æ®µ1&#34;&gt;ä»£ç  ç‰‡æ®µ1&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;  @Override
  public void setContentView(@LayoutRes int layoutResID) {
    getDelegate().setContentView(layoutResID);
  }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä»–æ˜¯é€šè¿‡æ–°å»ºäº†ä¸€ä¸ª AppCompatDelegate è¿™ä¸ªç±»æ¥é—´æ¥è°ƒç”¨ &lt;code&gt;setContentView&lt;/code&gt; çš„æ–¹æ³•ï¼Œç»§ç»­è¿½ä¸‹å»æˆ‘ä»¬å‘ç° AppCompatDelegate åªæœ‰ä¸€ä¸ªå®ç°ç±» AppCompatDelegateImplï¼ˆè¿™é‡Œè¯´æ˜ä¸‹ï¼Œç¬”è€…æ¢ç©¶çš„æºç æ˜¯ androidXçš„ç‰ˆæœ¬ï¼Œå¦‚æœæ˜¯ support åŒ…ä¸‹çš„ï¼ŒAppCompatDelegate çš„å®ç°ç±»æœ‰å¤šä¸ªï¼Œä¼šæ ¹æ® &lt;code&gt;Build.VERSION&lt;/code&gt; æ¥åˆ¤æ–­å…·ä½“å®ä¾‹åŒ–å“ªä¸ªå®ç°ç±»ï¼‰ã€‚&lt;br&gt;
æˆ‘ä»¬æ¥çœ‹çœ‹ä»–çš„å…·ä½“å®ç°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä»£ç -ç‰‡æ®µ2&#34;&gt;ä»£ç  ç‰‡æ®µ2&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;@Override
public void setContentView(View v, ViewGroup.LayoutParams lp) {
  // SubDecorView
  ensureSubDecor();
  // ContentView é€šè¿‡ mSubDecor æ‰¾åˆ°
  ViewGroup contentParent = (ViewGroup) mSubDecor.findViewById(android.R.id.content);
  contentParent.removeAllViews();
  // è£…è½½æˆ‘ä»¬å®šä¹‰çš„å¸ƒå±€
  contentParent.addView(v, lp);
  mOriginalWindowCallback.onContentChanged();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç»§ç»­çœ‹ &lt;code&gt;ensureSubDecor()&lt;/code&gt; æ–¹æ³•&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;private void ensureSubDecor() {
    if (!mSubDecorInstalled) {
        // åˆ›å»º DecorView
        mSubDecor = createSubDecor();
        ...
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç»§ç»­çœ‹ &lt;code&gt;createSubDecor()&lt;/code&gt; æ–¹æ³•&lt;/p&gt;
&lt;h3 id=&#34;ä»£ç -ç‰‡æ®µ3&#34;&gt;ä»£ç  ç‰‡æ®µ3&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;private ViewGroup createSubDecor() {çš„
    ...
    // è¿™ä¸€æ®µæ˜¯ æ ¹æ®è·å–å½“å‰Activityçš„styleå¹¶è®¾ç½®ç›¸å…³çš„é£æ ¼çš„ä»£ç 

    // Now let&#39;s make sure that the Window has installed its decor by retrieving it
    mWindow.getDecorView();

    final LayoutInflater inflater = LayoutInflater.from(mContext);
    ViewGroup subDecor = null;

    // æ ¹æ®ç›¸å…³çš„æ ·å¼åŠ è½½ä¸åŒçš„å¸ƒå±€
    if (!mWindowNoTitle) {
        if (mIsFloating) {
            subDecor = (ViewGroup) inflater.inflate(
                    R.layout.abc_dialog_title_material, null);
            ...
        } else if (mHasActionBar) {
            ...
            subDecor = (ViewGroup) LayoutInflater.from(themedContext)
                    .inflate(R.layout.abc_screen_toolbar, null);
            ...
        }
    } else {
        if (mOverlayActionMode) {
            subDecor = (ViewGroup) inflater.inflate(
                    R.layout.abc_screen_simple_overlay_action_mode, null);
        } else {
            subDecor = (ViewGroup) inflater.inflate(R.layout.abc_screen_simple, null);
        }
        ...
        // è¿™ä¸€å †ä¸çœ‹ é€‚é… inset ç›¸å…³
    }
    ...
    
    // Now set the Window&#39;s content view with the decor
    mWindow.setContentView(subDecor);
    ...
    return subDecor;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä»ä»¥ä¸Šä»£ç å¯ä»¥çœ‹åˆ° &lt;code&gt;AppCompatDelegate&lt;/code&gt; æ ¹æ®å„ç§ä¸»é¢˜æ ·å¼ä¸åœºæ™¯åˆ›å»ºäº†ä¸€ä¸ª &lt;code&gt;subDecor&lt;/code&gt; çš„Viewï¼Œ&lt;code&gt;subDecor&lt;/code&gt; ä¸­åŒ…å«äº†æˆ‘ä»¬çš„ &lt;code&gt;contentView&lt;/code&gt;ï¼Œæœ€åå°†å…¶å’ŒWindowåšäº†ç»‘å®šã€‚ä½†æ˜¯ä»å‘½åä¸Šæˆ‘ä»¬ä¼¼ä¹çŸ¥é“ï¼Œè¿™ä¸ªå¹¶ä¸æ˜¯çœŸæ­£çš„DecorViewã€‚ä¸ºäº†ä¸€æ¢ç©¶ç«Ÿï¼Œä¸‹é¢æˆ‘ä»¬ç»§ç»­è·Ÿè¿›Windowä¸­æºç ã€‚&lt;/p&gt;
&lt;h2 id=&#34;windowä¸­çš„æµç¨‹&#34;&gt;Windowä¸­çš„æµç¨‹&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ç»§ç»­è·Ÿè¿›ï¼Œå‘ç°Windowæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œæˆ‘ä»¬çŸ¥é“Androidä¸­Windowæœ‰ä¸”åªæœ‰ä¸€ä¸ªå­ç±»ï¼Œé‚£å°±æ˜¯PhoneWindowï¼Œç›´æ¥æ‰¾åˆ°ç›¸å…³å®ç°ï¼Œçœ‹ä»£ç ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;@Override
public void setContentView(View view) {
    setContentView(view, new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œè®¾ç½®äº† &lt;code&gt;subDecor&lt;/code&gt; çš„LayoutParamsã€‚ç»§ç»­è·Ÿè¿›ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;@Override
public void setContentView(View view, ViewGroup.LayoutParams params) {
    if (mContentParent == null) {
        // åˆå§‹åŒ–æŸäº›ä¸œè¥¿
        installDecor();
    } else if (!hasFeature(FEATURE_CONTENT_TRANSITIONS)) {
        mContentParent.removeAllViews();
    }

    if (hasFeature(FEATURE_CONTENT_TRANSITIONS)) {
        view.setLayoutParams(params);
        final Scene newScene = new Scene(mContentParent, view);
        transitionTo(newScene);
    } else {
        // å°† `subDecor` æ·»åŠ è¿› mContentParent
        mContentParent.addView(view, params);
    }
    mContentParent.requestApplyInsets();
    final Callback cb = getCallback();
    if (cb != null &amp;amp;&amp;amp; !isDestroyed()) {
        cb.onContentChanged();
    }
    mContentParentExplicitlySet = true;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨ä¸Šä¸€ä¸ªæµç¨‹ä¸­ï¼Œæˆ‘ä»¬çŒœæµ‹ &lt;code&gt;subDecor&lt;/code&gt; å¹¶ä¸æ˜¯ DecorViewï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å‘ç°æœ‰ä¸€ä¸ª &lt;code&gt;installDecor()&lt;/code&gt; çš„æ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œé¢æ˜¯ä¸æ˜¯å°±æ˜¯åˆå§‹åŒ–äº†æˆ‘ä»¬çš„ DecorViewå‘¢ï¼Ÿ&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;private void installDecor() {
    mForceDecorInstall = false;
    if (mDecor == null) {
        // ä»£ç  1
        mDecor = generateDecor(-1);
        ...
    } else {
        mDecor.setWindow(this);
    }
    if (mContentParent == null) {
        // ä»£ç  2
        mContentParent = generateLayout(mDecor);
        Â·Â·Â·
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿›å…¥ä¹‹åå‘ç°äº†ä¸¤å¤„ç¥å¥‡çš„ä»£ç ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªå˜é‡ï¼Œæˆ‘ä»¬çœ‹çœ‹è¿™ä¸¤ä¸ªå˜é‡éƒ½æ˜¯å•¥ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;// è¿™æ˜¯çª—å£çš„é¡¶å±‚å¸ƒå±€
// This is the top-level view of the window, containing the window decor.
private DecorView mDecor;

// è¿™æ˜¯æ”¾ç½®çª—å£å†…å®¹çš„è§†å›¾ã€‚å®ƒè¦ä¹ˆæ˜¯mDecoræœ¬èº«ï¼Œè¦ä¹ˆæ˜¯mDecorçš„å­å®¹å™¨ã€‚
// This is the view in which the window contents are placed. It is either
// mDecor itself, or a child of mDecor where the contents go.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ViewGroup mContentParent;&lt;/p&gt;
&lt;p&gt;å¥½ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œç¡®å®æ‰¾åˆ°äº† DecorViewï¼Œç»§ç»­çœ‹çœ‹ DecorView æ˜¯æ€ä¹ˆè¢«åˆ›å»ºçš„ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;protected DecorView generateDecor(int featureId) {
    // System process doesn&#39;t have application context and in that case we need to directly use
    // the context we have. Otherwise we want the application context, so we don&#39;t cling to the
    // activity.
    Context context;
    if (mUseDecorContext) {
        Context applicationContext = getContext().getApplicationContext();
        if (applicationContext == null) {
            context = getContext();
        } else {
            context = new DecorContext(applicationContext, getContext());
            if (mTheme != -1) {
                context.setTheme(mTheme);
            }
        }
    } else {
        context = getContext();
    }
    // åˆ›å»ºäº† DecorView å¹¶ä¸”å°† this  windowä¼ å…¥è¿›è¡Œç»‘å®š
    return new DecorView(context, featureId, this, getAttributes());
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬çœ‹åˆ° DecorView ç¡®å®è¢«åˆ›å»ºå‡ºæ¥äº†ã€‚ç„¶åæˆ‘ä»¬çœ‹çœ‹ mContentParentã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;protected ViewGroup generateLayout(DecorView decor) {
    // Apply data from current theme.

    TypedArray a = getWindowStyle();
    ... æ ¹æ®styleè¿›è¡Œä¸€ç³»åˆ—èµ‹å€¼æ“ä½œ
    // Inflate the window decor.

    int layoutResource;
    int features = getLocalFeatures();
    ... ç»™ layoutResource è¿›è¡Œèµ‹å€¼æ“ä½œ

    mDecor.startChanging();
    mDecor.onResourcesLoaded(mLayoutInflater, layoutResource);

    ViewGroup contentParent = (ViewGroup)findViewById(ID_ANDROID_CONTENT);
   
    ...

    return contentParent;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹åˆ° ä¸Šé¢æœ‰è¿™æ ·çš„ä¸€æ®µä»£ç  &lt;code&gt;mDecor.onResourcesLoaded(mLayoutInflater, layoutResource);&lt;/code&gt; è¿™æ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿç»§ç»­è·Ÿè¿›ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;void onResourcesLoaded(LayoutInflater inflater, int layoutResource) {
    ...
    // inflate äº†è¿™ä¸ªèµ„æºæ–‡ä»¶
    final View root = inflater.inflate(layoutResource, null);
    if (mDecorCaptionView != null) {
        if (mDecorCaptionView.getParent() == null) {
            addView(mDecorCaptionView,
                    new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));
        }
        mDecorCaptionView.addView(root,
                new ViewGroup.MarginLayoutParams(MATCH_PARENT, MATCH_PARENT));
    } else {

        // å°†è¿™ä¸ªå¸ƒå±€æ–‡ä»¶ addè¿›DecorView ä¸­.
        addView(root, 0, new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));
    }
    mContentRoot = (ViewGroup) root;
    initializeElevation();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œ inflate äº†è¿™ä¸ªèµ„æºæ–‡ä»¶ï¼Œå¹¶ä¸”å°†å®ƒæ·»åŠ è¿›äº†DecorViewä¸­ï¼Œåœ¨ä¸Šä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬å‘ç°äº† contentParent æ˜¯é€šè¿‡ findViewById å‡ºæ¥çš„ï¼Œè¿›å»å¯ä»¥çœ‹åˆ°&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;public &amp;lt;T extends View&amp;gt; T findViewById(@IdRes int id) {
    return getDecorView().findViewById(id);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å®ƒæ˜¯é€šè¿‡DecorViewæ‰¾å‡ºæ¥çš„ï¼Œç°åœ¨è®©æˆ‘ä»¬æ¥æ¢³ç†ä¸‹Windowçš„setContentViewçš„æ–¹æ³•éƒ½å¹²äº†ä»€ä¹ˆã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆå§‹åŒ–äº†DecorView&lt;/li&gt;
&lt;li&gt;æ ¹æ®styleçš„ä¸åŒè®¾ç½®äº†ä¸åŒçš„feature&lt;/li&gt;
&lt;li&gt;æ ¹æ®featureçš„ä¸åŒå¾—åˆ°äº†ä¸åŒçš„layoutResource&lt;/li&gt;
&lt;li&gt;ç”¨layoutResource  inflateå‡ºäº†ä¸åŒå¸ƒå±€çš„Viewï¼Œå¹¶ä¸”è¢«æ·»åŠ åˆ°äº†DecorViewä¸­&lt;/li&gt;
&lt;li&gt;é€šè¿‡DecorViewçš„findViewByIdçš„æ–¹æ³•æ‰¾åˆ°äº†contentView&lt;/li&gt;
&lt;li&gt;contentViewå°†setContentViewä¸­Viewæ·»åŠ äº†è¿›å»&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç»“åˆAppCompatActivityä¸­setContentViewçš„æµç¨‹ï¼Œæ•´ä½“æµç¨‹å°±å˜æˆäº†&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ ¹æ®ä¸åŒçš„ä¸»é¢˜ç­‰ï¼Œåˆå§‹åŒ–SubDecorView&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ–äº†DecorView&lt;/li&gt;
&lt;li&gt;æ ¹æ®styleçš„ä¸åŒè®¾ç½®äº†ä¸åŒçš„feature&lt;/li&gt;
&lt;li&gt;æ ¹æ®featureçš„ä¸åŒå¾—åˆ°äº†ä¸åŒçš„layoutResource&lt;/li&gt;
&lt;li&gt;ç”¨layoutResource  inflateå‡ºäº†ä¸åŒå¸ƒå±€çš„Viewï¼Œå¹¶ä¸”è¢«æ·»åŠ åˆ°äº†DecorViewä¸­&lt;/li&gt;
&lt;li&gt;é€šè¿‡DecorViewçš„findViewByIdçš„æ–¹æ³•æ‰¾åˆ°äº†contentView&lt;/li&gt;
&lt;li&gt;contentViewå°†SubDecorViewæ·»åŠ äº†è¿›å»&lt;/li&gt;
&lt;li&gt;SubDecorViewä¸­çš„contentViewå°†setContentViewä¸­Viewæ·»åŠ äº†è¿›å»&lt;/li&gt;
&lt;/ol&gt;
">UIç»˜åˆ¶æµç¨‹-ä»setContentViewè¯´èµ·</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://caoyu.me/post/shi-jian-fen-fa/" data-c="
          &lt;h2 id=&#34;è§¦æ‘¸äº‹ä»¶ç±»å‹&#34;&gt;è§¦æ‘¸äº‹ä»¶ç±»å‹&lt;/h2&gt;
&lt;p&gt;è§¦æ‘¸äº‹ä»¶å¯¹åº”çš„ç±»æ˜¯ MotionEvent ç±»ï¼Œäº‹ä»¶çš„ä¸»è¦ç±»å‹æœ‰ä»¥ä¸‹å››ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ACTION_DOWN æ‰‹æŒ‡åˆšæ¥è§¦å±å¹•&lt;/li&gt;
&lt;li&gt;ACTION_MOVE æ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ»‘åŠ¨&lt;/li&gt;
&lt;li&gt;ACTION_UP æ‰‹æŒ‡ä»å±å¹•ä¸ŠæŠ¬èµ·&lt;/li&gt;
&lt;li&gt;ACTION_CANCEL éäººä¸ºå› ç´ å–æ¶ˆÃŸ&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- more --&gt;
&lt;p&gt;View äº‹ä»¶åˆ†å‘çš„æœ¬è´¨å°±æ˜¯å°† MotionEvent ç±»åˆ†å‘ç»™å…·ä½“æŸä¸ªView å¤„ç†çš„è¿‡ç¨‹ï¼Œä¸€æ¬¡å®Œæ•´çš„äº‹ä»¶å“åº”åŒ…å« ä¸€ä¸ª ACTION_DOWN äº‹ä»¶ï¼Œä¸­é—´ä»»æ„ä¸ª ACTION_MOVE äº‹ä»¶ï¼Œä»¥åŠæœ€åçš„ ACTION_UP äº‹ä»¶æˆ–è€… ACTION_CANCEL äº‹ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ ACTION_CANCEL äº‹ä»¶çš„è§¦å‘ä¼šåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹å‘ç”Ÿï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœåœ¨çˆ¶Viewä¸­æ‹¦æˆªACTION_UPæˆ–ACTION_MOVEï¼Œåœ¨ç¬¬ä¸€æ¬¡çˆ¶è§†å›¾æ‹¦æˆªæ¶ˆæ¯çš„ç¬é—´ï¼Œçˆ¶è§†å›¾æŒ‡å®šå­è§†å›¾ä¸æ¥å—åç»­æ¶ˆæ¯äº†ï¼ŒåŒæ—¶å­è§†å›¾ä¼šæ”¶åˆ°ACTION_CANCELäº‹ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœè§¦æ‘¸æŸä¸ªæ§ä»¶ï¼Œä½†æ˜¯åˆä¸æ˜¯åœ¨è¿™ä¸ªæ§ä»¶çš„åŒºåŸŸä¸ŠæŠ¬èµ·ï¼ˆç§»åŠ¨åˆ°åˆ«çš„åœ°æ–¹äº†ï¼‰ï¼Œå°±ä¼šå‡ºç°action_cancelã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;äº‹ä»¶åˆ†å‘çš„å¯¹è±¡&#34;&gt;äº‹ä»¶åˆ†å‘çš„å¯¹è±¡&lt;/h2&gt;
&lt;p&gt;å…·å¤‡äº‹ä»¶åˆ†å‘èƒ½åŠ›çš„å¯¹è±¡æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Activity æ§åˆ¶å½“å‰é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»¥åŠäº‹ä»¶åˆ†å‘çš„ç¬¬ä¸€å±‚View&lt;/li&gt;
&lt;li&gt;ViewGroup ä¸€ç»„Viewçš„é›†åˆï¼ŒåŒ…å«å¤šä¸ª View æˆ–è€… ViewGroup&lt;/li&gt;
&lt;li&gt;View æ‰€æœ‰ UI ç»„ä»¶çš„åŸºç±»&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;äº‹ä»¶åˆ†å‘çš„å¤§è‡´æµç¨‹ï¼šå½“æ‰‹æŒ‡è§¦ç¢°åˆ°å±å¹•æ—¶ï¼Œç³»ç»Ÿåº•å±‚ä¼šå‘å‡ºä¸€ä¸ªä¿¡å·ï¼Œæœ€ç»ˆåˆ°è¾¾ Activityï¼Œç”±Activityå‘ä¸‹æŠŠäº‹ä»¶åˆ†ç»™ä¸‹å±‚çš„ViewGroupï¼Œå†ç”±ä¸‹å±‚çš„ViewGroupå‘ä¸‹åˆ†å‘ï¼Œç›´åˆ°æ‰¾åˆ°å¯ä»¥å¤„ç†å½“å‰äº‹ä»¶çš„è§†å›¾ï¼Œå¹¶æŠŠåç»­äº‹ä»¶ä¹Ÿäº¤ç»™å…¶å¤„ç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;äº‹ä»¶åˆ†å‘çš„æ–¹æ³•&#34;&gt;äº‹ä»¶åˆ†å‘çš„æ–¹æ³•&lt;/h2&gt;
&lt;p&gt;äº‹ä»¶åˆ†å‘çš„è¿‡ç¨‹ç”±ä¸‰ä¸ªä¸»è¦çš„æ–¹æ³•å®Œæˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;dispatchTouchEventï¼šåˆ†å‘ã€‚è¿”å› true è¡¨ç¤ºäº‹ä»¶è¢«å½“å‰ View æ¶ˆè´¹æ‰ï¼›è¿”å› false è¡¨ç¤ºäº¤ç»™çˆ¶ç±»å»å¤„ç†ï¼Œè¿”å› super.dispatchTouchEvent è¡¨ç¤ºç»§ç»­åˆ†å‘ä¸‹å»ã€‚&lt;/li&gt;
&lt;li&gt;onInterceptTouchEventï¼šåˆ¤æ–­äº‹ä»¶æ˜¯å¦æ‹¦æˆªï¼ˆåªå­˜åœ¨äºViewGroupä¸­ï¼‰&lt;/li&gt;
&lt;li&gt;onTouchEventï¼šäº‹ä»¶çš„å¤„ç†&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;äº‹ä»¶åˆ†å‘æµç¨‹&#34;&gt;äº‹ä»¶åˆ†å‘æµç¨‹&lt;/h2&gt;
&lt;h3 id=&#34;activity-ä¸­çš„-åˆ†å‘è¿‡ç¨‹&#34;&gt;Activity ä¸­çš„ åˆ†å‘è¿‡ç¨‹&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;public boolean dispatchTouchEvent(MotionEvent ev) {
    if (ev.getAction() == MotionEvent.ACTION_DOWN) {
        onUserInteraction();
    }
		// äº¤ç»™ DecorView å»åˆ†å‘äº‹ä»¶
    if (getWindow().superDispatchTouchEvent(ev)) {
        return true;
    }
		// å¦‚æœ DecorView æ²¡æœ‰å¤„ç†è¿™ä¸ªäº‹ä»¶ï¼Œå°†äº‹ä»¶äº¤ç»™è‡ªå·±å¤„ç†
    return onTouchEvent(ev);
}

// 
public boolean onTouchEvent(MotionEvent event) {
		// é’ˆå¯¹ ç±»ä¼¼ DialogActivityï¼Œç‚¹å‡»äº†å¤–éƒ¨åŒºåŸŸï¼Œå…³é—­å½“å‰çš„ Activity
    if (mWindow.shouldCloseOnTouch(this, event)) {
        finish();
        return true;
    }

    return false;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;viewgroupä¸­çš„äº‹ä»¶åˆ†å‘&#34;&gt;ViewGroupä¸­çš„äº‹ä»¶åˆ†å‘&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;public boolean dispatchTouchEvent(MotionEvent ev) {
    boolean handled = false;
		// 
    if (onFilterTouchEventForSecurity(ev)) {
				...
        // åˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆªè¿™ä¸ªäº‹ä»¶
        final boolean intercepted;
				// DOWN äº‹ä»¶ï¼Œæˆ–è€…å·²ç»æœ‰ç›¸åº”è§†å›¾å¤„ç†è¿‡ä¹‹å‰çš„äº‹ä»¶
				// mFirstTouchTarget ä¸»è¦æ˜¯ç”¨æ¥è®°å½• ä» é¡¶å±‚å®¹å™¨ åˆ° å¤„ç†è¿™ä¸ª äº‹ä»¶çš„ ä¸€ä¸ªView çš„é“¾è·¯
				// ç¬¬äºŒæ¬¡çš„äº‹ä»¶åˆ†å‘ å°±ç›´æ¥èµ°è¿™ä¸ª é“¾è·¯è¿›è¡Œåˆ†å‘
        if (actionMasked == MotionEvent.ACTION_DOWN || mFirstTouchTarget != null) {
            
						final boolean disallowIntercept = (mGroupFlags &amp;amp; FLAG_DISALLOW_INTERCEPT) != 0;
						// å­ç±»æ˜¯å¦è¦æ±‚çˆ¶ç±»ä¸æ‹¦æˆª
						if (!disallowIntercept) {
                intercepted = onInterceptTouchEvent(ev);
                ev.setAction(action); // restore action in case it was changed
            } else {
                intercepted = false;
            }
        } else {
            // æ²¡æœ‰æ‰¾åˆ°å¤„ç†è¿‡äº‹ä»¶çš„è§†å›¾ï¼Œå¹¶ä¸”ä¹Ÿä¸æ˜¯ down äº‹ä»¶
            intercepted = true;
        }

        ...
        if (!canceled &amp;amp;&amp;amp; !intercepted) {
						...
            if (actionMasked == MotionEvent.ACTION_DOWN
                    || (split &amp;amp;&amp;amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN)
                    || actionMasked == MotionEvent.ACTION_HOVER_MOVE) {
								...
								// åˆ¤æ–­å“ªäº›å­Viewå¯ä»¥æ¥æ”¶è¿™ä¸ªçš„äº‹ä»¶åˆ†å‘
             }
				}

        // åˆ›å»º äº‹ä»¶åˆ†å‘çš„é“¾è¡¨
        if (mFirstTouchTarget == null) {
            // No touch targets so treat this as an ordinary view.
            handled = dispatchTransformedTouchEvent(ev, canceled, null,
                    TouchTarget.ALL_POINTER_IDS);
        } else {
            // Dispatch to touch targets, excluding the new touch target if we already
            // dispatched to it.  Cancel touch targets if necessary.
            TouchTarget predecessor = null;
            TouchTarget target = mFirstTouchTarget;
            while (target != null) {
                final TouchTarget next = target.next;
                if (alreadyDispatchedToNewTouchTarget &amp;amp;&amp;amp; target == newTouchTarget) {
                    handled = true;
                } else {
                    final boolean cancelChild = resetCancelNextUpFlag(target.child)
                            || intercepted;
                    if (dispatchTransformedTouchEvent(ev, cancelChild,
                            target.child, target.pointerIdBits)) {
                        handled = true;
                    }
                    if (cancelChild) {
                        if (predecessor == null) {
                            mFirstTouchTarget = next;
                        } else {
                            predecessor.next = next;
                        }
                        target.recycle();
                        target = next;
                        continue;
                    }
                }
                predecessor = target;
                target = next;
            }
        }
    }
    return handled;
}

final int childrenCount = mChildrenCount;
      if (newTouchTarget == null &amp;amp;&amp;amp; childrenCount != 0) {
            final float x = ev.getX(actionIndex);
            final float y = ev.getY(actionIndex);
            // æ‰¾åˆ°èƒ½å¤„ç†è¿™ä¸ª Event çš„ å­View 
            final ArrayList&amp;lt;View&amp;gt; preorderedList = buildTouchDispatchChildList();
            final boolean customOrder = preorderedList == null
                    &amp;amp;&amp;amp; isChildrenDrawingOrderEnabled();
            final View[] children = mChildren;
            for (int i = childrenCount - 1; i &amp;gt;= 0; i--) {
                final int childIndex = getAndVerifyPreorderedIndex(
                        childrenCount, i, customOrder);
                final View child = getAndVerifyPreorderedView(
                        preorderedList, children, childIndex);
								// åˆ¤æ–­è¿™ä¸ªå­View æ˜¯å¦èƒ½å¤„ç†è¿™ä¸ª Event
                if (!canViewReceivePointerEvents(child)
                        || !isTransformedTouchPointInView(x, y, child, null)) {
                    ev.setTargetAccessibilityFocus(false);
                    continue;
                }

                newTouchTarget = getTouchTarget(child);
                if (newTouchTarget != null) {
                    // Child is already receiving touch within its bounds.
                    // Give it the new pointer in addition to the ones it is handling.
                    newTouchTarget.pointerIdBits |= idBitsToAssign;
                    break;
                }

                resetCancelNextUpFlag(child);
								// å¾€å­Viewåšåˆ†å‘
                if (dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)) {
                    ...
										// æ­å»ºäº‹ä»¶åˆ†å‘å¤„ç†é“¾è¡¨
                    newTouchTarget = addTouchTarget(child, idBitsToAssign);
                    
                    break;
                }

                // The accessibility focus didn&#39;t handle the event, so clear
                // the flag and do a normal dispatch to all children.
                ev.setTargetAccessibilityFocus(false);
            }
            if (preorderedList != null) preorderedList.clear();
        }

        if (newTouchTarget == null &amp;amp;&amp;amp; mFirstTouchTarget != null) {
            // Did not find a child to receive the event.
            // Assign the pointer to the least recently added target.
            newTouchTarget = mFirstTouchTarget;
            while (newTouchTarget.next != null) {
                newTouchTarget = newTouchTarget.next;
            }
            newTouchTarget.pointerIdBits |= idBitsToAssign;
        }
    }
}

private boolean dispatchTransformedTouchEvent(MotionEvent event, boolean cancel,
            View child, int desiredPointerIdBits) {
    final boolean handled;
		...
    if (child == null) {
				// å¦‚æœå·²ç»æ²¡æœ‰å­View äº†ï¼Œè°ƒç”¨çˆ¶ç±»çš„ åˆ†å‘æ–¹æ³•ï¼Œè¿™é‡Œä¸€èˆ¬å°±ç›´æ¥è°ƒç”¨äº† View çš„åˆ†å‘æ–¹æ³•
        handled = super.dispatchTouchEvent(transformedEvent);
    } else {
				...
				// ä¼ ç»™å­View å»è¿›è¡Œåˆ†å‘
        handled = child.dispatchTouchEvent(transformedEvent);
    }
    return handled;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;view-ä¸­çš„äº‹ä»¶åˆ†å‘&#34;&gt;View ä¸­çš„äº‹ä»¶åˆ†å‘&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;public boolean dispatchTouchEvent(MotionEvent event) {

    boolean result = false;
		// å½“å‰ View æ˜¯å¦å¯è§ æˆ–è€…æ˜¯å¦è¢«é®æŒ¡
    if (onFilterTouchEventForSecurity(event)) {
        if ((mViewFlags &amp;amp; ENABLED_MASK) == ENABLED &amp;amp;&amp;amp; handleScrollBarDragging(event)) {
            result = true;
        }

        ListenerInfo li = mListenerInfo;
				// ä¼˜å…ˆå“åº” onTouchListener äº‹ä»¶
        if (li != null &amp;amp;&amp;amp; li.mOnTouchListener != null
                &amp;amp;&amp;amp; (mViewFlags &amp;amp; ENABLED_MASK) == ENABLED
                &amp;amp;&amp;amp; li.mOnTouchListener.onTouch(this, event)) {
            result = true;
        }
				// onTouchListener äº‹ä»¶ è¿”å› falseï¼Œå“åº”è‡ªèº«çš„ onTouchEvent äº‹ä»¶
        if (!result &amp;amp;&amp;amp; onTouchEvent(event)) {
            result = true;
        }
    }

    return result;
}

public boolean onTouchEvent(MotionEvent event) {
		// åˆ¤æ–­å½“å‰View æ˜¯å¦å¯ç‚¹å‡» å¯é•¿æŒ‰ï¼Œå¦‚æœ å¯ç‚¹å‡»å¯é•¿æŒ‰çš„è¯ï¼Œæœ€ç»ˆä¸€å®š return true
    final boolean clickable = ((viewFlags &amp;amp; CLICKABLE) == CLICKABLE
            || (viewFlags &amp;amp; LONG_CLICKABLE) == LONG_CLICKABLE)
            || (viewFlags &amp;amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE;
		// æœ‰è®¾ç½®ä»£ç†èµ° ä»£ç†æ–¹æ³•
    if (mTouchDelegate != null) {
        if (mTouchDelegate.onTouchEvent(event)) {
            return true;
        }
    }

    if (clickable || (viewFlags &amp;amp; TOOLTIP) == TOOLTIP) {
				...
				return true;
    }

    return false;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;action_down&#34;&gt;ACTION_DOWN&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;mHasPerformedLongPress = false;

if (!clickable) {
    checkForLongClick(0, x, y);
    break;
}

// Walk up the hierarchy to determine if we&#39;re inside a scrolling container.
boolean isInScrollingContainer = isInScrollingContainer();

if (isInScrollingContainer) {
    mPrivateFlags |= PFLAG_PREPRESSED;
    if (mPendingCheckForTap == null) {
        mPendingCheckForTap = new CheckForTap();
    }
    mPendingCheckForTap.x = event.getX();
    mPendingCheckForTap.y = event.getY();
    postDelayed(mPendingCheckForTap, ViewConfiguration.getTapTimeout());
} else {
    // Not inside a scrolling container, so show the feedback right away
    setPressed(true, x, y);
    checkForLongClick(0, x, y);
}

// é€šè¿‡ Handler å‘é€ä¸€ä¸ª 500ms çš„å»¶è¿Ÿæ¶ˆæ¯ï¼Œåœ¨ CheckForLongPress run æ–¹æ³•ä¸­å°† 
// mHasPerformedLongPress æ ‡å¿—ä½è®¾ç½®ä¸º ture ä»£è¡¨é•¿æŒ‰æ–¹æ³•å·²ç»æ‰§è¡Œ
private void checkForLongClick(int delayOffset, float x, float y) {
    if ((mViewFlags &amp;amp; LONG_CLICKABLE) == LONG_CLICKABLE || (mViewFlags &amp;amp; TOOLTIP) == TOOLTIP) {
        mHasPerformedLongPress = false;

        if (mPendingCheckForLongPress == null) {
            mPendingCheckForLongPress = new CheckForLongPress();
        }
        mPendingCheckForLongPress.setAnchor(x, y);
        mPendingCheckForLongPress.rememberWindowAttachCount();
        mPendingCheckForLongPress.rememberPressedState();
        postDelayed(mPendingCheckForLongPress,
                ViewConfiguration.getLongPressTimeout() - delayOffset);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;action_cancel&#34;&gt;ACTION_CANCEL&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;if (clickable) {
    setPressed(false);
}
// ç§»é™¤ DOWN äº‹ä»¶æ—¶ï¼Œé€šè¿‡Handlerå‘å‡ºçš„æ¶ˆæ¯ï¼Œä¸åœ¨è§¦å‘ LongClick
removeTapCallback();
removeLongPressCallback();
mInContextButtonPress = false;
mHasPerformedLongPress = false;
mIgnoreNextUpEvent = false;
mPrivateFlags3 &amp;amp;= ~PFLAG3_FINGER_DOWN;
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;action_move&#34;&gt;ACTION_MOVE&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;if (clickable) {
    drawableHotspotChanged(x, y);
}

// æ»‘åŠ¨åˆ°å¤–éƒ¨å»äº† 
if (!pointInView(x, y, mTouchSlop)) {
    // ç§»é™¤ DOWN äº‹ä»¶æ—¶ï¼Œé€šè¿‡Handlerå‘å‡ºçš„æ¶ˆæ¯ï¼Œä¸åœ¨è§¦å‘ LongClick
    removeTapCallback();
    removeLongPressCallback();
    if ((mPrivateFlags &amp;amp; PFLAG_PRESSED) != 0) {
        setPressed(false);
    }
    mPrivateFlags3 &amp;amp;= ~PFLAG3_FINGER_DOWN;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;action_up&#34;&gt;ACTION_UP&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt;boolean prepressed = (mPrivateFlags &amp;amp; PFLAG_PREPRESSED) != 0;
if ((mPrivateFlags &amp;amp; PFLAG_PRESSED) != 0 || prepressed) {
		// å¦‚æœé•¿æŒ‰äº‹ä»¶æ²¡æœ‰å“åº”ï¼Œè¿™ä¸ªæ—¶å€™æ¥æ‰§è¡Œç‚¹å‡»äº‹ä»¶
    if (!mHasPerformedLongPress &amp;amp;&amp;amp; !mIgnoreNextUpEvent) {
        // ç§»é™¤ DOWN äº‹ä»¶æ—¶ï¼Œé€šè¿‡Handlerå‘å‡ºçš„æ¶ˆæ¯ï¼Œä¸åœ¨è§¦å‘ LongClick
        removeLongPressCallback();
        if (!focusTaken) {

            if (mPerformClick == null) {
                mPerformClick = new PerformClick();
            }
            if (!post(mPerformClick)) {
                performClickInternal();
            }
        }
    }
    removeTapCallback();
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;äº‹ä»¶åˆ†å‘çš„æ•´ä½“æ¨¡å‹&#34;&gt;äº‹ä»¶åˆ†å‘çš„æ•´ä½“æ¨¡å‹&lt;/h2&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://caoyu.me/post-images/1608742799596.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h2 id=&#34;æ»‘åŠ¨äº‹ä»¶å†²çª&#34;&gt;æ»‘åŠ¨äº‹ä»¶å†²çª&lt;/h2&gt;
&lt;h3 id=&#34;å¤–éƒ¨æ‹¦æˆª&#34;&gt;å¤–éƒ¨æ‹¦æˆª&lt;/h3&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;2&#34;&gt;&lt;img src=&#34;https://s3-us-west-2.amazonaws.com/secure.notion-static.com/789a1c01-3584-4986-a2e6-a7f157d0bfda/Untitled.png&#34; alt=&#34;https://s3-us-west-2.amazonaws.com/secure.notion-static.com/789a1c01-3584-4986-a2e6-a7f157d0bfda/Untitled.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;h3 id=&#34;å†…éƒ¨æ‹¦æˆª&#34;&gt;å†…éƒ¨æ‹¦æˆª&lt;/h3&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;3&#34;&gt;&lt;img src=&#34;https://s3-us-west-2.amazonaws.com/secure.notion-static.com/868f6ae1-fcdd-4f4c-b985-27c5e40516e9/Untitled.png&#34; alt=&#34;https://s3-us-west-2.amazonaws.com/secure.notion-static.com/868f6ae1-fcdd-4f4c-b985-27c5e40516e9/Untitled.png&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
">äº‹ä»¶åˆ†å‘</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://caoyu.me/post/handler/" data-c="
          &lt;blockquote&gt;
&lt;p&gt;Handlerçš„æ¶ˆæ¯å¾ªç¯æ¶‰åŠçš„ç±»ï¼šHandlerï¼ŒLooperï¼ŒMessageï¼ŒMessageQueue&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure data-type=&#34;image&#34; tabindex=&#34;1&#34;&gt;&lt;img src=&#34;https://caoyu.me/post-images/1608742734612.jpg&#34; alt=&#34;&#34; loading=&#34;lazy&#34;&gt;&lt;/figure&gt;
&lt;!-- more --&gt;
&lt;h3 id=&#34;åˆ›å»º&#34;&gt;åˆ›å»º&lt;/h3&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ActivityThread mainæ–¹æ³•ä¸­åˆ›å»º Looper&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt; public static void main(String[] args) {
 		Looper.prepareMainLooper();
 		...
 		Looper.loop();
 }
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Looper prepare æ–¹æ³•ä¸­ï¼Œé€šè¿‡ ThreadLocal å°† Looper å’Œ ä¸»çº¿ç¨‹è¿›è¡Œç»‘å®š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt; private static void prepare(boolean quitAllowed) {
     if (sThreadLocal.get() != null) {
         throw new RuntimeException(&amp;quot;Only one Looper may be created per thread&amp;quot;);
     }
     sThreadLocal.set(new Looper(quitAllowed));
 }
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Looper çš„ç§æœ‰åŒ–æ„é€ æ–¹æ³•ä¸­ ç»‘å®šäº† MessageQueue&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt; private Looper(boolean quitAllowed) {
     mQueue = new MessageQueue(quitAllowed);
     mThread = Thread.currentThread();
 }
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;å‘é€ä¸€ä¸ªmessageçš„æµç¨‹&#34;&gt;å‘é€ä¸€ä¸ªMessageçš„æµç¨‹&lt;/h3&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åˆå§‹åŒ–Handlerï¼Œè·å–å¹¶ç»‘å®šå½“å‰çº¿ç¨‹çš„ MessageQueue å’Œ Looperï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•ä¸­æœ‰ä¸€ä¸ªå¼‚å¸¸ï¼Œå¦‚æœæ˜¯å¼‚æ­¥çº¿ç¨‹çš„è¯éœ€è¦å…ˆè°ƒç”¨ Looper.prepare()ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt; public Handler(Callback callback, boolean async) {
 		...
     mLooper = Looper.myLooper();
     if (mLooper == null) {
         throw new RuntimeException(
             &amp;quot;Can&#39;t create handler inside thread &amp;quot; + Thread.currentThread()
                     + &amp;quot; that has not called Looper.prepare()&amp;quot;);
     }
     mQueue = mLooper.mQueue;
     mCallback = callback;
     ...
 }
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‘é€æ¶ˆæ¯æœ€ç»ˆéƒ½ä¼šè°ƒç”¨åˆ° Handler.enqueueMessage(MessageQueue, Message, updateTime) æ–¹æ³•&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt; private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) {
     // è¿™é‡Œå°†å½“å‰çš„ Message å’Œ Handler ç»‘å®š
 		msg.target = this;
     if (mAsynchronous) {
         msg.setAsynchronous(true);
     }
     return queue.enqueueMessage(msg, uptimeMillis);
 }
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°†å½“å‰Message æ”¾å…¥ MessageQueueï¼Œå¦‚æœé˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯ï¼Œç›´æ¥å°†è¿™ä¸ªæ¶ˆæ¯æ”¾åœ¨é˜Ÿé¦–ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­æœ‰æ¶ˆæ¯ï¼Œæ ¹æ®è¿™ä¸ªæ¶ˆæ¯çš„æ¥æ”¶å¤„ç†æ—¶é—´ï¼Œå°†å…¶æ’å…¥åˆ°åˆé€‚çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt; boolean enqueueMessage(Message msg, long when) {
 		...
     synchronized (this) {
         if (mQuitting) {
             IllegalStateException e = new IllegalStateException(
                     msg.target + &amp;quot; sending message to a Handler on a dead thread&amp;quot;);
             Log.w(TAG, e.getMessage(), e);
             msg.recycle();
             return false;
         }
 
         msg.markInUse();
         msg.when = when;
         Message p = mMessages;
         boolean needWake;
         if (p == null || when == 0 || when &amp;lt; p.when) {
             // New head, wake up the event queue if blocked.
             msg.next = p;
             mMessages = msg;
             needWake = mBlocked;
         } else {
             // Inserted within the middle of the queue.  Usually we don&#39;t have to wake
             // up the event queue unless there is a barrier at the head of the queue
             // and the message is the earliest asynchronous message in the queue.
             needWake = mBlocked &amp;amp;&amp;amp; p.target == null &amp;amp;&amp;amp; msg.isAsynchronous();
             Message prev;
             for (;;) {
                 prev = p;
                 p = p.next;
                 if (p == null || when &amp;lt; p.when) {
                     break;
                 }
                 if (needWake &amp;amp;&amp;amp; p.isAsynchronous()) {
                     needWake = false;
                 }
             }
             msg.next = p; // invariant: p == prev.next
             prev.next = msg;
         }
 
         // We can assume mPtr != 0 because mQuitting is false.
         if (needWake) {
             nativeWake(mPtr);
         }
     }
     return true;
 }
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;æ¶ˆè´¹æ¶ˆæ¯&#34;&gt;æ¶ˆè´¹æ¶ˆæ¯&lt;/h3&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä¸»çº¿ç¨‹åˆå§‹åŒ–çš„æ—¶å€™æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼Œå°†ä¸»çº¿ç¨‹ç»‘å®šä¸€ä¸ªLooperï¼Œç„¶åè°ƒç”¨äº† Looper.loop æ–¹æ³•è½®è¯¢æ¶ˆæ¯é˜Ÿåˆ—&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt; public static void main(String[] args) {
 		Looper.prepareMainLooper();
 		...
 		Looper.loop();
 }
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Looper.loop() åˆå§‹åŒ–ä¸»çº¿ç¨‹æ—¶ï¼Œå¼€å¯äº†æ¶ˆæ¯å¾ªç¯ï¼Œé€šè¿‡ MessageQueue çš„ next æ–¹æ³•è·å–ä¸‹ä¸€ä¸ªæ¶ˆæ¯ï¼Œæœ€ç»ˆè°ƒç”¨äº† msg.target.dispatchMessage(msg); å°†æ¶ˆæ¯åˆ†å‘å‡ºå»å¤„ç†ã€‚å¤„ç†ç©è¿™ä¸ªæ¶ˆæ¯åï¼Œè°ƒç”¨ msg.recycleUnchecked() è¿™ä¸ªæ–¹æ³•ï¼Œå°†å®ƒé‡æ–°æ”¾å› æ¶ˆæ¯æ±  ä¸­&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt; public static void loop() {
     final Looper me = myLooper();
     if (me == null) {
         throw new RuntimeException(&amp;quot;No Looper; Looper.prepare() wasn&#39;t called on this thread.&amp;quot;);
     }
     final MessageQueue queue = me.mQueue;
     ...
     for (;;) {
         Message msg = queue.next(); // might block
         if (msg == null) {
             // No message indicates that the message queue is quitting.
             return;
         }
 				...
         try {
             msg.target.dispatchMessage(msg);
             dispatchEnd = needEndTime ? SystemClock.uptimeMillis() : 0;
         } finally {
             if (traceTag != 0) {
                 Trace.traceEnd(traceTag);
             }
         }
 				...
 				msg.recycleUnchecked();
     }
 }
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MessageQueue ä¸­è½®è¯¢ä¸‹ä¸€ä¸ªæ¶ˆæ¯çš„æ–¹æ³•ï¼Œè¿™é‡ŒMessage æœ‰ä¸€ä¸ªå›æ”¶æ± ï¼Œåªä¼šè·å–åˆ°æœ€æ–°çš„ Messageï¼Œå°†å½“å‰çš„ Message å–å‡ºï¼Œå¹¶ä¸” next è®¾ç½®ä¸ºnullï¼ŒåŒäº‹å°† mMessages æŒ‡å‘å…¶ä¸‹ä¸€ä¸ª Messageã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt; Message next() {
     ...
     for (;;) {
         if (nextPollTimeoutMillis != 0) {
             Binder.flushPendingCommands();
         }
 
         nativePollOnce(ptr, nextPollTimeoutMillis);
 
         synchronized (this) {
             // Try to retrieve the next message.  Return if found.
             final long now = SystemClock.uptimeMillis();
             Message prevMsg = null;
             Message msg = mMessages;
             if (msg != null &amp;amp;&amp;amp; msg.target == null) {
                 // Stalled by a barrier.  Find the next asynchronous message in the queue.
                 do {
                     prevMsg = msg;
                     msg = msg.next;
                 } while (msg != null &amp;amp;&amp;amp; !msg.isAsynchronous());
             }
             if (msg != null) {
              ...
                       if (prevMsg != null) {
                           prevMsg.next = msg.next;
                       } else {
                           mMessages = msg.next;
                       }
                       msg.next = null;
                       if (DEBUG) Log.v(TAG, &amp;quot;Returning message: &amp;quot; + msg);
                       msg.markInUse();
                       return msg;
               ...
               } else {
                   // No more messages.
                   nextPollTimeoutMillis = -1;
               }
 
               // Process the quit message now that all pending messages have been handled.
               if (mQuitting) {
                   dispose();
                   return null;
               }
 							...
       }
   }
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è°ƒç”¨ msg.target.dispatchMessage(msg); å»åˆ†å‘å¤„ç†è¿™ä¸ªæ¶ˆæ¯ï¼Œå…¶ä¸­ target å°±æ˜¯ Handlerï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯ Handler çš„ dispatchMessage çš„æ–¹æ³•&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt; public void dispatchMessage(Message msg) {
     if (msg.callback != null) {
         handleCallback(msg);
     } else {
         if (mCallback != null) {
 						// handleMessage è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½éœ€è¦ Handler å»å®ç°ï¼Œ
 						//éƒ½æ˜¯é‡å†™æ–¹æ³•ï¼Œç†è®ºä¸Šä¸ä¼šåŒæ—¶å­˜åœ¨
             if (mCallback.handleMessage(msg)) {
                 return;
             }
         }
         handleMessage(msg);
     }
 }
 
 private static void handleCallback(Message message) {
 		// callback å°±æ˜¯ Runnable è¿™ä¸ªå°±èƒ½å®ç°å­çº¿ç¨‹ Runnable ä¸­çš„ä»£ç  æœ€ç»ˆåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ
     message.callback.run();
 }
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆä¸èƒ½åœ¨å­çº¿ç¨‹åˆ›å»º-handler&#34;&gt;ä¸ºä»€ä¹ˆä¸èƒ½åœ¨å­çº¿ç¨‹åˆ›å»º Handler&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ° Handler åˆå§‹åŒ–çš„æ—¶å€™ æœ‰è¿™æ ·ä¸€å¥ä»£ç ï¼šLooper.myLooper();&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt; public Handler(Callback callback, boolean async) {
 		...
     mLooper = Looper.myLooper();
     if (mLooper == null) {
         throw new RuntimeException(
             &amp;quot;Can&#39;t create handler inside thread &amp;quot; + Thread.currentThread()
                     + &amp;quot; that has not called Looper.prepare()&amp;quot;);
     }
     mQueue = mLooper.mQueue;
     mCallback = callback;
     ...
 }

 public static @Nullable Looper myLooper() {
     return sThreadLocal.get();
 }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¹¶ä¸”åœ¨ æ¶ˆæ¯ç³»ç»Ÿåˆå§‹åŒ–çš„æ—¶å€™æœ‰è¿™æ ·ä¸€æ®µä»£ç &lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-Java&#34;&gt; private static void prepare(boolean quitAllowed) {
     if (sThreadLocal.get() != null) {
         throw new RuntimeException(&amp;quot;Only one Looper may be created per thread&amp;quot;);
     }
     sThreadLocal.set(new Looper(quitAllowed));
 }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çŸ¥é“ sThreadLocal æ˜¯ ThreadLocal çš„ä¸€ä¸ªå®ä¾‹ï¼Œä»–å®é™…ä¸Šæ˜¯ä¸€ä¸ª Mapï¼ŒThread ä½œä¸ºå®ƒçš„ Keyï¼ŒLooper ä½œä¸ºä»–çš„ valueã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ Thread æ˜¯é€šè¿‡ Thread.currentThread() è·å–çš„ï¼Œç›´æ¥åœ¨å­çº¿ç¨‹ä¸­åˆ›å»ºHandlerï¼Œè°ƒç”¨äº† sThreadLocal.get() çš„æ–¹æ³•ï¼Œæ­¤æ—¶è¿”å›çš„ä¸€å®šä¸º nullï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚æ‰€ä»¥éœ€è¦å…ˆè°ƒç”¨ Looper.prepare() æ–¹æ³•ï¼Œç»™å½“å‰çº¿ç¨‹åˆ›å»ºä¸€ä¸ª Looperã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ Thread ä¸­ç»´æŠ¤äº†ä¸€ä¸ª ThreadLocalMapï¼Œæ¯æ¬¡åˆ›å»ºçš„ ThreadLocalMapï¼Œæœ€ç»ˆæ˜¯è¢« Thread æŒæœ‰çš„ï¼ŒçœŸæ­£çš„ Key value å­˜ThreadLocalMapé‡Œï¼Œè€Œä¸”è¿™ä¸ª çš„ key æ˜¯é€šè¿‡ä¸€ä¸ªå¼±å¼•ç”¨æŒæœ‰çš„ï¼Œæ‰€ä»¥å½“å‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œå›æ”¶å°±å›æ”¶äº†ï¼Œä¸ä¼šç»§ç»­æŒæœ‰å½“å‰çš„ Threadï¼Œä¸ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚ThreadLocalåªæ˜¯ Thread å’Œ ThreadLocalMap çš„æ“ä½œç±»ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;viewpost-å’Œ-handlerpost-çš„åŒºåˆ«&#34;&gt;View.post å’Œ Handler.post çš„åŒºåˆ«&lt;/h2&gt;
&lt;p&gt;textView.setText åªèƒ½åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œä¹ˆ&lt;/p&gt;
&lt;p&gt;ThreadLocal çš„ç”¨æ³•å’ŒåŸç†&lt;/p&gt;
">Handler</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://caoyu.me/post/about/" data-c="
          &lt;blockquote&gt;
&lt;p&gt;æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å…³äºæœ¬ç«™&#34;&gt;ğŸ  å…³äºæœ¬ç«™&lt;/h2&gt;
&lt;h2 id=&#34;åšä¸»æ˜¯è°&#34;&gt;ğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°&lt;/h2&gt;
&lt;h2 id=&#34;å…´è¶£çˆ±å¥½&#34;&gt;â›¹ å…´è¶£çˆ±å¥½&lt;/h2&gt;
&lt;h2 id=&#34;è”ç³»æˆ‘å‘€&#34;&gt;ğŸ“¬ è”ç³»æˆ‘å‘€&lt;/h2&gt;
">å…³äº</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://caoyu.me/post/hello-gridea/" data-c="
          &lt;p&gt;ğŸ‘  æ¬¢è¿ä½¿ç”¨ &lt;strong&gt;Gridea&lt;/strong&gt; ï¼&lt;br&gt;
âœï¸  &lt;strong&gt;Gridea&lt;/strong&gt; ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...&lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/getgridea/gridea&#34;&gt;Github&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;https://gridea.dev/&#34;&gt;Gridea ä¸»é¡µ&lt;/a&gt;&lt;br&gt;
&lt;a href=&#34;http://fehey.com/&#34;&gt;ç¤ºä¾‹ç½‘ç«™&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç‰¹æ€§&#34;&gt;ç‰¹æ€§ğŸ‘‡&lt;/h2&gt;
&lt;p&gt;ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ &lt;strong&gt;Markdown&lt;/strong&gt; è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ&lt;/p&gt;
&lt;p&gt;ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡&lt;/p&gt;
&lt;p&gt;ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„&lt;/p&gt;
&lt;p&gt;ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•&lt;/p&gt;
&lt;p&gt;ğŸ’»  ä½ å¯ä»¥åœ¨ &lt;strong&gt;Windows&lt;/strong&gt;ï¼Œ&lt;strong&gt;MacOS&lt;/strong&gt; æˆ– &lt;strong&gt;Linux&lt;/strong&gt; è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯&lt;/p&gt;
&lt;p&gt;ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ &lt;strong&gt;ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ&lt;/strong&gt; æˆ– &lt;strong&gt;Coding Pages&lt;/strong&gt; å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°&lt;/p&gt;
&lt;p&gt;ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ &lt;a href=&#34;https://github.com/gitalk/gitalk&#34;&gt;Gitalk&lt;/a&gt; æˆ– &lt;a href=&#34;https://github.com/SukkaW/DisqusJS&#34;&gt;DisqusJS&lt;/a&gt; è¯„è®ºç³»ç»Ÿ&lt;/p&gt;
&lt;p&gt;ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨&lt;strong&gt;ä¸­æ–‡ç®€ä½“&lt;/strong&gt;æˆ–&lt;strong&gt;è‹±è¯­&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›&lt;/p&gt;
&lt;p&gt;ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥&lt;/p&gt;
&lt;p&gt;ğŸŒ± å½“ç„¶ &lt;strong&gt;Gridea&lt;/strong&gt; è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ&lt;/p&gt;
&lt;p&gt;æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´&lt;/p&gt;
&lt;p&gt;å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼&lt;/p&gt;
&lt;p&gt;ğŸ˜˜ Enjoy~&lt;/p&gt;
">Hello Gridea</a>
      </div>
      
    </div>
  </div>
</div>
<script>
  // var escape = "[{&#34;content&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;å¹³æ—¶æˆ‘ä»¬åœ¨å†™ &lt;code&gt;Android&lt;/code&gt; &lt;code&gt;UI&lt;/code&gt; æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šé€šè¿‡ &lt;code&gt;setContentVoew&lt;/code&gt; æ–¹æ³•ï¼Œå°†æˆ‘ä»¬çš„å¸ƒå±€èµ„æºäº¤ç»™ &lt;code&gt;Activity&lt;/code&gt;ï¼Œè®©å®ƒå»è¿›è¡Œå…³è” &lt;code&gt;window&lt;/code&gt;ï¼Œè§£æ &lt;code&gt;å¸ƒå±€&lt;/code&gt;ï¼Œæ¸²æŸ“ &lt;code&gt;è§†å›¾&lt;/code&gt; ï¼Œæœ€ç»ˆåœ¨å±å¹•ä¸Šå±•ç°å‡ºäº†æˆ‘ä»¬éœ€è¦çš„æ•ˆæœã€‚ä¸Šä¸€èŠ‚æˆ‘ä»¬åˆ†æäº† &lt;code&gt;Activity&lt;/code&gt; çš„å¯åŠ¨æµç¨‹ï¼ŒçŸ¥é“äº†æ–° &lt;code&gt;Activity&lt;/code&gt; æœ€ç»ˆéƒ½ä¼šé€šè¿‡ &lt;code&gt;AMS&lt;/code&gt; å’Œ &lt;code&gt;ClientLifecycleManager&lt;/code&gt; çš„ç›¸äº’è°ƒåº¦ä¾æ¬¡æ‰§è¡Œ &lt;code&gt;attach&lt;/code&gt; ã€&lt;code&gt;performCreate&lt;/code&gt;ã€&lt;code&gt;performStart&lt;/code&gt; å’Œ &lt;code&gt;performResume&lt;/code&gt; çš„å››ä¸ªæ–¹æ³•ï¼Œä¸‹é¢æˆ‘ä»¬å°±æŒ‰ç…§è¿™ä¸ªæµç¨‹æ¥èŠèŠå¸ƒå±€çš„ &lt;code&gt;ç»‘å®š&lt;/code&gt;ã€ &lt;code&gt;è§£æ&lt;/code&gt; å’Œ &lt;code&gt;æ¸²æŸ“&lt;/code&gt; çš„æµç¨‹ã€‚&lt;/p&gt;\n&lt;p&gt;é™„ï¼š&lt;a href=\&#34;https://blog.cyulv.com/archives/ui-startactivity/\&#34;&gt;Activity çš„å¯åŠ¨æµç¨‹&lt;/a&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;!-- more --&gt;\n&lt;h2 id=\&#34;windowçš„åˆ›å»º\&#34;&gt;Windowçš„åˆ›å»º&lt;/h2&gt;\n&lt;p&gt;&lt;code&gt;Activity&lt;/code&gt; çš„åˆ›å»ºåŒæ—¶ä¼´éšç€ &lt;code&gt;Window&lt;/code&gt; çš„åˆ›å»ºï¼Œå¹¶ä¸”ä¸ºå…¶äºŒè€…å»ºç«‹ç›¸åº”çš„è”ç³»ã€‚åœ¨ &lt;code&gt;Android&lt;/code&gt; ä¸­ &lt;code&gt;PhoneWindow&lt;/code&gt; æ˜¯ &lt;code&gt;Window&lt;/code&gt; çš„å”¯ä¸€å®ç°ç±»ï¼Œç³»ç»Ÿå®ä¾‹åŒ–çš„Windowå¯¹è±¡å®é™…æ˜¯å®ƒã€‚åœ¨å…¶ä¹‹ä¸Šä¼šåˆ›å»º &lt;code&gt;DecorView&lt;/code&gt;ï¼Œå®ƒæ˜¯çª—å£çš„è§†å›¾çš„å…·ä½“è½½ä½“ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¹³æ—¶è¯´çš„æ ¹å¸ƒå±€ã€‚é€šå¸¸æˆ‘ä»¬é€šè¿‡ &lt;code&gt;setContentView&lt;/code&gt; æ–¹æ³•è®¾ç½®æˆ‘ä»¬è‡ªå·±çš„è§†å›¾å¸ƒå±€ï¼Œå®ƒä¼šè¢«æ·»åŠ åˆ° &lt;code&gt;DecorView&lt;/code&gt; ä¸­çš„ä¸€ä¸ªå«åš &lt;code&gt;ContentParent&lt;/code&gt; çš„å­View ä¸­ã€‚&lt;/p&gt;\n&lt;p&gt;è¿™é‡Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹çœ‹ Window çš„å®ä¾‹åŒ–è¿‡ç¨‹ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;final void attach(Context context, ActivityThread aThread,\n            Instrumentation instr, IBinder token, int ident,\n            Application application, Intent intent, ActivityInfo info,\n            CharSequence title, Activity parent, String id,\n            NonConfigurationInstances lastNonConfigurationInstances,\n            Configuration config, String referrer, IVoiceInteractor voiceInteractor,\n            Window window, ActivityConfigCallback activityConfigCallback, IBinder assistToken) {\n        attachBaseContext(context);\n\n        mFragments.attachHost(null /*parent*/);\n\t\t// ä»£ç  1\n        mWindow = new PhoneWindow(this, window, activityConfigCallback);\n        mWindow.setWindowControllerCallback(this);\n        mWindow.setCallback(this);\n        mWindow.setOnWindowDismissedCallback(this);\n        mWindow.getLayoutInflater().setPrivateFactory(this);\n    \n    \t\n        if (info.softInputMode != WindowManager.LayoutParams.SOFT_INPUT_STATE_UNSPECIFIED) {\n            mWindow.setSoftInputMode(info.softInputMode);\n        }\n        if (info.uiOptions != 0) {\n            mWindow.setUiOptions(info.uiOptions);\n        }\n    \n    \t// ä»£ç  2\n        mUiThread = Thread.currentThread();\n\n        mMainThread = aThread;\n        mInstrumentation = instr;\n        mToken = token;\n        mAssistToken = assistToken;\n        mIdent = ident;\n        mApplication = application;\n        mIntent = intent;\n        mReferrer = referrer;\n        mComponent = intent.getComponent();\n        mActivityInfo = info;\n        mTitle = title;\n        mParent = parent;\n        mEmbeddedID = id;\n        mLastNonConfigurationInstances = lastNonConfigurationInstances;\n        if (voiceInteractor != null) {\n            if (lastNonConfigurationInstances != null) {\n                mVoiceInteractor = lastNonConfigurationInstances.voiceInteractor;\n            } else {\n                mVoiceInteractor = new VoiceInteractor(voiceInteractor, this, this,\n                        Looper.myLooper());\n            }\n        }\n\n    \t// ä»£ç  3\n        mWindow.setWindowManager(\n                (WindowManager)context.getSystemService(Context.WINDOW_SERVICE),\n                mToken, mComponent.flattenToString(),\n                (info.flags &amp;amp; ActivityInfo.FLAG_HARDWARE_ACCELERATED) != 0);\n        if (mParent != null) {\n            mWindow.setContainer(mParent.getWindow());\n        }\n        mWindowManager = mWindow.getWindowManager();\n        mCurrentConfig = config;\n\n        mWindow.setColorMode(info.colorMode);\n\n        setAutofillOptions(application.getAutofillOptions());\n        setContentCaptureOptions(application.getContentCaptureOptions());\n    }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ä¸Šè¿°ä»£ç æ˜¯ Activity çš„ attach æ–¹æ³•ï¼Œå®ƒæ˜¯ Activity è¢«å®ä¾‹åŒ–åï¼Œç¬¬ä¸€ä¸ªæ‰§è¡Œçš„æ–¹æ³•ï¼ˆæºç  ActivityThread#performLaunchActivity æ–¹æ³•ä¸­ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ®µä»£ç ä¸»è¦å®Œæˆäº†ä»¥ä¸‹å·¥ä½œï¼š&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;mWindow çš„åˆ›å»ºï¼Œå¹¶ä¸”å’Œå®ƒå»ºç«‹ç›¸åº”çš„è”ç³»ï¼Œå„ç§ callback è®¾ç½®æ–¹æ³•ã€‚&lt;/li&gt;\n&lt;li&gt;ç»™ Activity è®¾ç½®åˆå§‹åŒ–å‚æ•°ï¼Œæ¯”å¦‚ Intentã€UIThreadã€Applicationç­‰ã€‚&lt;/li&gt;\n&lt;li&gt;ç»™ mWindow è®¾ç½®ä¸€ä¸ª WindowManagerï¼Œåœ¨ Androidä¸­åŸºæœ¬ä¸Šæ‰€æœ‰çš„ View éƒ½æ˜¯é€šè¿‡ Window æ¥å‘ˆç°çš„ï¼Œæ¯”å¦‚ Activityã€Dialogã€Toastç­‰.&lt;/li&gt;\n&lt;li&gt;https://download.seafile.com/d/6e5297246c/files/?p=%2Fpro%2Fseafile-pro-server_7.0.9_x86-64.tar.gz&amp;amp;dl=1&lt;/li&gt;\n&lt;li&gt;https://download.seafile.com/d/6e5297246c/files/?p=%2Fpro%2Fseafile-pro-server_7.0.9_x86-64.tar.gz.md5.txt&amp;amp;dl=1&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h2 id=\&#34;appcompatactivity-çš„å§”æ‰˜ç±»\&#34;&gt;AppCompatActivity çš„å§”æ‰˜ç±»&lt;/h2&gt;\n&lt;p&gt;åœ¨æˆ‘ä»¬ç¬¬ä¸€æ­¥è¿½è¸ª setContentView ä¸­çš„æ—¶å€™ï¼Œæˆ‘ä»¬å‘ç°äº†è¿™æ ·çš„ä¸€æ®µä»£ç &lt;/p&gt;\n&lt;h3 id=\&#34;ä»£ç -ç‰‡æ®µ1\&#34;&gt;ä»£ç  ç‰‡æ®µ1&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;  @Override\n  public void setContentView(@LayoutRes int layoutResID) {\n    getDelegate().setContentView(layoutResID);\n  }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ä»–æ˜¯é€šè¿‡æ–°å»ºäº†ä¸€ä¸ª AppCompatDelegate è¿™ä¸ªç±»æ¥é—´æ¥è°ƒç”¨ &lt;code&gt;setContentView&lt;/code&gt; çš„æ–¹æ³•ï¼Œç»§ç»­è¿½ä¸‹å»æˆ‘ä»¬å‘ç° AppCompatDelegate åªæœ‰ä¸€ä¸ªå®ç°ç±» AppCompatDelegateImplï¼ˆè¿™é‡Œè¯´æ˜ä¸‹ï¼Œç¬”è€…æ¢ç©¶çš„æºç æ˜¯ androidXçš„ç‰ˆæœ¬ï¼Œå¦‚æœæ˜¯ support åŒ…ä¸‹çš„ï¼ŒAppCompatDelegate çš„å®ç°ç±»æœ‰å¤šä¸ªï¼Œä¼šæ ¹æ® &lt;code&gt;Build.VERSION&lt;/code&gt; æ¥åˆ¤æ–­å…·ä½“å®ä¾‹åŒ–å“ªä¸ªå®ç°ç±»ï¼‰ã€‚&lt;br&gt;\næˆ‘ä»¬æ¥çœ‹çœ‹ä»–çš„å…·ä½“å®ç°ã€‚&lt;/p&gt;\n&lt;h3 id=\&#34;ä»£ç -ç‰‡æ®µ2\&#34;&gt;ä»£ç  ç‰‡æ®µ2&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;@Override\npublic void setContentView(View v, ViewGroup.LayoutParams lp) {\n  // SubDecorView\n  ensureSubDecor();\n  // ContentView é€šè¿‡ mSubDecor æ‰¾åˆ°\n  ViewGroup contentParent = (ViewGroup) mSubDecor.findViewById(android.R.id.content);\n  contentParent.removeAllViews();\n  // è£…è½½æˆ‘ä»¬å®šä¹‰çš„å¸ƒå±€\n  contentParent.addView(v, lp);\n  mOriginalWindowCallback.onContentChanged();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ç»§ç»­çœ‹ &lt;code&gt;ensureSubDecor()&lt;/code&gt; æ–¹æ³•&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;private void ensureSubDecor() {\n    if (!mSubDecorInstalled) {\n        // åˆ›å»º DecorView\n        mSubDecor = createSubDecor();\n        ...\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ç»§ç»­çœ‹ &lt;code&gt;createSubDecor()&lt;/code&gt; æ–¹æ³•&lt;/p&gt;\n&lt;h3 id=\&#34;ä»£ç -ç‰‡æ®µ3\&#34;&gt;ä»£ç  ç‰‡æ®µ3&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;private ViewGroup createSubDecor() {çš„\n    ...\n    // è¿™ä¸€æ®µæ˜¯ æ ¹æ®è·å–å½“å‰Activityçš„styleå¹¶è®¾ç½®ç›¸å…³çš„é£æ ¼çš„ä»£ç \n\n    // Now let&#39;s make sure that the Window has installed its decor by retrieving it\n    mWindow.getDecorView();\n\n    final LayoutInflater inflater = LayoutInflater.from(mContext);\n    ViewGroup subDecor = null;\n\n    // æ ¹æ®ç›¸å…³çš„æ ·å¼åŠ è½½ä¸åŒçš„å¸ƒå±€\n    if (!mWindowNoTitle) {\n        if (mIsFloating) {\n            subDecor = (ViewGroup) inflater.inflate(\n                    R.layout.abc_dialog_title_material, null);\n            ...\n        } else if (mHasActionBar) {\n            ...\n            subDecor = (ViewGroup) LayoutInflater.from(themedContext)\n                    .inflate(R.layout.abc_screen_toolbar, null);\n            ...\n        }\n    } else {\n        if (mOverlayActionMode) {\n            subDecor = (ViewGroup) inflater.inflate(\n                    R.layout.abc_screen_simple_overlay_action_mode, null);\n        } else {\n            subDecor = (ViewGroup) inflater.inflate(R.layout.abc_screen_simple, null);\n        }\n        ...\n        // è¿™ä¸€å †ä¸çœ‹ é€‚é… inset ç›¸å…³\n    }\n    ...\n    \n    // Now set the Window&#39;s content view with the decor\n    mWindow.setContentView(subDecor);\n    ...\n    return subDecor;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ä»ä»¥ä¸Šä»£ç å¯ä»¥çœ‹åˆ° &lt;code&gt;AppCompatDelegate&lt;/code&gt; æ ¹æ®å„ç§ä¸»é¢˜æ ·å¼ä¸åœºæ™¯åˆ›å»ºäº†ä¸€ä¸ª &lt;code&gt;subDecor&lt;/code&gt; çš„Viewï¼Œ&lt;code&gt;subDecor&lt;/code&gt; ä¸­åŒ…å«äº†æˆ‘ä»¬çš„ &lt;code&gt;contentView&lt;/code&gt;ï¼Œæœ€åå°†å…¶å’ŒWindowåšäº†ç»‘å®šã€‚ä½†æ˜¯ä»å‘½åä¸Šæˆ‘ä»¬ä¼¼ä¹çŸ¥é“ï¼Œè¿™ä¸ªå¹¶ä¸æ˜¯çœŸæ­£çš„DecorViewã€‚ä¸ºäº†ä¸€æ¢ç©¶ç«Ÿï¼Œä¸‹é¢æˆ‘ä»¬ç»§ç»­è·Ÿè¿›Windowä¸­æºç ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;windowä¸­çš„æµç¨‹\&#34;&gt;Windowä¸­çš„æµç¨‹&lt;/h2&gt;\n&lt;p&gt;æˆ‘ä»¬ç»§ç»­è·Ÿè¿›ï¼Œå‘ç°Windowæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œæˆ‘ä»¬çŸ¥é“Androidä¸­Windowæœ‰ä¸”åªæœ‰ä¸€ä¸ªå­ç±»ï¼Œé‚£å°±æ˜¯PhoneWindowï¼Œç›´æ¥æ‰¾åˆ°ç›¸å…³å®ç°ï¼Œçœ‹ä»£ç ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;@Override\npublic void setContentView(View view) {\n    setContentView(view, new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;è¿™é‡Œè®¾ç½®äº† &lt;code&gt;subDecor&lt;/code&gt; çš„LayoutParamsã€‚ç»§ç»­è·Ÿè¿›ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;@Override\npublic void setContentView(View view, ViewGroup.LayoutParams params) {\n    if (mContentParent == null) {\n        // åˆå§‹åŒ–æŸäº›ä¸œè¥¿\n        installDecor();\n    } else if (!hasFeature(FEATURE_CONTENT_TRANSITIONS)) {\n        mContentParent.removeAllViews();\n    }\n\n    if (hasFeature(FEATURE_CONTENT_TRANSITIONS)) {\n        view.setLayoutParams(params);\n        final Scene newScene = new Scene(mContentParent, view);\n        transitionTo(newScene);\n    } else {\n        // å°† `subDecor` æ·»åŠ è¿› mContentParent\n        mContentParent.addView(view, params);\n    }\n    mContentParent.requestApplyInsets();\n    final Callback cb = getCallback();\n    if (cb != null &amp;amp;&amp;amp; !isDestroyed()) {\n        cb.onContentChanged();\n    }\n    mContentParentExplicitlySet = true;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;åœ¨ä¸Šä¸€ä¸ªæµç¨‹ä¸­ï¼Œæˆ‘ä»¬çŒœæµ‹ &lt;code&gt;subDecor&lt;/code&gt; å¹¶ä¸æ˜¯ DecorViewï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å‘ç°æœ‰ä¸€ä¸ª &lt;code&gt;installDecor()&lt;/code&gt; çš„æ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œé¢æ˜¯ä¸æ˜¯å°±æ˜¯åˆå§‹åŒ–äº†æˆ‘ä»¬çš„ DecorViewå‘¢ï¼Ÿ&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;private void installDecor() {\n    mForceDecorInstall = false;\n    if (mDecor == null) {\n        // ä»£ç  1\n        mDecor = generateDecor(-1);\n        ...\n    } else {\n        mDecor.setWindow(this);\n    }\n    if (mContentParent == null) {\n        // ä»£ç  2\n        mContentParent = generateLayout(mDecor);\n        Â·Â·Â·\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;è¿›å…¥ä¹‹åå‘ç°äº†ä¸¤å¤„ç¥å¥‡çš„ä»£ç ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªå˜é‡ï¼Œæˆ‘ä»¬çœ‹çœ‹è¿™ä¸¤ä¸ªå˜é‡éƒ½æ˜¯å•¥ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;// è¿™æ˜¯çª—å£çš„é¡¶å±‚å¸ƒå±€\n// This is the top-level view of the window, containing the window decor.\nprivate DecorView mDecor;\n\n// è¿™æ˜¯æ”¾ç½®çª—å£å†…å®¹çš„è§†å›¾ã€‚å®ƒè¦ä¹ˆæ˜¯mDecoræœ¬èº«ï¼Œè¦ä¹ˆæ˜¯mDecorçš„å­å®¹å™¨ã€‚\n// This is the view in which the window contents are placed. It is either\n// mDecor itself, or a child of mDecor where the contents go.\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;ViewGroup mContentParent;&lt;/p&gt;\n&lt;p&gt;å¥½ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œç¡®å®æ‰¾åˆ°äº† DecorViewï¼Œç»§ç»­çœ‹çœ‹ DecorView æ˜¯æ€ä¹ˆè¢«åˆ›å»ºçš„ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;protected DecorView generateDecor(int featureId) {\n    // System process doesn&#39;t have application context and in that case we need to directly use\n    // the context we have. Otherwise we want the application context, so we don&#39;t cling to the\n    // activity.\n    Context context;\n    if (mUseDecorContext) {\n        Context applicationContext = getContext().getApplicationContext();\n        if (applicationContext == null) {\n            context = getContext();\n        } else {\n            context = new DecorContext(applicationContext, getContext());\n            if (mTheme != -1) {\n                context.setTheme(mTheme);\n            }\n        }\n    } else {\n        context = getContext();\n    }\n    // åˆ›å»ºäº† DecorView å¹¶ä¸”å°† this  windowä¼ å…¥è¿›è¡Œç»‘å®š\n    return new DecorView(context, featureId, this, getAttributes());\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;è¿™é‡Œæˆ‘ä»¬çœ‹åˆ° DecorView ç¡®å®è¢«åˆ›å»ºå‡ºæ¥äº†ã€‚ç„¶åæˆ‘ä»¬çœ‹çœ‹ mContentParentã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;protected ViewGroup generateLayout(DecorView decor) {\n    // Apply data from current theme.\n\n    TypedArray a = getWindowStyle();\n    ... æ ¹æ®styleè¿›è¡Œä¸€ç³»åˆ—èµ‹å€¼æ“ä½œ\n    // Inflate the window decor.\n\n    int layoutResource;\n    int features = getLocalFeatures();\n    ... ç»™ layoutResource è¿›è¡Œèµ‹å€¼æ“ä½œ\n\n    mDecor.startChanging();\n    mDecor.onResourcesLoaded(mLayoutInflater, layoutResource);\n\n    ViewGroup contentParent = (ViewGroup)findViewById(ID_ANDROID_CONTENT);\n   \n    ...\n\n    return contentParent;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;æˆ‘ä»¬çœ‹åˆ° ä¸Šé¢æœ‰è¿™æ ·çš„ä¸€æ®µä»£ç  &lt;code&gt;mDecor.onResourcesLoaded(mLayoutInflater, layoutResource);&lt;/code&gt; è¿™æ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿç»§ç»­è·Ÿè¿›ï¼š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;void onResourcesLoaded(LayoutInflater inflater, int layoutResource) {\n    ...\n    // inflate äº†è¿™ä¸ªèµ„æºæ–‡ä»¶\n    final View root = inflater.inflate(layoutResource, null);\n    if (mDecorCaptionView != null) {\n        if (mDecorCaptionView.getParent() == null) {\n            addView(mDecorCaptionView,\n                    new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));\n        }\n        mDecorCaptionView.addView(root,\n                new ViewGroup.MarginLayoutParams(MATCH_PARENT, MATCH_PARENT));\n    } else {\n\n        // å°†è¿™ä¸ªå¸ƒå±€æ–‡ä»¶ addè¿›DecorView ä¸­.\n        addView(root, 0, new ViewGroup.LayoutParams(MATCH_PARENT, MATCH_PARENT));\n    }\n    mContentRoot = (ViewGroup) root;\n    initializeElevation();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œ inflate äº†è¿™ä¸ªèµ„æºæ–‡ä»¶ï¼Œå¹¶ä¸”å°†å®ƒæ·»åŠ è¿›äº†DecorViewä¸­ï¼Œåœ¨ä¸Šä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬å‘ç°äº† contentParent æ˜¯é€šè¿‡ findViewById å‡ºæ¥çš„ï¼Œè¿›å»å¯ä»¥çœ‹åˆ°&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;public &amp;lt;T extends View&amp;gt; T findViewById(@IdRes int id) {\n    return getDecorView().findViewById(id);\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å®ƒæ˜¯é€šè¿‡DecorViewæ‰¾å‡ºæ¥çš„ï¼Œç°åœ¨è®©æˆ‘ä»¬æ¥æ¢³ç†ä¸‹Windowçš„setContentViewçš„æ–¹æ³•éƒ½å¹²äº†ä»€ä¹ˆã€‚&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;åˆå§‹åŒ–äº†DecorView&lt;/li&gt;\n&lt;li&gt;æ ¹æ®styleçš„ä¸åŒè®¾ç½®äº†ä¸åŒçš„feature&lt;/li&gt;\n&lt;li&gt;æ ¹æ®featureçš„ä¸åŒå¾—åˆ°äº†ä¸åŒçš„layoutResource&lt;/li&gt;\n&lt;li&gt;ç”¨layoutResource  inflateå‡ºäº†ä¸åŒå¸ƒå±€çš„Viewï¼Œå¹¶ä¸”è¢«æ·»åŠ åˆ°äº†DecorViewä¸­&lt;/li&gt;\n&lt;li&gt;é€šè¿‡DecorViewçš„findViewByIdçš„æ–¹æ³•æ‰¾åˆ°äº†contentView&lt;/li&gt;\n&lt;li&gt;contentViewå°†setContentViewä¸­Viewæ·»åŠ äº†è¿›å»&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;ç»“åˆAppCompatActivityä¸­setContentViewçš„æµç¨‹ï¼Œæ•´ä½“æµç¨‹å°±å˜æˆäº†&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;æ ¹æ®ä¸åŒçš„ä¸»é¢˜ç­‰ï¼Œåˆå§‹åŒ–SubDecorView&lt;/li&gt;\n&lt;li&gt;åˆå§‹åŒ–äº†DecorView&lt;/li&gt;\n&lt;li&gt;æ ¹æ®styleçš„ä¸åŒè®¾ç½®äº†ä¸åŒçš„feature&lt;/li&gt;\n&lt;li&gt;æ ¹æ®featureçš„ä¸åŒå¾—åˆ°äº†ä¸åŒçš„layoutResource&lt;/li&gt;\n&lt;li&gt;ç”¨layoutResource  inflateå‡ºäº†ä¸åŒå¸ƒå±€çš„Viewï¼Œå¹¶ä¸”è¢«æ·»åŠ åˆ°äº†DecorViewä¸­&lt;/li&gt;\n&lt;li&gt;é€šè¿‡DecorViewçš„findViewByIdçš„æ–¹æ³•æ‰¾åˆ°äº†contentView&lt;/li&gt;\n&lt;li&gt;contentViewå°†SubDecorViewæ·»åŠ äº†è¿›å»&lt;/li&gt;\n&lt;li&gt;SubDecorViewä¸­çš„contentViewå°†setContentViewä¸­Viewæ·»åŠ äº†è¿›å»&lt;/li&gt;\n&lt;/ol&gt;\n&#34;,&#34;fileName&#34;:&#34;ui-hui-zhi-liu-cheng-cong-setcontentview-shuo-qi&#34;,&#34;abstract&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;å¹³æ—¶æˆ‘ä»¬åœ¨å†™ &lt;code&gt;Android&lt;/code&gt; &lt;code&gt;UI&lt;/code&gt; æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šé€šè¿‡ &lt;code&gt;setContentVoew&lt;/code&gt; æ–¹æ³•ï¼Œå°†æˆ‘ä»¬çš„å¸ƒå±€èµ„æºäº¤ç»™ &lt;code&gt;Activity&lt;/code&gt;ï¼Œè®©å®ƒå»è¿›è¡Œå…³è” &lt;code&gt;window&lt;/code&gt;ï¼Œè§£æ &lt;code&gt;å¸ƒå±€&lt;/code&gt;ï¼Œæ¸²æŸ“ &lt;code&gt;è§†å›¾&lt;/code&gt; ï¼Œæœ€ç»ˆåœ¨å±å¹•ä¸Šå±•ç°å‡ºäº†æˆ‘ä»¬éœ€è¦çš„æ•ˆæœã€‚ä¸Šä¸€èŠ‚æˆ‘ä»¬åˆ†æäº† &lt;code&gt;Activity&lt;/code&gt; çš„å¯åŠ¨æµç¨‹ï¼ŒçŸ¥é“äº†æ–° &lt;code&gt;Activity&lt;/code&gt; æœ€ç»ˆéƒ½ä¼šé€šè¿‡ &lt;code&gt;AMS&lt;/code&gt; å’Œ &lt;code&gt;ClientLifecycleManager&lt;/code&gt; çš„ç›¸äº’è°ƒåº¦ä¾æ¬¡æ‰§è¡Œ &lt;code&gt;attach&lt;/code&gt; ã€&lt;code&gt;performCreate&lt;/code&gt;ã€&lt;code&gt;performStart&lt;/code&gt; å’Œ &lt;code&gt;performResume&lt;/code&gt; çš„å››ä¸ªæ–¹æ³•ï¼Œä¸‹é¢æˆ‘ä»¬å°±æŒ‰ç…§è¿™ä¸ªæµç¨‹æ¥èŠèŠå¸ƒå±€çš„ &lt;code&gt;ç»‘å®š&lt;/code&gt;ã€ &lt;code&gt;è§£æ&lt;/code&gt; å’Œ &lt;code&gt;æ¸²æŸ“&lt;/code&gt; çš„æµç¨‹ã€‚&lt;/p&gt;\n&lt;p&gt;é™„ï¼š&lt;a href=\&#34;https://blog.cyulv.com/archives/ui-startactivity/\&#34;&gt;Activity çš„å¯åŠ¨æµç¨‹&lt;/a&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&#34;,&#34;title&#34;:&#34;UIç»˜åˆ¶æµç¨‹-ä»setContentViewè¯´èµ·&#34;,&#34;tags&#34;:[{&#34;index&#34;:-1,&#34;name&#34;:&#34;Android&#34;,&#34;slug&#34;:&#34;android&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://caoyu.me/tag/android/&#34;}],&#34;date&#34;:&#34;2020-12-24 01:00:16&#34;,&#34;dateFormat&#34;:&#34;2020-12-24&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://caoyu.me/post/ui-hui-zhi-liu-cheng-cong-setcontentview-shuo-qi/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;9 min read&#34;,&#34;time&#34;:526000,&#34;words&#34;:1945,&#34;minutes&#34;:9},&#34;description&#34;:&#34;\nå¹³æ—¶æˆ‘ä»¬åœ¨å†™ Android UI æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šé€šè¿‡ setContentVoew æ–¹æ³•ï¼Œå°†æˆ‘ä»¬çš„å¸ƒå±€èµ„æºäº¤ç»™ Activityï¼Œè®©å®ƒå»è¿›è¡Œå…³è” windowï¼Œè§£æ å¸ƒå±€ï¼Œæ¸²æŸ“ è§†å›¾ ï¼Œæœ€ç»ˆåœ¨å±å¹•ä¸Šå±•ç°å‡ºäº†æˆ‘ä»¬éœ€è¦çš„æ•ˆæœã€‚ä¸Šä¸€èŠ‚æˆ‘ä»¬åˆ†æäº†...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#window%E7%9A%84%E5%88%9B%E5%BB%BA\&#34;&gt;Windowçš„åˆ›å»º&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#appcompatactivity-%E7%9A%84%E5%A7%94%E6%89%98%E7%B1%BB\&#34;&gt;AppCompatActivity çš„å§”æ‰˜ç±»&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BB%A3%E7%A0%81-%E7%89%87%E6%AE%B51\&#34;&gt;ä»£ç  ç‰‡æ®µ1&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BB%A3%E7%A0%81-%E7%89%87%E6%AE%B52\&#34;&gt;ä»£ç  ç‰‡æ®µ2&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BB%A3%E7%A0%81-%E7%89%87%E6%AE%B53\&#34;&gt;ä»£ç  ç‰‡æ®µ3&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#window%E4%B8%AD%E7%9A%84%E6%B5%81%E7%A8%8B\&#34;&gt;Windowä¸­çš„æµç¨‹&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;è§¦æ‘¸äº‹ä»¶ç±»å‹\&#34;&gt;è§¦æ‘¸äº‹ä»¶ç±»å‹&lt;/h2&gt;\n&lt;p&gt;è§¦æ‘¸äº‹ä»¶å¯¹åº”çš„ç±»æ˜¯ MotionEvent ç±»ï¼Œäº‹ä»¶çš„ä¸»è¦ç±»å‹æœ‰ä»¥ä¸‹å››ç§ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;ACTION_DOWN æ‰‹æŒ‡åˆšæ¥è§¦å±å¹•&lt;/li&gt;\n&lt;li&gt;ACTION_MOVE æ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ»‘åŠ¨&lt;/li&gt;\n&lt;li&gt;ACTION_UP æ‰‹æŒ‡ä»å±å¹•ä¸ŠæŠ¬èµ·&lt;/li&gt;\n&lt;li&gt;ACTION_CANCEL éäººä¸ºå› ç´ å–æ¶ˆÃŸ&lt;/li&gt;\n&lt;/ul&gt;\n&lt;!-- more --&gt;\n&lt;p&gt;View äº‹ä»¶åˆ†å‘çš„æœ¬è´¨å°±æ˜¯å°† MotionEvent ç±»åˆ†å‘ç»™å…·ä½“æŸä¸ªView å¤„ç†çš„è¿‡ç¨‹ï¼Œä¸€æ¬¡å®Œæ•´çš„äº‹ä»¶å“åº”åŒ…å« ä¸€ä¸ª ACTION_DOWN äº‹ä»¶ï¼Œä¸­é—´ä»»æ„ä¸ª ACTION_MOVE äº‹ä»¶ï¼Œä»¥åŠæœ€åçš„ ACTION_UP äº‹ä»¶æˆ–è€… ACTION_CANCEL äº‹ä»¶ã€‚&lt;/p&gt;\n&lt;p&gt;å…¶ä¸­ ACTION_CANCEL äº‹ä»¶çš„è§¦å‘ä¼šåœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹å‘ç”Ÿï¼š&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;å¦‚æœåœ¨çˆ¶Viewä¸­æ‹¦æˆªACTION_UPæˆ–ACTION_MOVEï¼Œåœ¨ç¬¬ä¸€æ¬¡çˆ¶è§†å›¾æ‹¦æˆªæ¶ˆæ¯çš„ç¬é—´ï¼Œçˆ¶è§†å›¾æŒ‡å®šå­è§†å›¾ä¸æ¥å—åç»­æ¶ˆæ¯äº†ï¼ŒåŒæ—¶å­è§†å›¾ä¼šæ”¶åˆ°ACTION_CANCELäº‹ä»¶ã€‚&lt;/li&gt;\n&lt;li&gt;å¦‚æœè§¦æ‘¸æŸä¸ªæ§ä»¶ï¼Œä½†æ˜¯åˆä¸æ˜¯åœ¨è¿™ä¸ªæ§ä»¶çš„åŒºåŸŸä¸ŠæŠ¬èµ·ï¼ˆç§»åŠ¨åˆ°åˆ«çš„åœ°æ–¹äº†ï¼‰ï¼Œå°±ä¼šå‡ºç°action_cancelã€‚&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h2 id=\&#34;äº‹ä»¶åˆ†å‘çš„å¯¹è±¡\&#34;&gt;äº‹ä»¶åˆ†å‘çš„å¯¹è±¡&lt;/h2&gt;\n&lt;p&gt;å…·å¤‡äº‹ä»¶åˆ†å‘èƒ½åŠ›çš„å¯¹è±¡æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;Activity æ§åˆ¶å½“å‰é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»¥åŠäº‹ä»¶åˆ†å‘çš„ç¬¬ä¸€å±‚View&lt;/li&gt;\n&lt;li&gt;ViewGroup ä¸€ç»„Viewçš„é›†åˆï¼ŒåŒ…å«å¤šä¸ª View æˆ–è€… ViewGroup&lt;/li&gt;\n&lt;li&gt;View æ‰€æœ‰ UI ç»„ä»¶çš„åŸºç±»&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;äº‹ä»¶åˆ†å‘çš„å¤§è‡´æµç¨‹ï¼šå½“æ‰‹æŒ‡è§¦ç¢°åˆ°å±å¹•æ—¶ï¼Œç³»ç»Ÿåº•å±‚ä¼šå‘å‡ºä¸€ä¸ªä¿¡å·ï¼Œæœ€ç»ˆåˆ°è¾¾ Activityï¼Œç”±Activityå‘ä¸‹æŠŠäº‹ä»¶åˆ†ç»™ä¸‹å±‚çš„ViewGroupï¼Œå†ç”±ä¸‹å±‚çš„ViewGroupå‘ä¸‹åˆ†å‘ï¼Œç›´åˆ°æ‰¾åˆ°å¯ä»¥å¤„ç†å½“å‰äº‹ä»¶çš„è§†å›¾ï¼Œå¹¶æŠŠåç»­äº‹ä»¶ä¹Ÿäº¤ç»™å…¶å¤„ç†ã€‚&lt;/p&gt;\n&lt;h2 id=\&#34;äº‹ä»¶åˆ†å‘çš„æ–¹æ³•\&#34;&gt;äº‹ä»¶åˆ†å‘çš„æ–¹æ³•&lt;/h2&gt;\n&lt;p&gt;äº‹ä»¶åˆ†å‘çš„è¿‡ç¨‹ç”±ä¸‰ä¸ªä¸»è¦çš„æ–¹æ³•å®Œæˆï¼š&lt;/p&gt;\n&lt;ol&gt;\n&lt;li&gt;dispatchTouchEventï¼šåˆ†å‘ã€‚è¿”å› true è¡¨ç¤ºäº‹ä»¶è¢«å½“å‰ View æ¶ˆè´¹æ‰ï¼›è¿”å› false è¡¨ç¤ºäº¤ç»™çˆ¶ç±»å»å¤„ç†ï¼Œè¿”å› super.dispatchTouchEvent è¡¨ç¤ºç»§ç»­åˆ†å‘ä¸‹å»ã€‚&lt;/li&gt;\n&lt;li&gt;onInterceptTouchEventï¼šåˆ¤æ–­äº‹ä»¶æ˜¯å¦æ‹¦æˆªï¼ˆåªå­˜åœ¨äºViewGroupä¸­ï¼‰&lt;/li&gt;\n&lt;li&gt;onTouchEventï¼šäº‹ä»¶çš„å¤„ç†&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h2 id=\&#34;äº‹ä»¶åˆ†å‘æµç¨‹\&#34;&gt;äº‹ä»¶åˆ†å‘æµç¨‹&lt;/h2&gt;\n&lt;h3 id=\&#34;activity-ä¸­çš„-åˆ†å‘è¿‡ç¨‹\&#34;&gt;Activity ä¸­çš„ åˆ†å‘è¿‡ç¨‹&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;public boolean dispatchTouchEvent(MotionEvent ev) {\n    if (ev.getAction() == MotionEvent.ACTION_DOWN) {\n        onUserInteraction();\n    }\n\t\t// äº¤ç»™ DecorView å»åˆ†å‘äº‹ä»¶\n    if (getWindow().superDispatchTouchEvent(ev)) {\n        return true;\n    }\n\t\t// å¦‚æœ DecorView æ²¡æœ‰å¤„ç†è¿™ä¸ªäº‹ä»¶ï¼Œå°†äº‹ä»¶äº¤ç»™è‡ªå·±å¤„ç†\n    return onTouchEvent(ev);\n}\n\n// \npublic boolean onTouchEvent(MotionEvent event) {\n\t\t// é’ˆå¯¹ ç±»ä¼¼ DialogActivityï¼Œç‚¹å‡»äº†å¤–éƒ¨åŒºåŸŸï¼Œå…³é—­å½“å‰çš„ Activity\n    if (mWindow.shouldCloseOnTouch(this, event)) {\n        finish();\n        return true;\n    }\n\n    return false;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;viewgroupä¸­çš„äº‹ä»¶åˆ†å‘\&#34;&gt;ViewGroupä¸­çš„äº‹ä»¶åˆ†å‘&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;public boolean dispatchTouchEvent(MotionEvent ev) {\n    boolean handled = false;\n\t\t// \n    if (onFilterTouchEventForSecurity(ev)) {\n\t\t\t\t...\n        // åˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆªè¿™ä¸ªäº‹ä»¶\n        final boolean intercepted;\n\t\t\t\t// DOWN äº‹ä»¶ï¼Œæˆ–è€…å·²ç»æœ‰ç›¸åº”è§†å›¾å¤„ç†è¿‡ä¹‹å‰çš„äº‹ä»¶\n\t\t\t\t// mFirstTouchTarget ä¸»è¦æ˜¯ç”¨æ¥è®°å½• ä» é¡¶å±‚å®¹å™¨ åˆ° å¤„ç†è¿™ä¸ª äº‹ä»¶çš„ ä¸€ä¸ªView çš„é“¾è·¯\n\t\t\t\t// ç¬¬äºŒæ¬¡çš„äº‹ä»¶åˆ†å‘ å°±ç›´æ¥èµ°è¿™ä¸ª é“¾è·¯è¿›è¡Œåˆ†å‘\n        if (actionMasked == MotionEvent.ACTION_DOWN || mFirstTouchTarget != null) {\n            \n\t\t\t\t\t\tfinal boolean disallowIntercept = (mGroupFlags &amp;amp; FLAG_DISALLOW_INTERCEPT) != 0;\n\t\t\t\t\t\t// å­ç±»æ˜¯å¦è¦æ±‚çˆ¶ç±»ä¸æ‹¦æˆª\n\t\t\t\t\t\tif (!disallowIntercept) {\n                intercepted = onInterceptTouchEvent(ev);\n                ev.setAction(action); // restore action in case it was changed\n            } else {\n                intercepted = false;\n            }\n        } else {\n            // æ²¡æœ‰æ‰¾åˆ°å¤„ç†è¿‡äº‹ä»¶çš„è§†å›¾ï¼Œå¹¶ä¸”ä¹Ÿä¸æ˜¯ down äº‹ä»¶\n            intercepted = true;\n        }\n\n        ...\n        if (!canceled &amp;amp;&amp;amp; !intercepted) {\n\t\t\t\t\t\t...\n            if (actionMasked == MotionEvent.ACTION_DOWN\n                    || (split &amp;amp;&amp;amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN)\n                    || actionMasked == MotionEvent.ACTION_HOVER_MOVE) {\n\t\t\t\t\t\t\t\t...\n\t\t\t\t\t\t\t\t// åˆ¤æ–­å“ªäº›å­Viewå¯ä»¥æ¥æ”¶è¿™ä¸ªçš„äº‹ä»¶åˆ†å‘\n             }\n\t\t\t\t}\n\n        // åˆ›å»º äº‹ä»¶åˆ†å‘çš„é“¾è¡¨\n        if (mFirstTouchTarget == null) {\n            // No touch targets so treat this as an ordinary view.\n            handled = dispatchTransformedTouchEvent(ev, canceled, null,\n                    TouchTarget.ALL_POINTER_IDS);\n        } else {\n            // Dispatch to touch targets, excluding the new touch target if we already\n            // dispatched to it.  Cancel touch targets if necessary.\n            TouchTarget predecessor = null;\n            TouchTarget target = mFirstTouchTarget;\n            while (target != null) {\n                final TouchTarget next = target.next;\n                if (alreadyDispatchedToNewTouchTarget &amp;amp;&amp;amp; target == newTouchTarget) {\n                    handled = true;\n                } else {\n                    final boolean cancelChild = resetCancelNextUpFlag(target.child)\n                            || intercepted;\n                    if (dispatchTransformedTouchEvent(ev, cancelChild,\n                            target.child, target.pointerIdBits)) {\n                        handled = true;\n                    }\n                    if (cancelChild) {\n                        if (predecessor == null) {\n                            mFirstTouchTarget = next;\n                        } else {\n                            predecessor.next = next;\n                        }\n                        target.recycle();\n                        target = next;\n                        continue;\n                    }\n                }\n                predecessor = target;\n                target = next;\n            }\n        }\n    }\n    return handled;\n}\n\nfinal int childrenCount = mChildrenCount;\n      if (newTouchTarget == null &amp;amp;&amp;amp; childrenCount != 0) {\n            final float x = ev.getX(actionIndex);\n            final float y = ev.getY(actionIndex);\n            // æ‰¾åˆ°èƒ½å¤„ç†è¿™ä¸ª Event çš„ å­View \n            final ArrayList&amp;lt;View&amp;gt; preorderedList = buildTouchDispatchChildList();\n            final boolean customOrder = preorderedList == null\n                    &amp;amp;&amp;amp; isChildrenDrawingOrderEnabled();\n            final View[] children = mChildren;\n            for (int i = childrenCount - 1; i &amp;gt;= 0; i--) {\n                final int childIndex = getAndVerifyPreorderedIndex(\n                        childrenCount, i, customOrder);\n                final View child = getAndVerifyPreorderedView(\n                        preorderedList, children, childIndex);\n\t\t\t\t\t\t\t\t// åˆ¤æ–­è¿™ä¸ªå­View æ˜¯å¦èƒ½å¤„ç†è¿™ä¸ª Event\n                if (!canViewReceivePointerEvents(child)\n                        || !isTransformedTouchPointInView(x, y, child, null)) {\n                    ev.setTargetAccessibilityFocus(false);\n                    continue;\n                }\n\n                newTouchTarget = getTouchTarget(child);\n                if (newTouchTarget != null) {\n                    // Child is already receiving touch within its bounds.\n                    // Give it the new pointer in addition to the ones it is handling.\n                    newTouchTarget.pointerIdBits |= idBitsToAssign;\n                    break;\n                }\n\n                resetCancelNextUpFlag(child);\n\t\t\t\t\t\t\t\t// å¾€å­Viewåšåˆ†å‘\n                if (dispatchTransformedTouchEvent(ev, false, child, idBitsToAssign)) {\n                    ...\n\t\t\t\t\t\t\t\t\t\t// æ­å»ºäº‹ä»¶åˆ†å‘å¤„ç†é“¾è¡¨\n                    newTouchTarget = addTouchTarget(child, idBitsToAssign);\n                    \n                    break;\n                }\n\n                // The accessibility focus didn&#39;t handle the event, so clear\n                // the flag and do a normal dispatch to all children.\n                ev.setTargetAccessibilityFocus(false);\n            }\n            if (preorderedList != null) preorderedList.clear();\n        }\n\n        if (newTouchTarget == null &amp;amp;&amp;amp; mFirstTouchTarget != null) {\n            // Did not find a child to receive the event.\n            // Assign the pointer to the least recently added target.\n            newTouchTarget = mFirstTouchTarget;\n            while (newTouchTarget.next != null) {\n                newTouchTarget = newTouchTarget.next;\n            }\n            newTouchTarget.pointerIdBits |= idBitsToAssign;\n        }\n    }\n}\n\nprivate boolean dispatchTransformedTouchEvent(MotionEvent event, boolean cancel,\n            View child, int desiredPointerIdBits) {\n    final boolean handled;\n\t\t...\n    if (child == null) {\n\t\t\t\t// å¦‚æœå·²ç»æ²¡æœ‰å­View äº†ï¼Œè°ƒç”¨çˆ¶ç±»çš„ åˆ†å‘æ–¹æ³•ï¼Œè¿™é‡Œä¸€èˆ¬å°±ç›´æ¥è°ƒç”¨äº† View çš„åˆ†å‘æ–¹æ³•\n        handled = super.dispatchTouchEvent(transformedEvent);\n    } else {\n\t\t\t\t...\n\t\t\t\t// ä¼ ç»™å­View å»è¿›è¡Œåˆ†å‘\n        handled = child.dispatchTouchEvent(transformedEvent);\n    }\n    return handled;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;view-ä¸­çš„äº‹ä»¶åˆ†å‘\&#34;&gt;View ä¸­çš„äº‹ä»¶åˆ†å‘&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;public boolean dispatchTouchEvent(MotionEvent event) {\n\n    boolean result = false;\n\t\t// å½“å‰ View æ˜¯å¦å¯è§ æˆ–è€…æ˜¯å¦è¢«é®æŒ¡\n    if (onFilterTouchEventForSecurity(event)) {\n        if ((mViewFlags &amp;amp; ENABLED_MASK) == ENABLED &amp;amp;&amp;amp; handleScrollBarDragging(event)) {\n            result = true;\n        }\n\n        ListenerInfo li = mListenerInfo;\n\t\t\t\t// ä¼˜å…ˆå“åº” onTouchListener äº‹ä»¶\n        if (li != null &amp;amp;&amp;amp; li.mOnTouchListener != null\n                &amp;amp;&amp;amp; (mViewFlags &amp;amp; ENABLED_MASK) == ENABLED\n                &amp;amp;&amp;amp; li.mOnTouchListener.onTouch(this, event)) {\n            result = true;\n        }\n\t\t\t\t// onTouchListener äº‹ä»¶ è¿”å› falseï¼Œå“åº”è‡ªèº«çš„ onTouchEvent äº‹ä»¶\n        if (!result &amp;amp;&amp;amp; onTouchEvent(event)) {\n            result = true;\n        }\n    }\n\n    return result;\n}\n\npublic boolean onTouchEvent(MotionEvent event) {\n\t\t// åˆ¤æ–­å½“å‰View æ˜¯å¦å¯ç‚¹å‡» å¯é•¿æŒ‰ï¼Œå¦‚æœ å¯ç‚¹å‡»å¯é•¿æŒ‰çš„è¯ï¼Œæœ€ç»ˆä¸€å®š return true\n    final boolean clickable = ((viewFlags &amp;amp; CLICKABLE) == CLICKABLE\n            || (viewFlags &amp;amp; LONG_CLICKABLE) == LONG_CLICKABLE)\n            || (viewFlags &amp;amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE;\n\t\t// æœ‰è®¾ç½®ä»£ç†èµ° ä»£ç†æ–¹æ³•\n    if (mTouchDelegate != null) {\n        if (mTouchDelegate.onTouchEvent(event)) {\n            return true;\n        }\n    }\n\n    if (clickable || (viewFlags &amp;amp; TOOLTIP) == TOOLTIP) {\n\t\t\t\t...\n\t\t\t\treturn true;\n    }\n\n    return false;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;action_down\&#34;&gt;ACTION_DOWN&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;mHasPerformedLongPress = false;\n\nif (!clickable) {\n    checkForLongClick(0, x, y);\n    break;\n}\n\n// Walk up the hierarchy to determine if we&#39;re inside a scrolling container.\nboolean isInScrollingContainer = isInScrollingContainer();\n\nif (isInScrollingContainer) {\n    mPrivateFlags |= PFLAG_PREPRESSED;\n    if (mPendingCheckForTap == null) {\n        mPendingCheckForTap = new CheckForTap();\n    }\n    mPendingCheckForTap.x = event.getX();\n    mPendingCheckForTap.y = event.getY();\n    postDelayed(mPendingCheckForTap, ViewConfiguration.getTapTimeout());\n} else {\n    // Not inside a scrolling container, so show the feedback right away\n    setPressed(true, x, y);\n    checkForLongClick(0, x, y);\n}\n\n// é€šè¿‡ Handler å‘é€ä¸€ä¸ª 500ms çš„å»¶è¿Ÿæ¶ˆæ¯ï¼Œåœ¨ CheckForLongPress run æ–¹æ³•ä¸­å°† \n// mHasPerformedLongPress æ ‡å¿—ä½è®¾ç½®ä¸º ture ä»£è¡¨é•¿æŒ‰æ–¹æ³•å·²ç»æ‰§è¡Œ\nprivate void checkForLongClick(int delayOffset, float x, float y) {\n    if ((mViewFlags &amp;amp; LONG_CLICKABLE) == LONG_CLICKABLE || (mViewFlags &amp;amp; TOOLTIP) == TOOLTIP) {\n        mHasPerformedLongPress = false;\n\n        if (mPendingCheckForLongPress == null) {\n            mPendingCheckForLongPress = new CheckForLongPress();\n        }\n        mPendingCheckForLongPress.setAnchor(x, y);\n        mPendingCheckForLongPress.rememberWindowAttachCount();\n        mPendingCheckForLongPress.rememberPressedState();\n        postDelayed(mPendingCheckForLongPress,\n                ViewConfiguration.getLongPressTimeout() - delayOffset);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;action_cancel\&#34;&gt;ACTION_CANCEL&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;if (clickable) {\n    setPressed(false);\n}\n// ç§»é™¤ DOWN äº‹ä»¶æ—¶ï¼Œé€šè¿‡Handlerå‘å‡ºçš„æ¶ˆæ¯ï¼Œä¸åœ¨è§¦å‘ LongClick\nremoveTapCallback();\nremoveLongPressCallback();\nmInContextButtonPress = false;\nmHasPerformedLongPress = false;\nmIgnoreNextUpEvent = false;\nmPrivateFlags3 &amp;amp;= ~PFLAG3_FINGER_DOWN;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;action_move\&#34;&gt;ACTION_MOVE&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;if (clickable) {\n    drawableHotspotChanged(x, y);\n}\n\n// æ»‘åŠ¨åˆ°å¤–éƒ¨å»äº† \nif (!pointInView(x, y, mTouchSlop)) {\n    // ç§»é™¤ DOWN äº‹ä»¶æ—¶ï¼Œé€šè¿‡Handlerå‘å‡ºçš„æ¶ˆæ¯ï¼Œä¸åœ¨è§¦å‘ LongClick\n    removeTapCallback();\n    removeLongPressCallback();\n    if ((mPrivateFlags &amp;amp; PFLAG_PRESSED) != 0) {\n        setPressed(false);\n    }\n    mPrivateFlags3 &amp;amp;= ~PFLAG3_FINGER_DOWN;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h3 id=\&#34;action_up\&#34;&gt;ACTION_UP&lt;/h3&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt;boolean prepressed = (mPrivateFlags &amp;amp; PFLAG_PREPRESSED) != 0;\nif ((mPrivateFlags &amp;amp; PFLAG_PRESSED) != 0 || prepressed) {\n\t\t// å¦‚æœé•¿æŒ‰äº‹ä»¶æ²¡æœ‰å“åº”ï¼Œè¿™ä¸ªæ—¶å€™æ¥æ‰§è¡Œç‚¹å‡»äº‹ä»¶\n    if (!mHasPerformedLongPress &amp;amp;&amp;amp; !mIgnoreNextUpEvent) {\n        // ç§»é™¤ DOWN äº‹ä»¶æ—¶ï¼Œé€šè¿‡Handlerå‘å‡ºçš„æ¶ˆæ¯ï¼Œä¸åœ¨è§¦å‘ LongClick\n        removeLongPressCallback();\n        if (!focusTaken) {\n\n            if (mPerformClick == null) {\n                mPerformClick = new PerformClick();\n            }\n            if (!post(mPerformClick)) {\n                performClickInternal();\n            }\n        }\n    }\n    removeTapCallback();\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;äº‹ä»¶åˆ†å‘çš„æ•´ä½“æ¨¡å‹\&#34;&gt;äº‹ä»¶åˆ†å‘çš„æ•´ä½“æ¨¡å‹&lt;/h2&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://caoyu.me/post-images/1608742799596.png\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h2 id=\&#34;æ»‘åŠ¨äº‹ä»¶å†²çª\&#34;&gt;æ»‘åŠ¨äº‹ä»¶å†²çª&lt;/h2&gt;\n&lt;h3 id=\&#34;å¤–éƒ¨æ‹¦æˆª\&#34;&gt;å¤–éƒ¨æ‹¦æˆª&lt;/h3&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;2\&#34;&gt;&lt;img src=\&#34;https://s3-us-west-2.amazonaws.com/secure.notion-static.com/789a1c01-3584-4986-a2e6-a7f157d0bfda/Untitled.png\&#34; alt=\&#34;https://s3-us-west-2.amazonaws.com/secure.notion-static.com/789a1c01-3584-4986-a2e6-a7f157d0bfda/Untitled.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;h3 id=\&#34;å†…éƒ¨æ‹¦æˆª\&#34;&gt;å†…éƒ¨æ‹¦æˆª&lt;/h3&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;3\&#34;&gt;&lt;img src=\&#34;https://s3-us-west-2.amazonaws.com/secure.notion-static.com/868f6ae1-fcdd-4f4c-b985-27c5e40516e9/Untitled.png\&#34; alt=\&#34;https://s3-us-west-2.amazonaws.com/secure.notion-static.com/868f6ae1-fcdd-4f4c-b985-27c5e40516e9/Untitled.png\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&#34;,&#34;fileName&#34;:&#34;shi-jian-fen-fa&#34;,&#34;abstract&#34;:&#34;&lt;h2 id=\&#34;è§¦æ‘¸äº‹ä»¶ç±»å‹\&#34;&gt;è§¦æ‘¸äº‹ä»¶ç±»å‹&lt;/h2&gt;\n&lt;p&gt;è§¦æ‘¸äº‹ä»¶å¯¹åº”çš„ç±»æ˜¯ MotionEvent ç±»ï¼Œäº‹ä»¶çš„ä¸»è¦ç±»å‹æœ‰ä»¥ä¸‹å››ç§ï¼š&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;ACTION_DOWN æ‰‹æŒ‡åˆšæ¥è§¦å±å¹•&lt;/li&gt;\n&lt;li&gt;ACTION_MOVE æ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ»‘åŠ¨&lt;/li&gt;\n&lt;li&gt;ACTION_UP æ‰‹æŒ‡ä»å±å¹•ä¸ŠæŠ¬èµ·&lt;/li&gt;\n&lt;li&gt;ACTION_CANCEL éäººä¸ºå› ç´ å–æ¶ˆÃŸ&lt;/li&gt;\n&lt;/ul&gt;\n&#34;,&#34;title&#34;:&#34;äº‹ä»¶åˆ†å‘&#34;,&#34;tags&#34;:[{&#34;index&#34;:-1,&#34;name&#34;:&#34;Android&#34;,&#34;slug&#34;:&#34;android&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://caoyu.me/tag/android/&#34;}],&#34;date&#34;:&#34;2020-12-24 00:59:06&#34;,&#34;dateFormat&#34;:&#34;2020-12-24&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://caoyu.me/post/shi-jian-fen-fa/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;8 min read&#34;,&#34;time&#34;:470000,&#34;words&#34;:1677,&#34;minutes&#34;:8},&#34;description&#34;:&#34;è§¦æ‘¸äº‹ä»¶ç±»å‹\nè§¦æ‘¸äº‹ä»¶å¯¹åº”çš„ç±»æ˜¯ MotionEvent ç±»ï¼Œäº‹ä»¶çš„ä¸»è¦ç±»å‹æœ‰ä»¥ä¸‹å››ç§ï¼š\n\nACTION_DOWN æ‰‹æŒ‡åˆšæ¥è§¦å±å¹•\nACTION_MOVE æ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ»‘åŠ¨\nACTION_UP æ‰‹æŒ‡ä»å±å¹•ä¸ŠæŠ¬èµ·\nACTION_CANCEL ...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6%E7%B1%BB%E5%9E%8B\&#34;&gt;è§¦æ‘¸äº‹ä»¶ç±»å‹&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E7%9A%84%E5%AF%B9%E8%B1%A1\&#34;&gt;äº‹ä»¶åˆ†å‘çš„å¯¹è±¡&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E7%9A%84%E6%96%B9%E6%B3%95\&#34;&gt;äº‹ä»¶åˆ†å‘çš„æ–¹æ³•&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%B5%81%E7%A8%8B\&#34;&gt;äº‹ä»¶åˆ†å‘æµç¨‹&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#activity-%E4%B8%AD%E7%9A%84-%E5%88%86%E5%8F%91%E8%BF%87%E7%A8%8B\&#34;&gt;Activity ä¸­çš„ åˆ†å‘è¿‡ç¨‹&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#viewgroup%E4%B8%AD%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91\&#34;&gt;ViewGroupä¸­çš„äº‹ä»¶åˆ†å‘&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#view-%E4%B8%AD%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91\&#34;&gt;View ä¸­çš„äº‹ä»¶åˆ†å‘&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#action_down\&#34;&gt;ACTION_DOWN&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#action_cancel\&#34;&gt;ACTION_CANCEL&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#action_move\&#34;&gt;ACTION_MOVE&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#action_up\&#34;&gt;ACTION_UP&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E7%9A%84%E6%95%B4%E4%BD%93%E6%A8%A1%E5%9E%8B\&#34;&gt;äº‹ä»¶åˆ†å‘çš„æ•´ä½“æ¨¡å‹&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%BB%91%E5%8A%A8%E4%BA%8B%E4%BB%B6%E5%86%B2%E7%AA%81\&#34;&gt;æ»‘åŠ¨äº‹ä»¶å†²çª&lt;/a&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%A4%96%E9%83%A8%E6%8B%A6%E6%88%AA\&#34;&gt;å¤–éƒ¨æ‹¦æˆª&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%86%85%E9%83%A8%E6%8B%A6%E6%88%AA\&#34;&gt;å†…éƒ¨æ‹¦æˆª&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;Handlerçš„æ¶ˆæ¯å¾ªç¯æ¶‰åŠçš„ç±»ï¼šHandlerï¼ŒLooperï¼ŒMessageï¼ŒMessageQueue&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://caoyu.me/post-images/1608742734612.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&lt;!-- more --&gt;\n&lt;h3 id=\&#34;åˆ›å»º\&#34;&gt;åˆ›å»º&lt;/h3&gt;\n&lt;hr&gt;\n&lt;ol&gt;\n&lt;li&gt;\n&lt;p&gt;ActivityThread mainæ–¹æ³•ä¸­åˆ›å»º Looper&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt; public static void main(String[] args) {\n \t\tLooper.prepareMainLooper();\n \t\t...\n \t\tLooper.loop();\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;Looper prepare æ–¹æ³•ä¸­ï¼Œé€šè¿‡ ThreadLocal å°† Looper å’Œ ä¸»çº¿ç¨‹è¿›è¡Œç»‘å®š&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt; private static void prepare(boolean quitAllowed) {\n     if (sThreadLocal.get() != null) {\n         throw new RuntimeException(&amp;quot;Only one Looper may be created per thread&amp;quot;);\n     }\n     sThreadLocal.set(new Looper(quitAllowed));\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;Looper çš„ç§æœ‰åŒ–æ„é€ æ–¹æ³•ä¸­ ç»‘å®šäº† MessageQueue&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt; private Looper(boolean quitAllowed) {\n     mQueue = new MessageQueue(quitAllowed);\n     mThread = Thread.currentThread();\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h3 id=\&#34;å‘é€ä¸€ä¸ªmessageçš„æµç¨‹\&#34;&gt;å‘é€ä¸€ä¸ªMessageçš„æµç¨‹&lt;/h3&gt;\n&lt;hr&gt;\n&lt;ol&gt;\n&lt;li&gt;\n&lt;p&gt;åˆå§‹åŒ–Handlerï¼Œè·å–å¹¶ç»‘å®šå½“å‰çº¿ç¨‹çš„ MessageQueue å’Œ Looperï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•ä¸­æœ‰ä¸€ä¸ªå¼‚å¸¸ï¼Œå¦‚æœæ˜¯å¼‚æ­¥çº¿ç¨‹çš„è¯éœ€è¦å…ˆè°ƒç”¨ Looper.prepare()ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt; public Handler(Callback callback, boolean async) {\n \t\t...\n     mLooper = Looper.myLooper();\n     if (mLooper == null) {\n         throw new RuntimeException(\n             &amp;quot;Can&#39;t create handler inside thread &amp;quot; + Thread.currentThread()\n                     + &amp;quot; that has not called Looper.prepare()&amp;quot;);\n     }\n     mQueue = mLooper.mQueue;\n     mCallback = callback;\n     ...\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;å‘é€æ¶ˆæ¯æœ€ç»ˆéƒ½ä¼šè°ƒç”¨åˆ° Handler.enqueueMessage(MessageQueue, Message, updateTime) æ–¹æ³•&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt; private boolean enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis) {\n     // è¿™é‡Œå°†å½“å‰çš„ Message å’Œ Handler ç»‘å®š\n \t\tmsg.target = this;\n     if (mAsynchronous) {\n         msg.setAsynchronous(true);\n     }\n     return queue.enqueueMessage(msg, uptimeMillis);\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;å°†å½“å‰Message æ”¾å…¥ MessageQueueï¼Œå¦‚æœé˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯ï¼Œç›´æ¥å°†è¿™ä¸ªæ¶ˆæ¯æ”¾åœ¨é˜Ÿé¦–ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­æœ‰æ¶ˆæ¯ï¼Œæ ¹æ®è¿™ä¸ªæ¶ˆæ¯çš„æ¥æ”¶å¤„ç†æ—¶é—´ï¼Œå°†å…¶æ’å…¥åˆ°åˆé€‚çš„ä½ç½®ã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt; boolean enqueueMessage(Message msg, long when) {\n \t\t...\n     synchronized (this) {\n         if (mQuitting) {\n             IllegalStateException e = new IllegalStateException(\n                     msg.target + &amp;quot; sending message to a Handler on a dead thread&amp;quot;);\n             Log.w(TAG, e.getMessage(), e);\n             msg.recycle();\n             return false;\n         }\n \n         msg.markInUse();\n         msg.when = when;\n         Message p = mMessages;\n         boolean needWake;\n         if (p == null || when == 0 || when &amp;lt; p.when) {\n             // New head, wake up the event queue if blocked.\n             msg.next = p;\n             mMessages = msg;\n             needWake = mBlocked;\n         } else {\n             // Inserted within the middle of the queue.  Usually we don&#39;t have to wake\n             // up the event queue unless there is a barrier at the head of the queue\n             // and the message is the earliest asynchronous message in the queue.\n             needWake = mBlocked &amp;amp;&amp;amp; p.target == null &amp;amp;&amp;amp; msg.isAsynchronous();\n             Message prev;\n             for (;;) {\n                 prev = p;\n                 p = p.next;\n                 if (p == null || when &amp;lt; p.when) {\n                     break;\n                 }\n                 if (needWake &amp;amp;&amp;amp; p.isAsynchronous()) {\n                     needWake = false;\n                 }\n             }\n             msg.next = p; // invariant: p == prev.next\n             prev.next = msg;\n         }\n \n         // We can assume mPtr != 0 because mQuitting is false.\n         if (needWake) {\n             nativeWake(mPtr);\n         }\n     }\n     return true;\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h3 id=\&#34;æ¶ˆè´¹æ¶ˆæ¯\&#34;&gt;æ¶ˆè´¹æ¶ˆæ¯&lt;/h3&gt;\n&lt;hr&gt;\n&lt;ol&gt;\n&lt;li&gt;\n&lt;p&gt;ä¸»çº¿ç¨‹åˆå§‹åŒ–çš„æ—¶å€™æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼Œå°†ä¸»çº¿ç¨‹ç»‘å®šä¸€ä¸ªLooperï¼Œç„¶åè°ƒç”¨äº† Looper.loop æ–¹æ³•è½®è¯¢æ¶ˆæ¯é˜Ÿåˆ—&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt; public static void main(String[] args) {\n \t\tLooper.prepareMainLooper();\n \t\t...\n \t\tLooper.loop();\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;Looper.loop() åˆå§‹åŒ–ä¸»çº¿ç¨‹æ—¶ï¼Œå¼€å¯äº†æ¶ˆæ¯å¾ªç¯ï¼Œé€šè¿‡ MessageQueue çš„ next æ–¹æ³•è·å–ä¸‹ä¸€ä¸ªæ¶ˆæ¯ï¼Œæœ€ç»ˆè°ƒç”¨äº† msg.target.dispatchMessage(msg); å°†æ¶ˆæ¯åˆ†å‘å‡ºå»å¤„ç†ã€‚å¤„ç†ç©è¿™ä¸ªæ¶ˆæ¯åï¼Œè°ƒç”¨ msg.recycleUnchecked() è¿™ä¸ªæ–¹æ³•ï¼Œå°†å®ƒé‡æ–°æ”¾å› æ¶ˆæ¯æ±  ä¸­&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt; public static void loop() {\n     final Looper me = myLooper();\n     if (me == null) {\n         throw new RuntimeException(&amp;quot;No Looper; Looper.prepare() wasn&#39;t called on this thread.&amp;quot;);\n     }\n     final MessageQueue queue = me.mQueue;\n     ...\n     for (;;) {\n         Message msg = queue.next(); // might block\n         if (msg == null) {\n             // No message indicates that the message queue is quitting.\n             return;\n         }\n \t\t\t\t...\n         try {\n             msg.target.dispatchMessage(msg);\n             dispatchEnd = needEndTime ? SystemClock.uptimeMillis() : 0;\n         } finally {\n             if (traceTag != 0) {\n                 Trace.traceEnd(traceTag);\n             }\n         }\n \t\t\t\t...\n \t\t\t\tmsg.recycleUnchecked();\n     }\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;MessageQueue ä¸­è½®è¯¢ä¸‹ä¸€ä¸ªæ¶ˆæ¯çš„æ–¹æ³•ï¼Œè¿™é‡ŒMessage æœ‰ä¸€ä¸ªå›æ”¶æ± ï¼Œåªä¼šè·å–åˆ°æœ€æ–°çš„ Messageï¼Œå°†å½“å‰çš„ Message å–å‡ºï¼Œå¹¶ä¸” next è®¾ç½®ä¸ºnullï¼ŒåŒäº‹å°† mMessages æŒ‡å‘å…¶ä¸‹ä¸€ä¸ª Messageã€‚&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt; Message next() {\n     ...\n     for (;;) {\n         if (nextPollTimeoutMillis != 0) {\n             Binder.flushPendingCommands();\n         }\n \n         nativePollOnce(ptr, nextPollTimeoutMillis);\n \n         synchronized (this) {\n             // Try to retrieve the next message.  Return if found.\n             final long now = SystemClock.uptimeMillis();\n             Message prevMsg = null;\n             Message msg = mMessages;\n             if (msg != null &amp;amp;&amp;amp; msg.target == null) {\n                 // Stalled by a barrier.  Find the next asynchronous message in the queue.\n                 do {\n                     prevMsg = msg;\n                     msg = msg.next;\n                 } while (msg != null &amp;amp;&amp;amp; !msg.isAsynchronous());\n             }\n             if (msg != null) {\n              ...\n                       if (prevMsg != null) {\n                           prevMsg.next = msg.next;\n                       } else {\n                           mMessages = msg.next;\n                       }\n                       msg.next = null;\n                       if (DEBUG) Log.v(TAG, &amp;quot;Returning message: &amp;quot; + msg);\n                       msg.markInUse();\n                       return msg;\n               ...\n               } else {\n                   // No more messages.\n                   nextPollTimeoutMillis = -1;\n               }\n \n               // Process the quit message now that all pending messages have been handled.\n               if (mQuitting) {\n                   dispose();\n                   return null;\n               }\n \t\t\t\t\t\t\t...\n       }\n   }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;li&gt;\n&lt;p&gt;è°ƒç”¨ msg.target.dispatchMessage(msg); å»åˆ†å‘å¤„ç†è¿™ä¸ªæ¶ˆæ¯ï¼Œå…¶ä¸­ target å°±æ˜¯ Handlerï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯ Handler çš„ dispatchMessage çš„æ–¹æ³•&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt; public void dispatchMessage(Message msg) {\n     if (msg.callback != null) {\n         handleCallback(msg);\n     } else {\n         if (mCallback != null) {\n \t\t\t\t\t\t// handleMessage è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½éœ€è¦ Handler å»å®ç°ï¼Œ\n \t\t\t\t\t\t//éƒ½æ˜¯é‡å†™æ–¹æ³•ï¼Œç†è®ºä¸Šä¸ä¼šåŒæ—¶å­˜åœ¨\n             if (mCallback.handleMessage(msg)) {\n                 return;\n             }\n         }\n         handleMessage(msg);\n     }\n }\n \n private static void handleCallback(Message message) {\n \t\t// callback å°±æ˜¯ Runnable è¿™ä¸ªå°±èƒ½å®ç°å­çº¿ç¨‹ Runnable ä¸­çš„ä»£ç  æœ€ç»ˆåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ\n     message.callback.run();\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h2 id=\&#34;ä¸ºä»€ä¹ˆä¸èƒ½åœ¨å­çº¿ç¨‹åˆ›å»º-handler\&#34;&gt;ä¸ºä»€ä¹ˆä¸èƒ½åœ¨å­çº¿ç¨‹åˆ›å»º Handler&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;\n&lt;p&gt;å¯ä»¥çœ‹åˆ° Handler åˆå§‹åŒ–çš„æ—¶å€™ æœ‰è¿™æ ·ä¸€å¥ä»£ç ï¼šLooper.myLooper();&lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt; public Handler(Callback callback, boolean async) {\n \t\t...\n     mLooper = Looper.myLooper();\n     if (mLooper == null) {\n         throw new RuntimeException(\n             &amp;quot;Can&#39;t create handler inside thread &amp;quot; + Thread.currentThread()\n                     + &amp;quot; that has not called Looper.prepare()&amp;quot;);\n     }\n     mQueue = mLooper.mQueue;\n     mCallback = callback;\n     ...\n }\n\n public static @Nullable Looper myLooper() {\n     return sThreadLocal.get();\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;å¹¶ä¸”åœ¨ æ¶ˆæ¯ç³»ç»Ÿåˆå§‹åŒ–çš„æ—¶å€™æœ‰è¿™æ ·ä¸€æ®µä»£ç &lt;/p&gt;\n&lt;pre&gt;&lt;code class=\&#34;language-Java\&#34;&gt; private static void prepare(boolean quitAllowed) {\n     if (sThreadLocal.get() != null) {\n         throw new RuntimeException(&amp;quot;Only one Looper may be created per thread&amp;quot;);\n     }\n     sThreadLocal.set(new Looper(quitAllowed));\n }\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;æˆ‘ä»¬å¯ä»¥çŸ¥é“ sThreadLocal æ˜¯ ThreadLocal çš„ä¸€ä¸ªå®ä¾‹ï¼Œä»–å®é™…ä¸Šæ˜¯ä¸€ä¸ª Mapï¼ŒThread ä½œä¸ºå®ƒçš„ Keyï¼ŒLooper ä½œä¸ºä»–çš„ valueã€‚&lt;/p&gt;\n&lt;p&gt;å…¶ä¸­ Thread æ˜¯é€šè¿‡ Thread.currentThread() è·å–çš„ï¼Œç›´æ¥åœ¨å­çº¿ç¨‹ä¸­åˆ›å»ºHandlerï¼Œè°ƒç”¨äº† sThreadLocal.get() çš„æ–¹æ³•ï¼Œæ­¤æ—¶è¿”å›çš„ä¸€å®šä¸º nullï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚æ‰€ä»¥éœ€è¦å…ˆè°ƒç”¨ Looper.prepare() æ–¹æ³•ï¼Œç»™å½“å‰çº¿ç¨‹åˆ›å»ºä¸€ä¸ª Looperã€‚&lt;/p&gt;\n&lt;p&gt;å…¶ä¸­ Thread ä¸­ç»´æŠ¤äº†ä¸€ä¸ª ThreadLocalMapï¼Œæ¯æ¬¡åˆ›å»ºçš„ ThreadLocalMapï¼Œæœ€ç»ˆæ˜¯è¢« Thread æŒæœ‰çš„ï¼ŒçœŸæ­£çš„ Key value å­˜ThreadLocalMapé‡Œï¼Œè€Œä¸”è¿™ä¸ª çš„ key æ˜¯é€šè¿‡ä¸€ä¸ªå¼±å¼•ç”¨æŒæœ‰çš„ï¼Œæ‰€ä»¥å½“å‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œå›æ”¶å°±å›æ”¶äº†ï¼Œä¸ä¼šç»§ç»­æŒæœ‰å½“å‰çš„ Threadï¼Œä¸ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚ThreadLocalåªæ˜¯ Thread å’Œ ThreadLocalMap çš„æ“ä½œç±»ã€‚&lt;/p&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;h2 id=\&#34;viewpost-å’Œ-handlerpost-çš„åŒºåˆ«\&#34;&gt;View.post å’Œ Handler.post çš„åŒºåˆ«&lt;/h2&gt;\n&lt;p&gt;textView.setText åªèƒ½åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œä¹ˆ&lt;/p&gt;\n&lt;p&gt;ThreadLocal çš„ç”¨æ³•å’ŒåŸç†&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;handler&#34;,&#34;abstract&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;Handlerçš„æ¶ˆæ¯å¾ªç¯æ¶‰åŠçš„ç±»ï¼šHandlerï¼ŒLooperï¼ŒMessageï¼ŒMessageQueue&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;figure data-type=\&#34;image\&#34; tabindex=\&#34;1\&#34;&gt;&lt;img src=\&#34;https://caoyu.me/post-images/1608742734612.jpg\&#34; alt=\&#34;\&#34; loading=\&#34;lazy\&#34;&gt;&lt;/figure&gt;\n&#34;,&#34;title&#34;:&#34;Handler&#34;,&#34;tags&#34;:[{&#34;index&#34;:-1,&#34;name&#34;:&#34;Android&#34;,&#34;slug&#34;:&#34;android&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://caoyu.me/tag/android/&#34;}],&#34;date&#34;:&#34;2020-12-24 00:55:13&#34;,&#34;dateFormat&#34;:&#34;2020-12-24&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://caoyu.me/post/handler/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;7 min read&#34;,&#34;time&#34;:383000,&#34;words&#34;:1316,&#34;minutes&#34;:7},&#34;description&#34;:&#34;\nHandlerçš„æ¶ˆæ¯å¾ªç¯æ¶‰åŠçš„ç±»ï¼šHandlerï¼ŒLooperï¼ŒMessageï¼ŒMessageQueue\n\n\n\nåˆ›å»º\n\n\n\nActivityThread mainæ–¹æ³•ä¸­åˆ›å»º Looper\n public static void main(...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%88%9B%E5%BB%BA\&#34;&gt;åˆ›å»º&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8F%91%E9%80%81%E4%B8%80%E4%B8%AAmessage%E7%9A%84%E6%B5%81%E7%A8%8B\&#34;&gt;å‘é€ä¸€ä¸ªMessageçš„æµç¨‹&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF\&#34;&gt;æ¶ˆè´¹æ¶ˆæ¯&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E8%83%BD%E5%9C%A8%E5%AD%90%E7%BA%BF%E7%A8%8B%E5%88%9B%E5%BB%BA-handler\&#34;&gt;ä¸ºä»€ä¹ˆä¸èƒ½åœ¨å­çº¿ç¨‹åˆ›å»º Handler&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#viewpost-%E5%92%8C-handlerpost-%E7%9A%84%E5%8C%BA%E5%88%AB\&#34;&gt;View.post å’Œ Handler.post çš„åŒºåˆ«&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;å…³äºæœ¬ç«™\&#34;&gt;ğŸ  å…³äºæœ¬ç«™&lt;/h2&gt;\n&lt;h2 id=\&#34;åšä¸»æ˜¯è°\&#34;&gt;ğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°&lt;/h2&gt;\n&lt;h2 id=\&#34;å…´è¶£çˆ±å¥½\&#34;&gt;â›¹ å…´è¶£çˆ±å¥½&lt;/h2&gt;\n&lt;h2 id=\&#34;è”ç³»æˆ‘å‘€\&#34;&gt;ğŸ“¬ è”ç³»æˆ‘å‘€&lt;/h2&gt;\n&#34;,&#34;fileName&#34;:&#34;about&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;å…³äº&#34;,&#34;tags&#34;:[],&#34;date&#34;:&#34;2019-01-25 19:09:48&#34;,&#34;dateFormat&#34;:&#34;2019-01-25&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://caoyu.me/post/about/&#34;,&#34;hideInList&#34;:true,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:6000,&#34;words&#34;:31,&#34;minutes&#34;:1},&#34;description&#34;:&#34;\næ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤\n\nğŸ  å…³äºæœ¬ç«™\nğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°\nâ›¹ å…´è¶£çˆ±å¥½\nğŸ“¬ è”ç³»æˆ‘å‘€\n...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B3%E4%BA%8E%E6%9C%AC%E7%AB%99\&#34;&gt;ğŸ  å…³äºæœ¬ç«™&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8D%9A%E4%B8%BB%E6%98%AF%E8%B0%81\&#34;&gt;ğŸ‘¨â€ğŸ’» åšä¸»æ˜¯è°&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B4%E8%B6%A3%E7%88%B1%E5%A5%BD\&#34;&gt;â›¹ å…´è¶£çˆ±å¥½&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%81%94%E7%B3%BB%E6%88%91%E5%91%80\&#34;&gt;ğŸ“¬ è”ç³»æˆ‘å‘€&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;ğŸ‘  æ¬¢è¿ä½¿ç”¨ &lt;strong&gt;Gridea&lt;/strong&gt; ï¼&lt;br&gt;\nâœï¸  &lt;strong&gt;Gridea&lt;/strong&gt; ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...&lt;/p&gt;\n&lt;!-- more --&gt;\n&lt;p&gt;&lt;a href=\&#34;https://github.com/getgridea/gridea\&#34;&gt;Github&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;https://gridea.dev/\&#34;&gt;Gridea ä¸»é¡µ&lt;/a&gt;&lt;br&gt;\n&lt;a href=\&#34;http://fehey.com/\&#34;&gt;ç¤ºä¾‹ç½‘ç«™&lt;/a&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;ç‰¹æ€§\&#34;&gt;ç‰¹æ€§ğŸ‘‡&lt;/h2&gt;\n&lt;p&gt;ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ &lt;strong&gt;Markdown&lt;/strong&gt; è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ&lt;/p&gt;\n&lt;p&gt;ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡&lt;/p&gt;\n&lt;p&gt;ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„&lt;/p&gt;\n&lt;p&gt;ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•&lt;/p&gt;\n&lt;p&gt;ğŸ’»  ä½ å¯ä»¥åœ¨ &lt;strong&gt;Windows&lt;/strong&gt;ï¼Œ&lt;strong&gt;MacOS&lt;/strong&gt; æˆ– &lt;strong&gt;Linux&lt;/strong&gt; è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯&lt;/p&gt;\n&lt;p&gt;ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ &lt;strong&gt;ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ&lt;/strong&gt; æˆ– &lt;strong&gt;Coding Pages&lt;/strong&gt; å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°&lt;/p&gt;\n&lt;p&gt;ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ &lt;a href=\&#34;https://github.com/gitalk/gitalk\&#34;&gt;Gitalk&lt;/a&gt; æˆ– &lt;a href=\&#34;https://github.com/SukkaW/DisqusJS\&#34;&gt;DisqusJS&lt;/a&gt; è¯„è®ºç³»ç»Ÿ&lt;/p&gt;\n&lt;p&gt;ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨&lt;strong&gt;ä¸­æ–‡ç®€ä½“&lt;/strong&gt;æˆ–&lt;strong&gt;è‹±è¯­&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›&lt;/p&gt;\n&lt;p&gt;ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥&lt;/p&gt;\n&lt;p&gt;ğŸŒ± å½“ç„¶ &lt;strong&gt;Gridea&lt;/strong&gt; è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ&lt;/p&gt;\n&lt;p&gt;æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´&lt;/p&gt;\n&lt;p&gt;å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼&lt;/p&gt;\n&lt;p&gt;ğŸ˜˜ Enjoy~&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;hello-gridea&#34;,&#34;abstract&#34;:&#34;&lt;p&gt;ğŸ‘  æ¬¢è¿ä½¿ç”¨ &lt;strong&gt;Gridea&lt;/strong&gt; ï¼&lt;br&gt;\nâœï¸  &lt;strong&gt;Gridea&lt;/strong&gt; ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...&lt;/p&gt;\n&#34;,&#34;title&#34;:&#34;Hello Gridea&#34;,&#34;tags&#34;:[{&#34;name&#34;:&#34;Gridea&#34;,&#34;slug&#34;:&#34;PbiORCDOn&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://caoyu.me/tag/PbiORCDOn/&#34;}],&#34;date&#34;:&#34;2018-12-12 00:00:00&#34;,&#34;dateFormat&#34;:&#34;2018-12-12&#34;,&#34;feature&#34;:&#34;https://caoyu.me/post-images/hello-gridea.png&#34;,&#34;link&#34;:&#34;https://caoyu.me/post/hello-gridea/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:62000,&#34;words&#34;:298,&#34;minutes&#34;:2},&#34;description&#34;:&#34;ğŸ‘  æ¬¢è¿ä½¿ç”¨ Gridea ï¼\nâœï¸  Gridea ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...\n\nGithub\nGridea ä¸»é¡µ\nç¤ºä¾‹ç½‘ç«™\nç‰¹æ€§ğŸ‘‡\nğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ Markdo...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%89%B9%E6%80%A7\&#34;&gt;ç‰¹æ€§ğŸ‘‡&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;}]";
  // var json = escape.substr(1, escape.length - 2);
  // var datas = json.split(',');
  // for (let i=0; i < datas.length; i++) {
  //   let item = datas[i];
  //   let attrs = item.split('34;:&#34')
  //   debugger
  //   console.log(datas[i])
  // }
  let escapeMap = new Map();
  escapeMap.set('&#34;', '"');
  escapeMap.set('&gt;', '>');
  escapeMap.set('&#39;', "'");
  escapeMap.set('&lt;', '<');
  escapeMap.set('&quot;', '"');
  escapeMap.set('&amp;', '&');
</script> -->



</html>